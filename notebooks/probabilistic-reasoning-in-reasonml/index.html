<!DOCTYPE html>
<html>
    <head><meta charset="utf-8" />
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <title>Imandra Documentation - Probabilistic Reasoning in ReasonML</title>
        <meta property="og:url" content="https://docs.imandra.ai/imandra-docs/notebooks/probabilistic-reasoning-in-reasonml/">
        <meta property="og:type" content="website">
        <meta property="og:title" content="Imandra Documentation - Probabilistic Reasoning in ReasonML">
        <meta property="og:description" content="In this ReasonML notebook, we employ Imandra ability to reason about functional values to analyse probabilistic scenarios following the example of the Monty Hall problem.">
        <meta property="og:image" content="https://storage.googleapis.com/imandra-assets/images/og_image_default_i78.jpg">


        
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-116937440-6"></script>
        <script>
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());

         gtag('config', 'UA-116937440-1');
        </script>
        <script type="text/javascript"> var sc_project=11767520; var sc_invisible=1; var sc_security="fa7e88d1"; </script>
        <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async></script>
        <noscript><div class="statcounter">
            <a title="Web Analytics" href="http://statcounter.com/" target="_blank">
                <img class="statcounter" src="//c.statcounter.com/11767520/0/fa7e88d1/1/" alt="Web Analytics"></a>
        </div></noscript>
        

        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather+Sans:300,300i,400,400i%7CMerriweather:300,300i,400,400i%7CRoboto+Slab:300,300i,400,400i">

        <link rel="stylesheet" href="/imandra-docs/static/style/style.min.9ef6027e.css" type="text/css">
        <link rel="stylesheet" href="/imandra-docs/static/nbextensions/nbimandra/styles.c7ed3d1a.css" type="text/css">
        <link rel="stylesheet" href="/imandra-docs/static/docs-styles.86fc0481.css" type="text/css">
        
        <link rel="stylesheet" href="/imandra-docs/static/jekyll-styles.73f39aa7.css" type="text/css">
        

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <script src="/imandra-docs/static/nbimandra-rjs-bundle.2469bcb7.js"></script>

        <style type="text/css">
         .highlight .hll { background-color: #ffffcc }
         .highlight  { background: #f8f8f8; }
         .highlight .c { color: #408080; font-style: italic } /* Comment */
         .highlight .err { border: 1px solid #FF0000 } /* Error */
         .highlight .k { color: #008000; font-weight: bold } /* Keyword */
         .highlight .o { color: #666666 } /* Operator */
         .highlight .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
         .highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
         .highlight .cp { color: #BC7A00 } /* Comment.Preproc */
         .highlight .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
         .highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
         .highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
         .highlight .gd { color: #A00000 } /* Generic.Deleted */
         .highlight .ge { font-style: italic } /* Generic.Emph */
         .highlight .gr { color: #FF0000 } /* Generic.Error */
         .highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
         .highlight .gi { color: #00A000 } /* Generic.Inserted */
         .highlight .go { color: #888888 } /* Generic.Output */
         .highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
         .highlight .gs { font-weight: bold } /* Generic.Strong */
         .highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
         .highlight .gt { color: #0044DD } /* Generic.Traceback */
         .highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
         .highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
         .highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
         .highlight .kp { color: #008000 } /* Keyword.Pseudo */
         .highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
         .highlight .kt { color: #B00040 } /* Keyword.Type */
         .highlight .m { color: #666666 } /* Literal.Number */
         .highlight .s { color: #BA2121 } /* Literal.String */
         .highlight .na { color: #7D9029 } /* Name.Attribute */
         .highlight .nb { color: #008000 } /* Name.Builtin */
         .highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
         .highlight .no { color: #880000 } /* Name.Constant */
         .highlight .nd { color: #AA22FF } /* Name.Decorator */
         .highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
         .highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
         .highlight .nf { color: #0000FF } /* Name.Function */
         .highlight .nl { color: #A0A000 } /* Name.Label */
         .highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
         .highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
         .highlight .nv { color: #19177C } /* Name.Variable */
         .highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
         .highlight .w { color: #bbbbbb } /* Text.Whitespace */
         .highlight .mb { color: #666666 } /* Literal.Number.Bin */
         .highlight .mf { color: #666666 } /* Literal.Number.Float */
         .highlight .mh { color: #666666 } /* Literal.Number.Hex */
         .highlight .mi { color: #666666 } /* Literal.Number.Integer */
         .highlight .mo { color: #666666 } /* Literal.Number.Oct */
         .highlight .sa { color: #BA2121 } /* Literal.String.Affix */
         .highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
         .highlight .sc { color: #BA2121 } /* Literal.String.Char */
         .highlight .dl { color: #BA2121 } /* Literal.String.Delimiter */
         .highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
         .highlight .s2 { color: #BA2121 } /* Literal.String.Double */
         .highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
         .highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
         .highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
         .highlight .sx { color: #008000 } /* Literal.String.Other */
         .highlight .sr { color: #BB6688 } /* Literal.String.Regex */
         .highlight .s1 { color: #BA2121 } /* Literal.String.Single */
         .highlight .ss { color: #19177C } /* Literal.String.Symbol */
         .highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
         .highlight .fm { color: #0000FF } /* Name.Function.Magic */
         .highlight .vc { color: #19177C } /* Name.Variable.Class */
         .highlight .vg { color: #19177C } /* Name.Variable.Global */
         .highlight .vi { color: #19177C } /* Name.Variable.Instance */
         .highlight .vm { color: #19177C } /* Name.Variable.Magic */
         .highlight .il { color: #666666 } /* Literal.Number.Integer.Long */
        </style>

        <!-- Loading mathjax macro -->
        <!-- Load mathjax -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML"></script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true,
            processEnvironments: true
        },
        // Center justify equations in code and markdown cells. Elsewhere
        // we use CSS to left justify single line equations in code cells.
        displayAlign: 'center',
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}},
            linebreaks: { automatic: true }
        }
    });
    </script>
    <!-- End of mathjax configuration --><script>
  function handleCopyClick() {
      var el = this;
      var terminal = el.closest('.terminal');
      var highlight = terminal.getElementsByClassName('highlight')[0];
      copyToClipboardMsg(highlight);

      terminal.classList.add('terminal--hide');
      setTimeout(function () {
          terminal.classList.remove('terminal--hide');
      }, 2000);


      function copyToClipboardMsg(elem) {
          var succeed = copyToClipboard(elem);
          var msg;
          if (!succeed) {
              msg = 'Error!';
          } else {
              msg = 'Copied!';
          }

          var msgElem = terminal.querySelector('.terminal__copy-msg');
          msgElem.innerHTML = msg;
          setTimeout(function () {
              msgElem.innerHTML = 'You rock!';
          }, 1000);
      }

      function copyToClipboard(elem) {
          // create hidden text element, if it doesn't already exist
          var targetId = '_hiddenCopyText_';
          var isInput = elem.tagName === 'INPUT' || elem.tagName === 'TEXTAREA';
          var origSelectionStart, origSelectionEnd;
          if (isInput) {
              // can just use the original source element for the selection and copy
              target = elem;
              origSelectionStart = elem.selectionStart;
              origSelectionEnd = elem.selectionEnd;
          } else {
              // must use a temporary form element for the selection and copy
              target = terminal.querySelector('#' + targetId);
              if (!target) {
                  var target = document.createElement('textarea');
                  // target.style.display = 'flex';
                  // target.style.position = 'absolute';
                  // target.style.left = '-1000%';
                  target.id = targetId;
                 elem.appendChild(target);
              }
              target.textContent = elem.textContent.trim();
          }
          
          // select the content
          var currentFocus = document.activeElement;
          target.focus();
          target.setSelectionRange(0, target.value.length);

          // copy the selection
          var succeed;
          try {
              succeed = document.execCommand('copy');
          } catch (e) {
              succeed = false;
          }
          // restore original focus
          if (currentFocus && typeof currentFocus.focus === 'function') {
              currentFocus.focus();
          }

          if (isInput) {
              // restore prior selection
              elem.setSelectionRange(origSelectionStart, origSelectionEnd);
          } else {
              // clear temporary content
              elem.removeChild(target);
          }
          return succeed;
      }
  }
</script>
    </head>
    <body>
        <div class="background">
        </div>
        <div class="page-container">
            <main class="main-content-column">
                <!-- Jupyter (Imandra core docs) version -->
<header class="header">
    <div class="top-row-container">
        <div class="top-row">

            <div id="toggler--left" class="side__left-menu-toggler">
                <div class="side__toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <p class="side__toggle-text">Docs</p>
            </div>

            <div class="side__logo-container">
                <a class="side__logo-link" href="/">
                    <img class="side__logo " src = "/imandra-docs/jekyll-resources/assets/img/ai_logo_green.svg">
                </a>
            </div>

            <div id="toggler--right" class="side__right-menu-toggler">
                <p class="side__toggle-text">Pages</p>
                <div class="side__toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>

            <nav class="side__nav-container side__nav-container--hidden">

                <ul class="side__nav-list">
                    
                    <li class="side__nav-list-item TopNavListItem">
                        <a class="side__nav-link" href="/">Documentation Home</a>
                        
                    </li>
                    
                    <li class="side__nav-list-item TopNavListItem">
                        <a class="side__nav-link side__nav-link--active" href="/imandra-docs">Imandra</a>
                        
                        <ul class="side__nav-list--sub-level-1">
                            
                            <li class="side__nav-list-item--sub-level-1">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/welcome">A Quick Tour</a>
                                
                                <ul class="side__nav-list--sub-level-2">
                                    
                                </ul>
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/installation">Installation</a>
                                
                                <ul class="side__nav-list--sub-level-2">
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/installation-simple">Simple</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/installation-docker">Docker</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/installation-vscode">VSCode</a>
                                        
                                    </li>
                                    
                                </ul>
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/logic-and-program-modes">Logic and Program Modes</a>
                                
                                <ul class="side__nav-list--sub-level-2">
                                    
                                </ul>
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/verification">Verification</a>
                                
                                <ul class="side__nav-list--sub-level-2">
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verification/#Commands">Commands</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verification/#Attributes">Attributes</a>
                                        
                                        <ul class="side__nav-list--sub-level-3">
                                            
                                            <li class="side__nav-list-item--sub-level-3">
                                              <a class="side__nav-link" href="/imandra-docs/notebooks/verification/#Verification-Hints">Verification Hints</a>
                                            </li>
                                            
                                            <li class="side__nav-list-item--sub-level-3">
                                              <a class="side__nav-link" href="/imandra-docs/notebooks/verification/#Rule-Classes">Rule Classes</a>
                                            </li>
                                            
                                        </ul>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verification/#Unrolling">Unrolling</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verification/#Simplification">Simplification</a>
                                        
                                        <ul class="side__nav-list--sub-level-3">
                                            
                                            <li class="side__nav-list-item--sub-level-3">
                                              <a class="side__nav-link" href="/imandra-docs/notebooks/verification/#Rewrite-Rules">Rewrite Rules</a>
                                            </li>
                                            
                                            <li class="side__nav-list-item--sub-level-3">
                                              <a class="side__nav-link" href="/imandra-docs/notebooks/verification/#Forward-chaining-Rules">Forward-chaining Rules</a>
                                            </li>
                                            
                                        </ul>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verification/#Blast">Blast</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verification/#Induction">Induction</a>
                                        
                                        <ul class="side__nav-list--sub-level-3">
                                            
                                            <li class="side__nav-list-item--sub-level-3">
                                              <a class="side__nav-link" href="/imandra-docs/notebooks/verification/#Functional-Induction">Functional Induction</a>
                                            </li>
                                            
                                            <li class="side__nav-list-item--sub-level-3">
                                              <a class="side__nav-link" href="/imandra-docs/notebooks/verification/#Structural-Induction">Structural Induction</a>
                                            </li>
                                            
                                        </ul>
                                        
                                    </li>
                                    
                                </ul>
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/extracting-ocaml-modules-with-imandra-extract">Extracting OCaml modules with imandra-extract</a>
                                
                                <ul class="side__nav-list--sub-level-2">
                                    
                                </ul>
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/proving-program-termination">Proving Program Termination</a>
                                
                                <ul class="side__nav-list--sub-level-2">
                                    
                                </ul>
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1">
                                
                                Region Decomposition
                                
                                <ul class="side__nav-list--sub-level-2">
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/decomposition-flags">Imandra Decomposition Flags</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/imandra-tools-intro">Imandra Tools Introduction</a>
                                        
                                    </li>
                                    
                                </ul>
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/examples">Examples</a>
                                
                                <ul class="side__nav-list--sub-level-2">
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/recursion-induction-and-rewriting">Recursion, Induction and Rewriting</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verifying-merge-sort">Verifying Merge Sort in Imandra</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/ubs-case-study">Analysing the UBS ATS Dark Pool</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/webservice-auth-logic">Analysing Web-app Authentication Logic</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/simple-vehicle-controller">Simple Vehicle Controller</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/ripple-carry-adder">Verifying a Ripple Carry Adder</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verifying-an-ros-node">Creating and Verifying a ROS Node</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/reasonml-tic-tac-toe">Tic Tac Toe with ReasonML</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link side__nav-link--active" href="/imandra-docs/notebooks/probabilistic-reasoning-in-reasonml">Probabilistic Reasoning in ReasonML</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/sudoku">Solving Sudoku with Imandra</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/crossing-river-safely">Crossing the River Safely</a>
                                        
                                    </li>
                                    
                                </ul>
                            </li>
                            
                        </ul>
                        
                    </li>
                    
                    <li class="side__nav-list-item TopNavListItem">
                        <a class="side__nav-link" href="/ipl">Imandra Protocol Language</a>
                        
                    </li>
                    
                    <li class="side__nav-list-item TopNavListItem">
                        <a class="side__nav-link" href="/fix-engine">FIX Engine</a>
                        
                    </li>
                    
                </ul>
            </nav>
        </div>
    </div>

    <div class="background">
    </div>

    <div class="template-header">
        <div class="top-bar">
            <nav class="top-bar__nav-container">
                <a href="#" class="top-bar__toggle">≡</a>
                <ul class="top-bar__nav-list top-bar__nav-list--hidden">
                    <li class="top-bar__nav-list-item"><a class="top-bar__nav-link" href="https://www.imandra.ai/">Home</a></li>
                    <li class="top-bar__nav-list-item"><a class="top-bar__nav-link" href="https://try.imandra.ai/">Try</a></li>
                    <li class="top-bar__nav-list-item"><a class="top-bar__nav-link" href="https://medium.com/imandra">Blog</a></li>
                    <li class="top-bar__nav-list-item"><a class="top-bar__nav-link" href="https://www.imandra.ai/research">Research</a></li>
                    <li class="top-bar__nav-list-item"><a class="top-bar__nav-link" href="https://docs.imandra.ai/">Docs</a></li>
                    <li class="top-bar__nav-list-item"><a class="top-bar__nav-link" href="https://www.imandra.ai/media">Media</a></li>
                    <li class="top-bar__nav-list-item"><a class="top-bar__nav-link" href="https://www.imandra.ai/about">About AI</a></li>
                    <li class="top-bar__nav-list-item"><a class="top-bar__nav-link" href="https://www.imandra.ai/careers">CAREERS</a></li>
                    <li class="top-bar__nav-list-item"><a class="top-bar__nav-link" href="https://www.imandra.ai/contact">CONTACT</a></li>
                </ul>
            </nav>
        </div>

        <div class="template-header__image-container template-header__image-container--jupyter">
            <div class="template-header__image" href ="/imandra-docs">
                <img class="SiteSpecificImage" src="/imandra-docs/static/img/site_specific_image_v_2.svg">
            </div>
        </div>
        
    </div>

    <script>
        document.getElementById('toggler--left').addEventListener('click', function () {
            document.querySelector('.side__right-menu-toggler .side__toggle').classList.remove('side__toggle--active');
            document.querySelector('.side__left-menu-toggler .side__toggle').classList.toggle('side__toggle--active');
            document.getElementsByClassName('side__nav-container')[0].classList.toggle('side__nav-container--hidden');
            document.getElementsByClassName('top-bar__nav-list')[0].classList.add('top-bar__nav-list--hidden');
        });

        document.getElementById('toggler--right').addEventListener('click', function () {
            document.querySelector('.side__left-menu-toggler .side__toggle').classList.remove('side__toggle--active');
            document.querySelector('.side__right-menu-toggler .side__toggle').classList.toggle('side__toggle--active');
            document.getElementsByClassName('side__nav-container')[0].classList.add('side__nav-container--hidden');
            document.getElementsByClassName('top-bar__nav-list')[0].classList.toggle('top-bar__nav-list--hidden');
        });

    </script>
</header>
                <article class="article__container article__container--notebooks">
                    <div class="main-content main-content--jupyter">
                        
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>An amazing feature of Imandra is the ability to reason about functional inputs and generate functional instances and counterexamples. For example we can introduce a variant type and a second-order function that evaluates its argument on each variant and computes the sum of the results.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-2" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="k">type</span> <span class="nc">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">C</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">B</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[1]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>type t = A | B | C
val sum : (t -&gt; Z.t) -&gt; Z.t = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Now, let's ask Imandra to come up with an instance of a function <code>f</code> that returns positive values and that produces <code>42</code> when calling <code>sum(f)</code>:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-4" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="n">instance</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">B</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[2]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : (t -&gt; int) -&gt; bool = &lt;fun&gt;
module CX : sig val f : t -&gt; Z.t end
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre>Instance (after 0 steps, 0.028s):
 let f = function
   | C -&gt; 40
   | _ -&gt; 1
 
</pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><div class="imandra-vr imandra-vr-proved"><i class="fa fa-check-circle"></i><span>Instance</span></div><div><div class="imandra-alternatives" id="alt-381ac1b1-277c-49df-9e33-4ff511a8fa3e"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>call graph</a></li><li class="" data-toggle="tab"><a>proof-attempt</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-graphviz" id="graphviz-621d0e71-9434-456c-acc8-639d3e7cf1d8"><textarea style="display: none">digraph &quot;call graph&quot; {
goal [label=&quot;(not (sko_f_0 A \&lt;= 0) &amp;&amp; not (sko_f_0 B \&lt;= 0))\l&amp;&amp; (sko_f_0 A + sko_f_0 B) + sko_f_0 C = 42&quot;,shape=box,style=filled,color=&quot;cyan&quot;,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-621d0e71-9434-456c-acc8-639d3e7cf1d8';
  graphviz.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-proof-top"><div class="imandra-fold panel panel-default" id="fold-9a4113ac-347b-4541-bc97-d0463c02056f"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>proof attempt</span></div></div><div class="panel-body collapse"><div class="imandra-proof"><div class="imandra-alternatives" id="alt-77d86298-c55c-4a78-8af8-43cb6f3e337a"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>summary</a></li><li class="" data-toggle="tab"><a>full</a></li><li class="" data-toggle="tab"><a>graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-table" id="table-66d7e4c1-dd6a-4e54-a3af-f410bdaa43e1"><table><tr><td><b>ground_instances</b></td><td>0</td></tr><tr><td><b>definitions</b></td><td>0</td></tr><tr><td><b>inductions</b></td><td>0</td></tr><tr><td><b>search_time</b></td><td><pre>0.028s</pre></td></tr><tr><td><b>details</b></td><td><div class="imandra-fold panel panel-default" id="fold-4ae0faf5-3a91-4f49-92ef-94c9895d13d4"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><div class="imandra-table" id="table-ca350386-df28-4d81-ad64-faee8910c0b5"><table><tr><td><b>smt_stats</b></td><td><div class="imandra-table" id="table-eb91e224-cfef-4201-aa54-51aad9b101b4"><table><tr><td><b>num checks</b></td><td>1</td></tr><tr><td><b>arith assert lower</b></td><td>3</td></tr><tr><td><b>arith pivots</b></td><td>1</td></tr><tr><td><b>rlimit count</b></td><td>235</td></tr><tr><td><b>mk clause</b></td><td>3</td></tr><tr><td><b>datatype occurs check</b></td><td>3</td></tr><tr><td><b>mk bool var</b></td><td>11</td></tr><tr><td><b>arith assert upper</b></td><td>1</td></tr><tr><td><b>propagations</b></td><td>2</td></tr><tr><td><b>datatype accessor ax</b></td><td>3</td></tr><tr><td><b>num allocs</b></td><td>1363262891</td></tr><tr><td><b>final checks</b></td><td>1</td></tr><tr><td><b>added eqs</b></td><td>1</td></tr><tr><td><b>del clause</b></td><td>3</td></tr><tr><td><b>arith eq adapter</b></td><td>1</td></tr><tr><td><b>memory</b></td><td>21.810000</td></tr><tr><td><b>max memory</b></td><td>24.740000</td></tr></table></div></td></tr></table></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-4ae0faf5-3a91-4f49-92ef-94c9895d13d4';
  fold.hydrate(target);
});
</script></div></td></tr></table></div></div><div class="tab-pane"><div class="imandra-fold panel panel-default" id="fold-2035300f-d15a-488b-880b-c73928d78887"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><ul><li><pre>start[0.028s]
  sko_f_0 A &gt; 0 &amp;&amp; sko_f_0 B &gt; 0 &amp;&amp; (sko_f_0 A + sko_f_0 B) + sko_f_0 C = 42</pre></li><li><div><h4>simplify</h4><div class="imandra-table" id="table-3da92e85-72c2-4089-a267-cec6b5354d29"><table><tr><td><b>into</b></td><td><pre>(not (sko_f_0 A &lt;= 0) &amp;&amp; not (sko_f_0 B &lt;= 0))
&amp;&amp; (sko_f_0 A + sko_f_0 B) + sko_f_0 C = 42</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><ul></ul></td></tr></table></div></div></li><li>Sat (Some  let f = function
   | C -&gt; 40
   | _ -&gt; 1
 
)</li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-2035300f-d15a-488b-880b-c73928d78887';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-5fe24fe2-cc29-4150-947c-e04174f992b8"><textarea style="display: none">digraph &quot;proof&quot; {
p_279 [label=&quot;Start (sko_f_0 A \&gt; 0\l       &amp;&amp; sko_f_0 B \&gt; 0 &amp;&amp; (sko_f_0 A + sko_f_0 B) + sko_f_0 C = 42\l       :time 0.028s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_279 -&gt; p_278 [label=&quot;&quot;];
p_278 [label=&quot;Simplify ((not (sko_f_0 A \&lt;= 0) &amp;&amp; not (sko_f_0 B \&lt;= 0))\l          &amp;&amp; (sko_f_0 A + sko_f_0 B) + sko_f_0 C = 42 :expansions [] \l          :rw [] :fc [])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_278 -&gt; p_277 [label=&quot;&quot;];
p_277 [label=&quot;Sat (Some  let f = function\l   \| C -\&gt; 40\l   \| _ -\&gt; 1\l \l)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-5fe24fe2-cc29-4150-947c-e04174f992b8';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-77d86298-c55c-4a78-8af8-43cb6f3e337a';
  alternatives.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-9a4113ac-347b-4541-bc97-d0463c02056f';
  fold.hydrate(target);
});
</script></div></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-381ac1b1-277c-49df-9e33-4ff511a8fa3e';
  alternatives.hydrate(target);
});
</script></div></div></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>A natural application of this ability is to apply it to formal reasoning about random variables and probability distributions over them. In the following, we'll consider an application of this kind of reasoning to analyse the famous Monty Hall problem.</p>
<h1 id="Monty-Hall&#160;problem">Monty Hall&#160;problem<a class="anchor-link" href="#Monty-Hall&#160;problem">&#182;</a></h1><p>In the Monty Hall problem, you are participating in a game where you are given three doors to choose from. One of the doors randomly contains a $1,000,000 prize. Let’s encode that in ReasonML — we’ll introduce the value of the prize and the variant type for the doors.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-6" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">prize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1000000.0</span><span class="w"></span>

<span class="k">type</span> <span class="nc">door</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">DoorA</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">DoorB</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">DoorC</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[3]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val prize : Q.t = 1000000
type door = DoorA | DoorB | DoorC
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The game then proceeds as follows: first, you guess one of the doors, then the host opens another door — a door that, the host knows, doesn’t contain the prize. The host then offers you to change your initial guess or stay with it.</p>
<p>To encode that, we’ll introduce another variant type for the player choice and gather all the values that describe a single Monty Hall trial into a <code>scenario</code> record.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-8" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="k">type</span> <span class="nc">choice</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Stay</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Swap</span><span class="w"></span>

<span class="k">type</span> <span class="nc">scenario</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">prize</span><span class="w">       </span>: <span class="nc">door</span><span class="w"></span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">first_guess</span><span class="w"> </span>: <span class="nc">door</span><span class="w"></span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">choice</span><span class="w">      </span>: <span class="nc">choice</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[4]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>type choice = Stay | Swap
type scenario = { prize : door; first_guess : door; choice : choice; }
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Probability-mass-functions&#160;">Probability mass functions&#160;<a class="anchor-link" href="#Probability-mass-functions&#160;">&#182;</a></h2><p>We want to treat scenarios described by the "scenario" record as random. This means, that we would like to deal with <a href="https://en.wikipedia.org/wiki/Probability_mass_function">probability mass functions</a> (PMFs) over the variables of the declared types. As a first example lets make a PMF for the doors  that distribute over the three doors with equal probabilities:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-10" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">pDoorsEqual</span><span class="w"> </span>: <span class="p">(</span><span class="n">door</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">real</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">door</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Real</span><span class="p">.(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">3.0</span><span class="p">)</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[5]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val pDoorsEqual : door -&gt; real = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Notice that we are using the <code>real</code> type for numeric values in our examples. Internally, Imandra represents reals as arbitrary-precision rational numbers. The real-valued arithmetic operators are gathered in the <code>Real</code> module. Further, we’ll be explicitly opening the <code>Real</code> module to stress that we are dealing with the rational arithmetic.</p>
<p>Not any function can be a probability mass function — PMFs must satisfy the so-called “measure axioms”: all the returned values must be positive and the total probability over the whole function domain must sum to one. Let’s make a predicate that checks whether a function is a valid PMF over doors.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-12" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">valid_door_pmf</span><span class="w"> </span>: <span class="p">(</span><span class="n">door</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">real</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="o">=</span><span class="w">  </span>
<span class="w">  </span><span class="p">(</span><span class="n">pmf</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Real</span><span class="p">.(</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">pmf</span><span class="p">(</span><span class="n">DoorA</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pmf</span><span class="p">(</span><span class="n">DoorB</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pmf</span><span class="p">(</span><span class="n">DoorC</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">pmf</span><span class="p">(</span><span class="n">DoorA</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">pmf</span><span class="p">(</span><span class="n">DoorB</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">pmf</span><span class="p">(</span><span class="n">DoorC</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w">  </span>
<span class="w">  </span><span class="p">)</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[6]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val valid_door_pmf : (door -&gt; real) -&gt; bool = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To check that this predicate works we use it on our <code>pDoorsEqual</code> function.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-14" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="n">valid_door_pmf</span><span class="p">(</span><span class="n">pDoorsEqual</span><span class="p">)</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[7]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : bool = true
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The player controls the <code>first_guess</code> and the <code>choice</code> fields of the <code>scenario</code> record. In general, the player can also choose his actions randomly. Following the game theory nomenclature, we’ll call the probability distribution over the player choices a “strategy”. For example, here is a strategy that chooses the first guess door randomly and then stays with that choice:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-16" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">random_then_stay_strategy</span><span class="w"> </span>: <span class="p">(</span><span class="n">door</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">choice</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">real</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="n">door</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">choice</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Real</span><span class="p">.(</span><span class="w"></span>
<span class="w">    </span><span class="n">switch</span><span class="p">(</span><span class="n">door</span><span class="p">,</span><span class="n">choice</span><span class="p">){</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="p">,</span><span class="n">Stay</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">3.0</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="p">,</span><span class="n">Swap</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span>
<span class="w">  </span><span class="p">)</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[8]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val random_then_stay_strategy : door -&gt; choice -&gt; real = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>A strategy’s type is <code>door =&gt; choice =&gt; real</code>: it takes in which door the player chooses and which choice he makes and returns the probability with which that happens. To check that such a function is a valid probability mass function we introduce and apply a predicate for it:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-18" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">valid_strategy</span><span class="w"> </span>: <span class="p">(</span><span class="n">door</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">choice</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">real</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Real</span><span class="p">.({</span><span class="w">  </span>
<span class="w">    </span><span class="p">(</span><span class="n">strategy</span><span class="p">(</span><span class="n">DoorA</span><span class="p">,</span><span class="n">Stay</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">strategy</span><span class="p">(</span><span class="n">DoorA</span><span class="p">,</span><span class="n">Swap</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">strategy</span><span class="p">(</span><span class="n">DoorB</span><span class="p">,</span><span class="n">Stay</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">strategy</span><span class="p">(</span><span class="n">DoorB</span><span class="p">,</span><span class="n">Swap</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">strategy</span><span class="p">(</span><span class="n">DoorC</span><span class="p">,</span><span class="n">Stay</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">strategy</span><span class="p">(</span><span class="n">DoorC</span><span class="p">,</span><span class="n">Swap</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="w"> </span><span class="n">strategy</span><span class="p">(</span><span class="n">DoorA</span><span class="p">,</span><span class="n">Stay</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">strategy</span><span class="p">(</span><span class="n">DoorA</span><span class="p">,</span><span class="n">Swap</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">      </span><span class="n">strategy</span><span class="p">(</span><span class="n">DoorB</span><span class="p">,</span><span class="n">Stay</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">strategy</span><span class="p">(</span><span class="n">DoorB</span><span class="p">,</span><span class="n">Swap</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">      </span><span class="n">strategy</span><span class="p">(</span><span class="n">DoorC</span><span class="p">,</span><span class="n">Stay</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">strategy</span><span class="p">(</span><span class="n">DoorC</span><span class="p">,</span><span class="n">Swap</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">});</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[9]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val valid_strategy : (door -&gt; choice -&gt; real) -&gt; bool = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-19" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="n">valid_strategy</span><span class="p">(</span><span class="n">random_then_stay_strategy</span><span class="p">)</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[10]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : bool = true
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Finally, we’ll need one last function that constructs a PMF over the whole scenario record. It shall take a <code>door =&gt; real</code> prize PMF, a <code>door =&gt; choice =&gt; real</code> player strategy and return a <code>scenario =&gt; real</code> PMF over the scenarios. Since we consider the host and the player choices to be independent, the total probability of the full scenario must be the product of the probabilities of the host and player choices:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-21" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">make_scenario_pmf</span><span class="w"> </span>: <span class="p">(</span><span class="n">door</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">real</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">door</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">choice</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">real</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">scenario</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">real</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="n">door_pmf</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Real</span><span class="p">.({</span><span class="w"></span>
<span class="w">    </span><span class="n">door_pmf</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">prize</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">strategy</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">first_guess</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">choice</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">})</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[11]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val make_scenario_pmf :
  (door -&gt; real) -&gt; (door -&gt; choice -&gt; real) -&gt; scenario -&gt; real = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Expected-rewards">Expected rewards<a class="anchor-link" href="#Expected-rewards">&#182;</a></h2><p>Given a <code>scenario</code> variable, we calculate a reward that the player gets. When the first guess is equal to the prize location, then we return the prize value if the player decided to stay. Alternatively, when the first guess is not equal to the prize location, then we return the prize value if the player decided to swap.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-23" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">reward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">scenario</span><span class="p">.</span><span class="n">prize</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">scenario</span><span class="p">.</span><span class="n">first_guess</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">scenario</span><span class="p">.</span><span class="n">choice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Stay</span><span class="p">)</span><span class="w"> </span><span class="n">prize</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">scenario</span><span class="p">.</span><span class="n">choice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Swap</span><span class="p">)</span><span class="w"> </span><span class="n">prize</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[12]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val reward : scenario -&gt; Q.t = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Given a probability distribution over scenarios, we want to calculate the expected value of the reward - the probability-weighted average of possible values of the reward for each outcome. 
$$ E[reward] = \sum_s P(s)\,reward(s) $$
We create a function that performs this averaging: it takes in a scenario PMF of type <code>scenario =&gt; real</code> and returns a <code>real</code> value for the expectation value:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-25" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">expected_reward</span><span class="w"> </span>: <span class="p">(</span><span class="n">scenario</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">real</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">real</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="n">scenario_pmf</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Real</span><span class="p">.({</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">pr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">scenario_pmf</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">reward</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kd">let</span><span class="w"> </span><span class="n">avg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">choice</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">avg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">first_guess</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">pr</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">prize</span>: <span class="nc">DoorA</span><span class="p">,</span><span class="w"> </span><span class="n">first_guess</span><span class="p">,</span><span class="w"> </span><span class="n">choice</span><span class="p">}</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">          </span><span class="n">pr</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">prize</span>: <span class="nc">DoorB</span><span class="p">,</span><span class="w"> </span><span class="n">first_guess</span><span class="p">,</span><span class="w"> </span><span class="n">choice</span><span class="p">}</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">          </span><span class="n">pr</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">prize</span>: <span class="nc">DoorC</span><span class="p">,</span><span class="w"> </span><span class="n">first_guess</span><span class="p">,</span><span class="w"> </span><span class="n">choice</span><span class="p">}</span><span class="w"> </span>
<span class="w">        </span><span class="p">};</span><span class="w"></span>
<span class="w">      </span><span class="n">avg</span><span class="p">(</span><span class="n">DoorA</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">avg</span><span class="p">(</span><span class="n">DoorB</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">avg</span><span class="p">(</span><span class="n">DoorC</span><span class="p">)</span><span class="w"> </span>
<span class="w">      </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="n">avg</span><span class="p">(</span><span class="n">Stay</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">avg</span><span class="p">(</span><span class="n">Swap</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">})</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[13]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val expected_reward : (scenario -&gt; real) -&gt; real = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>As a final example, let’s use what we’ve built so far to calculate the expected reward for the scenario when the host hides the prize equally randomly and the player uses the <code>random_then_stay_strategy</code>:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-27" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="n">expected_reward</span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="n">make_scenario_pmf</span><span class="p">(</span><span class="n">pDoorsEqual</span><span class="p">,</span><span class="w"> </span><span class="n">random_then_stay_strategy</span><span class="p">)</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[14]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : real = 1000000/3
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We get an obvious result that if we choose a random door and stay with it, then the expected reward is 1/3 of a $1,000,000. That seems reasonable and it is not very obvious that one can increase his chances of winning.</p>
<h1 id="Reasoning-about-Monty-Hall-probabilities">Reasoning about Monty Hall probabilities<a class="anchor-link" href="#Reasoning-about-Monty-Hall-probabilities">&#182;</a></h1><p>Let’s ask Imandra if 1/3 of a 1,000,000$ is the best outcome for any strategy the player can employ. To do this we’ll use Imandra <code>verify</code> directive to verify that, for any valid strategy, the scenario with equally probable prize placement gives an expected reward less or equal than 1000000/3.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-29" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="n">verify</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Real</span><span class="p">.({</span><span class="w"></span>
<span class="w">  </span><span class="n">valid_strategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="n">expected_reward</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="n">make_scenario_pmf</span><span class="p">(</span><span class="n">pDoorsEqual</span><span class="p">,</span><span class="n">strategy</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">1000000.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">3.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span>
<span class="p">}))</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[15]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : (door -&gt; choice -&gt; real) -&gt; bool = &lt;fun&gt;
module CX : sig val strategy : door -&gt; choice -&gt; Q.t end
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre>Counterexample (after 0 steps, 0.031s):
 let strategy x_0 x_1 =
   match (x_0, x_1) with
   | (DoorA, Swap) -&gt; (Real.mk_of_string &quot;3/1000000&quot;)
   | (DoorB, Stay) -&gt; (Real.mk_of_string &quot;999997/1000000&quot;)
   | _ -&gt; 0.
 
</pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><div class="imandra-vr imandra-vr-refuted"><i class="fa fa-times-circle-o"></i><span>Refuted</span></div><div><div class="imandra-alternatives" id="alt-629c1fa2-4775-434f-9ffe-f2cc3b66c1a4"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>call graph</a></li><li class="" data-toggle="tab"><a>proof-attempt</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-graphviz" id="graphviz-512892ad-6133-4bd0-b42d-89f0843c9c48"><textarea style="display: none">digraph &quot;call graph&quot; {
goal [label=&quot;not\l(not\l ((((((sko_strategy_0 DoorA Stay \&gt;=. 0 &amp;&amp; sko_strategy_0 DoorA Swap \&gt;=. 0)\l      &amp;&amp; sko_strategy_0 DoorB Stay \&gt;=. 0)\l     &amp;&amp; sko_strategy_0 DoorB Swap \&gt;=. 0)\l    &amp;&amp; sko_strategy_0 DoorC Stay \&gt;=. 0)\l   &amp;&amp; sko_strategy_0 DoorC Swap \&gt;=. 0)\l  &amp;&amp; ((((sko_strategy_0 DoorA Stay +. sko_strategy_0 DoorA Swap)\l        +. sko_strategy_0 DoorB Stay)\l       +. sko_strategy_0 DoorB Swap)\l      +. sko_strategy_0 DoorC Stay)\l     +. sko_strategy_0 DoorC Swap = 1)\l \|\| (((((1000000/3 *. sko_strategy_0 DoorA Stay\l         +. 1000000/3 *. sko_strategy_0 DoorB Stay)\l        +. 1000000/3 *. sko_strategy_0 DoorC Stay)\l       +. 2000000/3 *. sko_strategy_0 DoorA Swap)\l      +. 2000000/3 *. sko_strategy_0 DoorB Swap)\l     +. 2000000/3 *. sko_strategy_0 DoorC Swap)\l    \&lt;=. 1000000/3)&quot;,shape=box,style=filled,color=&quot;cyan&quot;,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-512892ad-6133-4bd0-b42d-89f0843c9c48';
  graphviz.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-proof-top"><div class="imandra-fold panel panel-default" id="fold-4a6dc93a-9b80-4dfc-897e-059be5ebdf80"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>proof attempt</span></div></div><div class="panel-body collapse"><div class="imandra-proof"><div class="imandra-alternatives" id="alt-5684298f-bd10-4a61-8878-77208907abb1"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>summary</a></li><li class="" data-toggle="tab"><a>full</a></li><li class="" data-toggle="tab"><a>graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-table" id="table-e42123a2-3b82-4406-b179-8a172389a553"><table><tr><td><b>ground_instances</b></td><td>0</td></tr><tr><td><b>definitions</b></td><td>0</td></tr><tr><td><b>inductions</b></td><td>0</td></tr><tr><td><b>search_time</b></td><td><pre>0.031s</pre></td></tr><tr><td><b>details</b></td><td><div class="imandra-fold panel panel-default" id="fold-318208c8-a31f-4dab-a7a7-3ec37873f0dd"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><div class="imandra-table" id="table-be200986-fc81-4cd7-a341-8b6625d59d31"><table><tr><td><b>smt_stats</b></td><td><div class="imandra-table" id="table-23f20c32-4334-4171-a3d9-5807c3b78231"><table><tr><td><b>num checks</b></td><td>1</td></tr><tr><td><b>arith assert lower</b></td><td>8</td></tr><tr><td><b>arith pivots</b></td><td>2</td></tr><tr><td><b>rlimit count</b></td><td>1557</td></tr><tr><td><b>mk clause</b></td><td>3</td></tr><tr><td><b>datatype occurs check</b></td><td>5</td></tr><tr><td><b>mk bool var</b></td><td>16</td></tr><tr><td><b>arith assert upper</b></td><td>1</td></tr><tr><td><b>arith add rows</b></td><td>2</td></tr><tr><td><b>propagations</b></td><td>2</td></tr><tr><td><b>datatype accessor ax</b></td><td>5</td></tr><tr><td><b>num allocs</b></td><td>1446403395</td></tr><tr><td><b>final checks</b></td><td>1</td></tr><tr><td><b>added eqs</b></td><td>1</td></tr><tr><td><b>del clause</b></td><td>3</td></tr><tr><td><b>arith eq adapter</b></td><td>1</td></tr><tr><td><b>memory</b></td><td>22.130000</td></tr><tr><td><b>max memory</b></td><td>24.740000</td></tr></table></div></td></tr></table></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-318208c8-a31f-4dab-a7a7-3ec37873f0dd';
  fold.hydrate(target);
});
</script></div></td></tr></table></div></div><div class="tab-pane"><div class="imandra-fold panel panel-default" id="fold-bbd2da66-cb01-411c-91d4-bf70e393bb88"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><ul><li><pre>start[0.031s]
  sko_strategy_0 DoorA Stay &gt;=. 0
  &amp;&amp; sko_strategy_0 DoorA Swap &gt;=. 0
     &amp;&amp; sko_strategy_0 DoorB Stay &gt;=. 0
        &amp;&amp; sko_strategy_0 DoorB Swap &gt;=. 0
           &amp;&amp; sko_strategy_0 DoorC Stay &gt;=. 0
              &amp;&amp; sko_strategy_0 DoorC Swap &gt;=. 0
                 &amp;&amp; ((((sko_strategy_0 DoorA Stay
                        +. sko_strategy_0 DoorA Swap)
                       +. sko_strategy_0 DoorB Stay)
                      +. sko_strategy_0 DoorB Swap)
                     +. sko_strategy_0 DoorC Stay)
                    +. sko_strategy_0 DoorC Swap = 1
  ==&gt; ((((((1 /. 3 *. sko_strategy_0 DoorA Stay)
           *. (if DoorA = DoorA then if Stay = Stay then 1000000 else 0
               else if Stay = Swap then 1000000 else 0)
           +. (1 /. 3 *. sko_strategy_0 DoorA Stay)
              *. (if DoorB = DoorA then if Stay = Stay then 1000000 else 0
                  else if … then 1000000 else 0))
          +. …)
         +. …)
        +. …)
       +. …)
      &lt;=. …</pre></li><li><div><h4>simplify</h4><div class="imandra-table" id="table-26eb56a8-eb38-4659-aee7-3dc73c8e1c9c"><table><tr><td><b>into</b></td><td><pre>not
((((((sko_strategy_0 DoorA Stay &gt;=. 0 &amp;&amp; sko_strategy_0 DoorA Swap &gt;=. 0)
     &amp;&amp; sko_strategy_0 DoorB Stay &gt;=. 0)
    &amp;&amp; sko_strategy_0 DoorB Swap &gt;=. 0)
   &amp;&amp; sko_strategy_0 DoorC Stay &gt;=. 0)
  &amp;&amp; sko_strategy_0 DoorC Swap &gt;=. 0)
 &amp;&amp; ((((sko_strategy_0 DoorA Stay +. sko_strategy_0 DoorA Swap)
       +. sko_strategy_0 DoorB Stay)
      +. sko_strategy_0 DoorB Swap)
     +. sko_strategy_0 DoorC Stay)
    +. sko_strategy_0 DoorC Swap = 1)
|| (((((1000000/3 *. sko_strategy_0 DoorA Stay
        +. 1000000/3 *. sko_strategy_0 DoorB Stay)
       +. 1000000/3 *. sko_strategy_0 DoorC Stay)
      +. 2000000/3 *. sko_strategy_0 DoorA Swap)
     +. 2000000/3 *. sko_strategy_0 DoorB Swap)
    +. 2000000/3 *. sko_strategy_0 DoorC Swap)
   &lt;=. 1000000/3</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><ul></ul></td></tr></table></div></div></li><li>Sat (Some  let strategy x_0 x_1 =
   match (x_0, x_1) with
   | (DoorA, Swap) -&gt; (Real.mk_of_string &quot;3/1000000&quot;)
   | (DoorB, Stay) -&gt; (Real.mk_of_string &quot;999997/1000000&quot;)
   | _ -&gt; 0.
 
)</li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-bbd2da66-cb01-411c-91d4-bf70e393bb88';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-02447e38-3882-41f8-89c6-9ae96f6d6e36"><textarea style="display: none">digraph &quot;proof&quot; {
p_282 [label=&quot;Start (sko_strategy_0 DoorA Stay \&gt;=. 0\l       &amp;&amp; sko_strategy_0 DoorA Swap \&gt;=. 0\l          &amp;&amp; sko_strategy_0 DoorB Stay \&gt;=. 0\l             &amp;&amp; sko_strategy_0 DoorB Swap \&gt;=. 0\l                &amp;&amp; sko_strategy_0 DoorC Stay \&gt;=. 0\l                   &amp;&amp; sko_strategy_0 DoorC Swap \&gt;=. 0\l                      &amp;&amp; ((((sko_strategy_0 DoorA Stay\l                             +. sko_strategy_0 DoorA Swap)\l                            +. sko_strategy_0 DoorB Stay)\l                           +. sko_strategy_0 DoorB Swap)\l                          +. sko_strategy_0 DoorC Stay)\l                         +. sko_strategy_0 DoorC Swap = 1\l       ==\&gt; ((((((1 /. 3 *. sko_strategy_0 DoorA Stay)\l                *. (if DoorA = DoorA then if Stay = Stay then 1000000 else 0\l                    else if Stay = Swap then 1000000 else 0)\l                +. (1 /. 3 *. sko_strategy_0 DoorA Stay)\l                   *. (if DoorB = DoorA\l                       then if Stay = Stay then 1000000 else 0\l                       else if … then 1000000 else 0))\l               +. …)\l              +. …)\l             +. …)\l            +. …)\l           \&lt;=. …\l       :time 0.031s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_282 -&gt; p_281 [label=&quot;&quot;];
p_281 [label=&quot;Simplify (not\l          ((((((sko_strategy_0 DoorA Stay \&gt;=. 0\l                &amp;&amp; sko_strategy_0 DoorA Swap \&gt;=. 0)\l               &amp;&amp; sko_strategy_0 DoorB Stay \&gt;=. 0)\l              &amp;&amp; sko_strategy_0 DoorB Swap \&gt;=. 0)\l             &amp;&amp; sko_strategy_0 DoorC Stay \&gt;=. 0)\l            &amp;&amp; sko_strategy_0 DoorC Swap \&gt;=. 0)\l           &amp;&amp; ((((sko_strategy_0 DoorA Stay +. sko_strategy_0 DoorA Swap)\l                 +. sko_strategy_0 DoorB Stay)\l                +. sko_strategy_0 DoorB Swap)\l               +. sko_strategy_0 DoorC Stay)\l              +. sko_strategy_0 DoorC Swap = 1)\l          \|\| (((((1000000/3 *. sko_strategy_0 DoorA Stay\l                  +. 1000000/3 *. sko_strategy_0 DoorB Stay)\l                 +. 1000000/3 *. sko_strategy_0 DoorC Stay)\l                +. 2000000/3 *. sko_strategy_0 DoorA Swap)\l               +. 2000000/3 *. sko_strategy_0 DoorB Swap)\l              +. 2000000/3 *. sko_strategy_0 DoorC Swap)\l             \&lt;=. 1000000/3\l          :expansions [] :rw [] :fc [])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_281 -&gt; p_280 [label=&quot;&quot;];
p_280 [label=&quot;Sat (Some  let strategy x_0 x_1 =\l   match (x_0, x_1) with\l   \| (DoorA, Swap) -\&gt; (Real.mk_of_string \&quot;3/1000000\&quot;)\l   \| (DoorB, Stay) -\&gt; (Real.mk_of_string \&quot;999997/1000000\&quot;)\l   \| _ -\&gt; 0.\l \l)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-02447e38-3882-41f8-89c6-9ae96f6d6e36';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-5684298f-bd10-4a61-8878-77208907abb1';
  alternatives.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-4a6dc93a-9b80-4dfc-897e-059be5ebdf80';
  fold.hydrate(target);
});
</script></div></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-629c1fa2-4775-434f-9ffe-f2cc3b66c1a4';
  alternatives.hydrate(target);
});
</script></div></div></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Imandra refuted our statement and provided us with a counterexample strategy. Imandra suggests that the expected reward will be greater than 1000000/3 if the player chooses <code>DoorA</code> and then <code>Swap</code>s his choice in 0.0003% of the cases. The counterexample strategy is defined in the <code>CX</code> module, so let's  see what is the expected reward with this strategy:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-31" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="n">expected_reward</span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="n">make_scenario_pmf</span><span class="p">(</span><span class="n">pDoorsEqual</span><span class="p">,</span><span class="w"> </span><span class="n">CX</span><span class="p">.</span><span class="n">strategy</span><span class="p">)</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[16]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : real = 1000003/3
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The counterexample strategy that Imandra produced increased our expected winnings by 1$. This counterexample strategy employs swapping instead of staying. What would be our expected reward if we always swap?</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-33" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">random_then_swap_strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">door</span><span class="w"> </span>: <span class="nc">door</span><span class="p">,</span><span class="n">choice</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>
<span class="w">    </span><span class="n">switch</span><span class="p">(</span><span class="n">door</span><span class="p">,</span><span class="n">choice</span><span class="p">){</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="n">Swap</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Real</span><span class="p">.(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">3.0</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="n">expected_reward</span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="n">make_scenario_pmf</span><span class="p">(</span><span class="n">pDoorsEqual</span><span class="p">,</span><span class="n">random_then_swap_strategy</span><span class="p">)</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[17]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val random_then_swap_strategy : door -&gt; choice -&gt; real = &lt;fun&gt;
- : real = 2000000/3
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>By always swapping we’ve increased our chances of winning up to 2/3. Is this the best possible expected reward one might get in this game?</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-35" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="n">verify</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Real</span><span class="p">.({</span><span class="w"></span>
<span class="w">  </span><span class="n">valid_strategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="n">expected_reward</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="n">make_scenario_pmf</span><span class="p">(</span><span class="n">pDoorsEqual</span><span class="p">,</span><span class="n">strategy</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">2000000.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">3.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span>
<span class="p">}))</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[18]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : (door -&gt; choice -&gt; real) -&gt; bool = &lt;fun&gt;
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><div class="imandra-vr imandra-vr-proved"><i class="fa fa-check-circle"></i><span>Proved</span></div><div><div class="imandra-alternatives" id="alt-2c2b5f75-f8ca-4900-82ec-93753fc4f150"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>proof</a></li><li class="" data-toggle="tab"><a>call graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-proof-top"><div class="imandra-fold panel panel-default" id="fold-0dba5021-3abb-43d4-aeae-4b5a8e4c5a45"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>proof</span></div></div><div class="panel-body collapse"><div class="imandra-proof"><div class="imandra-alternatives" id="alt-ee4a03b8-880d-4ae5-8e28-7e081cfc1de8"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>summary</a></li><li class="" data-toggle="tab"><a>full</a></li><li class="" data-toggle="tab"><a>graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-table" id="table-9be20775-8c9e-42df-a99e-a96a860536e0"><table><tr><td><b>ground_instances</b></td><td>0</td></tr><tr><td><b>definitions</b></td><td>0</td></tr><tr><td><b>inductions</b></td><td>0</td></tr><tr><td><b>search_time</b></td><td><pre>0.028s</pre></td></tr><tr><td><b>details</b></td><td><div class="imandra-fold panel panel-default" id="fold-16e445ef-fce8-4f72-903a-64ddf65f0367"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><div class="imandra-table" id="table-22412be0-2fb3-4903-9a2f-453eeff7ae1b"><table><tr><td><b>smt_stats</b></td><td><div class="imandra-table" id="table-5559f25d-d468-4eed-b93b-985a43f1f24b"><table><tr><td><b>num checks</b></td><td>1</td></tr><tr><td><b>arith assert lower</b></td><td>8</td></tr><tr><td><b>arith pivots</b></td><td>2</td></tr><tr><td><b>rlimit count</b></td><td>1538</td></tr><tr><td><b>mk clause</b></td><td>3</td></tr><tr><td><b>mk bool var</b></td><td>16</td></tr><tr><td><b>arith assert upper</b></td><td>1</td></tr><tr><td><b>arith add rows</b></td><td>2</td></tr><tr><td><b>propagations</b></td><td>2</td></tr><tr><td><b>conflicts</b></td><td>1</td></tr><tr><td><b>datatype accessor ax</b></td><td>5</td></tr><tr><td><b>arith conflicts</b></td><td>1</td></tr><tr><td><b>num allocs</b></td><td>1530433500</td></tr><tr><td><b>added eqs</b></td><td>1</td></tr><tr><td><b>arith eq adapter</b></td><td>1</td></tr><tr><td><b>memory</b></td><td>25.120000</td></tr><tr><td><b>max memory</b></td><td>25.520000</td></tr></table></div></td></tr></table></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-16e445ef-fce8-4f72-903a-64ddf65f0367';
  fold.hydrate(target);
});
</script></div></td></tr></table></div></div><div class="tab-pane"><div class="imandra-fold panel panel-default" id="fold-206a11a6-6622-4279-ac57-704e1ebcb02d"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><ul><li><pre>start[0.028s]
  sko_strategy_0 DoorA Stay &gt;=. 0
  &amp;&amp; sko_strategy_0 DoorA Swap &gt;=. 0
     &amp;&amp; sko_strategy_0 DoorB Stay &gt;=. 0
        &amp;&amp; sko_strategy_0 DoorB Swap &gt;=. 0
           &amp;&amp; sko_strategy_0 DoorC Stay &gt;=. 0
              &amp;&amp; sko_strategy_0 DoorC Swap &gt;=. 0
                 &amp;&amp; ((((sko_strategy_0 DoorA Stay
                        +. sko_strategy_0 DoorA Swap)
                       +. sko_strategy_0 DoorB Stay)
                      +. sko_strategy_0 DoorB Swap)
                     +. sko_strategy_0 DoorC Stay)
                    +. sko_strategy_0 DoorC Swap = 1
  ==&gt; ((((((1 /. 3 *. sko_strategy_0 DoorA Stay)
           *. (if DoorA = DoorA then if Stay = Stay then 1000000 else 0
               else if Stay = Swap then 1000000 else 0)
           +. (1 /. 3 *. sko_strategy_0 DoorA Stay)
              *. (if DoorB = DoorA then if Stay = Stay then 1000000 else 0
                  else if … then 1000000 else 0))
          +. …)
         +. …)
        +. …)
       +. …)
      &lt;=. …</pre></li><li><div><h4>simplify</h4><div class="imandra-table" id="table-181b4f4d-9f1b-46ca-a9a9-8549c00d5d3f"><table><tr><td><b>into</b></td><td><pre>not
((((((sko_strategy_0 DoorA Stay &gt;=. 0 &amp;&amp; sko_strategy_0 DoorA Swap &gt;=. 0)
     &amp;&amp; sko_strategy_0 DoorB Stay &gt;=. 0)
    &amp;&amp; sko_strategy_0 DoorB Swap &gt;=. 0)
   &amp;&amp; sko_strategy_0 DoorC Stay &gt;=. 0)
  &amp;&amp; sko_strategy_0 DoorC Swap &gt;=. 0)
 &amp;&amp; ((((sko_strategy_0 DoorA Stay +. sko_strategy_0 DoorA Swap)
       +. sko_strategy_0 DoorB Stay)
      +. sko_strategy_0 DoorB Swap)
     +. sko_strategy_0 DoorC Stay)
    +. sko_strategy_0 DoorC Swap = 1)
|| (((((1000000/3 *. sko_strategy_0 DoorA Stay
        +. 1000000/3 *. sko_strategy_0 DoorB Stay)
       +. 1000000/3 *. sko_strategy_0 DoorC Stay)
      +. 2000000/3 *. sko_strategy_0 DoorA Swap)
     +. 2000000/3 *. sko_strategy_0 DoorB Swap)
    +. 2000000/3 *. sko_strategy_0 DoorC Swap)
   &lt;=. 2000000/3</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><ul></ul></td></tr></table></div></div></li><li><div><h4>unsat</h4><pre>(let ((a!1 (+ (sko_strategy_0_2552 DoorA_2446 Stay_2450)
              (sko_strategy_0_2552 DoorA_24…</pre></div></li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-206a11a6-6622-4279-ac57-704e1ebcb02d';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-c5d66b15-cacc-40f8-893c-f5e6efaefb98"><textarea style="display: none">digraph &quot;proof&quot; {
p_285 [label=&quot;Start (sko_strategy_0 DoorA Stay \&gt;=. 0\l       &amp;&amp; sko_strategy_0 DoorA Swap \&gt;=. 0\l          &amp;&amp; sko_strategy_0 DoorB Stay \&gt;=. 0\l             &amp;&amp; sko_strategy_0 DoorB Swap \&gt;=. 0\l                &amp;&amp; sko_strategy_0 DoorC Stay \&gt;=. 0\l                   &amp;&amp; sko_strategy_0 DoorC Swap \&gt;=. 0\l                      &amp;&amp; ((((sko_strategy_0 DoorA Stay\l                             +. sko_strategy_0 DoorA Swap)\l                            +. sko_strategy_0 DoorB Stay)\l                           +. sko_strategy_0 DoorB Swap)\l                          +. sko_strategy_0 DoorC Stay)\l                         +. sko_strategy_0 DoorC Swap = 1\l       ==\&gt; ((((((1 /. 3 *. sko_strategy_0 DoorA Stay)\l                *. (if DoorA = DoorA then if Stay = Stay then 1000000 else 0\l                    else if Stay = Swap then 1000000 else 0)\l                +. (1 /. 3 *. sko_strategy_0 DoorA Stay)\l                   *. (if DoorB = DoorA\l                       then if Stay = Stay then 1000000 else 0\l                       else if … then 1000000 else 0))\l               +. …)\l              +. …)\l             +. …)\l            +. …)\l           \&lt;=. …\l       :time 0.028s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_285 -&gt; p_284 [label=&quot;&quot;];
p_284 [label=&quot;Simplify (not\l          ((((((sko_strategy_0 DoorA Stay \&gt;=. 0\l                &amp;&amp; sko_strategy_0 DoorA Swap \&gt;=. 0)\l               &amp;&amp; sko_strategy_0 DoorB Stay \&gt;=. 0)\l              &amp;&amp; sko_strategy_0 DoorB Swap \&gt;=. 0)\l             &amp;&amp; sko_strategy_0 DoorC Stay \&gt;=. 0)\l            &amp;&amp; sko_strategy_0 DoorC Swap \&gt;=. 0)\l           &amp;&amp; ((((sko_strategy_0 DoorA Stay +. sko_strategy_0 DoorA Swap)\l                 +. sko_strategy_0 DoorB Stay)\l                +. sko_strategy_0 DoorB Swap)\l               +. sko_strategy_0 DoorC Stay)\l              +. sko_strategy_0 DoorC Swap = 1)\l          \|\| (((((1000000/3 *. sko_strategy_0 DoorA Stay\l                  +. 1000000/3 *. sko_strategy_0 DoorB Stay)\l                 +. 1000000/3 *. sko_strategy_0 DoorC Stay)\l                +. 2000000/3 *. sko_strategy_0 DoorA Swap)\l               +. 2000000/3 *. sko_strategy_0 DoorB Swap)\l              +. 2000000/3 *. sko_strategy_0 DoorC Swap)\l             \&lt;=. 2000000/3\l          :expansions [] :rw [] :fc [])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_284 -&gt; p_283 [label=&quot;&quot;];
p_283 -&gt; p_z3_862 [label=&quot;&quot;,fontname=&quot;courier&quot;,fontsize=14];
p_z3_862 [label=&quot;(let ((a!1 (+ (sko_strategy_0_2552 DoorA_2446 Stay_2450)
              (sko_strategy_0_2552 DoorA_24…&quot;,shape=box,fontname=&quot;courier&quot;,fontsize=14];p_283 [label=&quot;unsat&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-c5d66b15-cacc-40f8-893c-f5e6efaefb98';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-ee4a03b8-880d-4ae5-8e28-7e081cfc1de8';
  alternatives.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-0dba5021-3abb-43d4-aeae-4b5a8e4c5a45';
  fold.hydrate(target);
});
</script></div></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-8f391ce5-6036-460b-b87b-b676ccbbac44"><textarea style="display: none">digraph &quot;call graph&quot; {
goal [label=&quot;not\l(not\l ((((((sko_strategy_0 DoorA Stay \&gt;=. 0 &amp;&amp; sko_strategy_0 DoorA Swap \&gt;=. 0)\l      &amp;&amp; sko_strategy_0 DoorB Stay \&gt;=. 0)\l     &amp;&amp; sko_strategy_0 DoorB Swap \&gt;=. 0)\l    &amp;&amp; sko_strategy_0 DoorC Stay \&gt;=. 0)\l   &amp;&amp; sko_strategy_0 DoorC Swap \&gt;=. 0)\l  &amp;&amp; ((((sko_strategy_0 DoorA Stay +. sko_strategy_0 DoorA Swap)\l        +. sko_strategy_0 DoorB Stay)\l       +. sko_strategy_0 DoorB Swap)\l      +. sko_strategy_0 DoorC Stay)\l     +. sko_strategy_0 DoorC Swap = 1)\l \|\| (((((1000000/3 *. sko_strategy_0 DoorA Stay\l         +. 1000000/3 *. sko_strategy_0 DoorB Stay)\l        +. 1000000/3 *. sko_strategy_0 DoorC Stay)\l       +. 2000000/3 *. sko_strategy_0 DoorA Swap)\l      +. 2000000/3 *. sko_strategy_0 DoorB Swap)\l     +. 2000000/3 *. sko_strategy_0 DoorC Swap)\l    \&lt;=. 2000000/3)&quot;,shape=box,style=filled,color=&quot;cyan&quot;,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-8f391ce5-6036-460b-b87b-b676ccbbac44';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-2c2b5f75-f8ca-4900-82ec-93753fc4f150';
  alternatives.hydrate(target);
});
</script></div></div></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We’ve proven that the best possible expected reward in the Monty Hall game is 2/3 of a $1,000,000 in an (arguably, rather counterintuitive) result that one has to always swap his first choice to double his chances of winning.</p>
<p>Suppose now that we don’t know the winning strategy, but we do know that it is possible to win in 2/3 of the cases. Can we ask Imandra to synthesise the optimal strategy? For this purpose we can use the <code>instance</code> directive:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-37" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="n">instance</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Real</span><span class="p">.({</span><span class="w"></span>
<span class="w">  </span><span class="n">valid_strategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="n">expected_reward</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="n">make_scenario_pmf</span><span class="p">(</span><span class="n">pDoorsEqual</span><span class="p">,</span><span class="n">strategy</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">2000000.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">3.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span>
<span class="p">}))</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[19]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : (door -&gt; choice -&gt; real) -&gt; bool = &lt;fun&gt;
module CX : sig val strategy : door -&gt; choice -&gt; Q.t end
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre>Instance (after 0 steps, 0.031s):
 let strategy x_0 x_1 =
   match (x_0, x_1) with
   | (DoorA, Swap) -&gt; 1.
   | _ -&gt; 0.
 
</pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><div class="imandra-vr imandra-vr-proved"><i class="fa fa-check-circle"></i><span>Instance</span></div><div><div class="imandra-alternatives" id="alt-ab0baabf-f44e-480b-9c13-e653bc9e21ac"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>call graph</a></li><li class="" data-toggle="tab"><a>proof-attempt</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-graphviz" id="graphviz-006c4f95-39c4-451e-834e-52aed57b2325"><textarea style="display: none">digraph &quot;call graph&quot; {
goal [label=&quot;((((((sko_strategy_0 DoorA Stay \&gt;=. 0 &amp;&amp; sko_strategy_0 DoorA Swap \&gt;=. 0)\l     &amp;&amp; sko_strategy_0 DoorB Stay \&gt;=. 0)\l    &amp;&amp; sko_strategy_0 DoorB Swap \&gt;=. 0)\l   &amp;&amp; sko_strategy_0 DoorC Stay \&gt;=. 0)\l  &amp;&amp; sko_strategy_0 DoorC Swap \&gt;=. 0)\l &amp;&amp; ((((sko_strategy_0 DoorA Stay +. sko_strategy_0 DoorA Swap)\l       +. sko_strategy_0 DoorB Stay)\l      +. sko_strategy_0 DoorB Swap)\l     +. sko_strategy_0 DoorC Stay)\l    +. sko_strategy_0 DoorC Swap = 1)\l&amp;&amp; ((((1000000/3 *. sko_strategy_0 DoorA Stay\l       +. 1000000/3 *. sko_strategy_0 DoorB Stay)\l      +. 1000000/3 *. sko_strategy_0 DoorC Stay)\l     +. 2000000/3 *. sko_strategy_0 DoorA Swap)\l    +. 2000000/3 *. sko_strategy_0 DoorB Swap)\l   +. 2000000/3 *. sko_strategy_0 DoorC Swap = 2000000/3&quot;,shape=box,style=filled,color=&quot;cyan&quot;,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-006c4f95-39c4-451e-834e-52aed57b2325';
  graphviz.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-proof-top"><div class="imandra-fold panel panel-default" id="fold-703a65d3-db62-4504-b855-2da9c92e7f39"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>proof attempt</span></div></div><div class="panel-body collapse"><div class="imandra-proof"><div class="imandra-alternatives" id="alt-1c339e8d-3bf9-47c1-a23a-6d7ef728eb30"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>summary</a></li><li class="" data-toggle="tab"><a>full</a></li><li class="" data-toggle="tab"><a>graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-table" id="table-0347bc23-53ef-4e44-85a7-efaf35f8166e"><table><tr><td><b>ground_instances</b></td><td>0</td></tr><tr><td><b>definitions</b></td><td>0</td></tr><tr><td><b>inductions</b></td><td>0</td></tr><tr><td><b>search_time</b></td><td><pre>0.031s</pre></td></tr><tr><td><b>details</b></td><td><div class="imandra-fold panel panel-default" id="fold-3b72c872-21d6-4ef9-b2d3-521e22616768"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><div class="imandra-table" id="table-e662cd14-c3aa-4604-a6b2-4e203fa46c52"><table><tr><td><b>smt_stats</b></td><td><div class="imandra-table" id="table-7b753e12-3b8d-42e9-86f5-6c2d840ece5c"><table><tr><td><b>num checks</b></td><td>1</td></tr><tr><td><b>arith assert lower</b></td><td>8</td></tr><tr><td><b>arith pivots</b></td><td>2</td></tr><tr><td><b>rlimit count</b></td><td>1547</td></tr><tr><td><b>mk clause</b></td><td>6</td></tr><tr><td><b>datatype occurs check</b></td><td>5</td></tr><tr><td><b>mk bool var</b></td><td>18</td></tr><tr><td><b>arith assert upper</b></td><td>2</td></tr><tr><td><b>arith add rows</b></td><td>2</td></tr><tr><td><b>propagations</b></td><td>4</td></tr><tr><td><b>datatype accessor ax</b></td><td>5</td></tr><tr><td><b>num allocs</b></td><td>1621657399</td></tr><tr><td><b>final checks</b></td><td>1</td></tr><tr><td><b>added eqs</b></td><td>2</td></tr><tr><td><b>del clause</b></td><td>6</td></tr><tr><td><b>arith eq adapter</b></td><td>2</td></tr><tr><td><b>memory</b></td><td>28.160000</td></tr><tr><td><b>max memory</b></td><td>28.650000</td></tr></table></div></td></tr></table></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-3b72c872-21d6-4ef9-b2d3-521e22616768';
  fold.hydrate(target);
});
</script></div></td></tr></table></div></div><div class="tab-pane"><div class="imandra-fold panel panel-default" id="fold-fa7eaa1f-8487-4461-9c13-44a1ee370bfd"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><ul><li><pre>start[0.031s]
  (sko_strategy_0 DoorA Stay &gt;=. 0
   &amp;&amp; sko_strategy_0 DoorA Swap &gt;=. 0
      &amp;&amp; sko_strategy_0 DoorB Stay &gt;=. 0
         &amp;&amp; sko_strategy_0 DoorB Swap &gt;=. 0
            &amp;&amp; sko_strategy_0 DoorC Stay &gt;=. 0
               &amp;&amp; sko_strategy_0 DoorC Swap &gt;=. 0
                  &amp;&amp; ((((sko_strategy_0 DoorA Stay
                         +. sko_strategy_0 DoorA Swap)
                        +. sko_strategy_0 DoorB Stay)
                       +. sko_strategy_0 DoorB Swap)
                      +. sko_strategy_0 DoorC Stay)
                     +. sko_strategy_0 DoorC Swap = 1)
  &amp;&amp; (((((1 /. 3 *. sko_strategy_0 DoorA Stay)
         *. (if DoorA = DoorA then if Stay = Stay then 1000000 else 0
             else if Stay = Swap then 1000000 else 0)
         +. (1 /. 3 *. sko_strategy_0 DoorA Stay)
            *. (if DoorB = DoorA then if Stay = Stay then 1000000 else 0
                else if … then 1000000 else 0))
        +. …)
       +. …)
      +. …)
     +. … = …</pre></li><li><div><h4>simplify</h4><div class="imandra-table" id="table-d2bd5b76-e539-44e6-8fe1-c75bd5137e05"><table><tr><td><b>into</b></td><td><pre>((((((sko_strategy_0 DoorA Stay &gt;=. 0 &amp;&amp; sko_strategy_0 DoorA Swap &gt;=. 0)
     &amp;&amp; sko_strategy_0 DoorB Stay &gt;=. 0)
    &amp;&amp; sko_strategy_0 DoorB Swap &gt;=. 0)
   &amp;&amp; sko_strategy_0 DoorC Stay &gt;=. 0)
  &amp;&amp; sko_strategy_0 DoorC Swap &gt;=. 0)
 &amp;&amp; ((((sko_strategy_0 DoorA Stay +. sko_strategy_0 DoorA Swap)
       +. sko_strategy_0 DoorB Stay)
      +. sko_strategy_0 DoorB Swap)
     +. sko_strategy_0 DoorC Stay)
    +. sko_strategy_0 DoorC Swap = 1)
&amp;&amp; ((((1000000/3 *. sko_strategy_0 DoorA Stay
       +. 1000000/3 *. sko_strategy_0 DoorB Stay)
      +. 1000000/3 *. sko_strategy_0 DoorC Stay)
     +. 2000000/3 *. sko_strategy_0 DoorA Swap)
    +. 2000000/3 *. sko_strategy_0 DoorB Swap)
   +. 2000000/3 *. sko_strategy_0 DoorC Swap = 2000000/3</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><ul></ul></td></tr></table></div></div></li><li>Sat (Some  let strategy x_0 x_1 =
   match (x_0, x_1) with
   | (DoorA, Swap) -&gt; 1.
   | _ -&gt; 0.
 
)</li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-fa7eaa1f-8487-4461-9c13-44a1ee370bfd';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-a113680f-ed7e-4646-a3d9-280decc8c459"><textarea style="display: none">digraph &quot;proof&quot; {
p_288 [label=&quot;Start ((sko_strategy_0 DoorA Stay \&gt;=. 0\l        &amp;&amp; sko_strategy_0 DoorA Swap \&gt;=. 0\l           &amp;&amp; sko_strategy_0 DoorB Stay \&gt;=. 0\l              &amp;&amp; sko_strategy_0 DoorB Swap \&gt;=. 0\l                 &amp;&amp; sko_strategy_0 DoorC Stay \&gt;=. 0\l                    &amp;&amp; sko_strategy_0 DoorC Swap \&gt;=. 0\l                       &amp;&amp; ((((sko_strategy_0 DoorA Stay\l                              +. sko_strategy_0 DoorA Swap)\l                             +. sko_strategy_0 DoorB Stay)\l                            +. sko_strategy_0 DoorB Swap)\l                           +. sko_strategy_0 DoorC Stay)\l                          +. sko_strategy_0 DoorC Swap = 1)\l       &amp;&amp; (((((1 /. 3 *. sko_strategy_0 DoorA Stay)\l              *. (if DoorA = DoorA then if Stay = Stay then 1000000 else 0\l                  else if Stay = Swap then 1000000 else 0)\l              +. (1 /. 3 *. sko_strategy_0 DoorA Stay)\l                 *. (if DoorB = DoorA then if Stay = Stay then 1000000 else 0\l                     else if … then 1000000 else 0))\l             +. …)\l            +. …)\l           +. …)\l          +. … = …\l       :time 0.031s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_288 -&gt; p_287 [label=&quot;&quot;];
p_287 [label=&quot;Simplify (((((((sko_strategy_0 DoorA Stay \&gt;=. 0\l                &amp;&amp; sko_strategy_0 DoorA Swap \&gt;=. 0)\l               &amp;&amp; sko_strategy_0 DoorB Stay \&gt;=. 0)\l              &amp;&amp; sko_strategy_0 DoorB Swap \&gt;=. 0)\l             &amp;&amp; sko_strategy_0 DoorC Stay \&gt;=. 0)\l            &amp;&amp; sko_strategy_0 DoorC Swap \&gt;=. 0)\l           &amp;&amp; ((((sko_strategy_0 DoorA Stay +. sko_strategy_0 DoorA Swap)\l                 +. sko_strategy_0 DoorB Stay)\l                +. sko_strategy_0 DoorB Swap)\l               +. sko_strategy_0 DoorC Stay)\l              +. sko_strategy_0 DoorC Swap = 1)\l          &amp;&amp; ((((1000000/3 *. sko_strategy_0 DoorA Stay\l                 +. 1000000/3 *. sko_strategy_0 DoorB Stay)\l                +. 1000000/3 *. sko_strategy_0 DoorC Stay)\l               +. 2000000/3 *. sko_strategy_0 DoorA Swap)\l              +. 2000000/3 *. sko_strategy_0 DoorB Swap)\l             +. 2000000/3 *. sko_strategy_0 DoorC Swap = 2000000/3\l          :expansions [] :rw [] :fc [])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_287 -&gt; p_286 [label=&quot;&quot;];
p_286 [label=&quot;Sat (Some  let strategy x_0 x_1 =\l   match (x_0, x_1) with\l   \| (DoorA, Swap) -\&gt; 1.\l   \| _ -\&gt; 0.\l \l)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-a113680f-ed7e-4646-a3d9-280decc8c459';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-1c339e8d-3bf9-47c1-a23a-6d7ef728eb30';
  alternatives.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-703a65d3-db62-4504-b855-2da9c92e7f39';
  fold.hydrate(target);
});
</script></div></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-ab0baabf-f44e-480b-9c13-e653bc9e21ac';
  alternatives.hydrate(target);
});
</script></div></div></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We've got an example of an optimal strategy - this one doesn't randomize over doors, but suggests to always choose the DoorA and then swap.</p>
<h1 id="Biased-Monty-Hall">Biased Monty Hall<a class="anchor-link" href="#Biased-Monty-Hall">&#182;</a></h1><p>Now let's apply what we've learned about the "standard" Monty Hall paradox to a more complicated game setup - suppose that we somehow know that the host is biased towards the <code>DoorA</code> -- the probability that the host will hide the prize behind the first door is 3 times higher than the individual probabilities for two other doors. Should one still always swap? Or, maybe, it makes more sense to always choose the more likely <code>DoorA</code> and stay?</p>
<p>We encode our biased host in the biased PMF over doors (also doing a sanity check that it is a valid probability distribution):</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-39" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">pDoorsBiased</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">door</span><span class="w"> </span>: <span class="nc">door</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Real</span><span class="p">.(</span><span class="w"></span>
<span class="w">  </span><span class="n">switch</span><span class="w"> </span><span class="p">(</span><span class="n">door</span><span class="p">){</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">DoorA</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mf">3.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">5.0</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">DoorB</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">DoorC</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">5.0</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>

<span class="n">valid_door_pmf</span><span class="p">(</span><span class="n">pDoorsBiased</span><span class="p">)</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[20]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val pDoorsBiased : door -&gt; real = &lt;fun&gt;
- : bool = true
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In the previous section, we've proven that the maximal possible expected reward in the "standard" Monty Hall problem is 2/3 of a million. Again, we ask Imandra whether we can improve on this in the biased case:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-41" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="n">verify</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Real</span><span class="p">.({</span><span class="w"></span>
<span class="w">  </span><span class="n">valid_strategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="n">expected_reward</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="n">make_scenario_pmf</span><span class="p">(</span><span class="n">pDoorsBiased</span><span class="p">,</span><span class="n">strategy</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">2000000.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">3.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span>
<span class="p">}))</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[21]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : (door -&gt; choice -&gt; real) -&gt; bool = &lt;fun&gt;
module CX : sig val strategy : door -&gt; choice -&gt; Q.t end
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre>Counterexample (after 0 steps, 0.031s):
 let strategy x_0 x_1 =
   match (x_0, x_1) with
   | (DoorA, Stay) -&gt; (Real.mk_of_string &quot;399997/600000&quot;)
   | (DoorC, Swap) -&gt; (Real.mk_of_string &quot;200003/600000&quot;)
   | _ -&gt; 0.
 
</pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><div class="imandra-vr imandra-vr-refuted"><i class="fa fa-times-circle-o"></i><span>Refuted</span></div><div><div class="imandra-alternatives" id="alt-982ceb00-ff96-407e-9bb3-6e6066d460f5"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>call graph</a></li><li class="" data-toggle="tab"><a>proof-attempt</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-graphviz" id="graphviz-edd296bb-8570-43bd-a51b-480d713710b8"><textarea style="display: none">digraph &quot;call graph&quot; {
goal [label=&quot;not\l(not\l ((((((sko_strategy_0 DoorA Stay \&gt;=. 0 &amp;&amp; sko_strategy_0 DoorA Swap \&gt;=. 0)\l      &amp;&amp; sko_strategy_0 DoorB Stay \&gt;=. 0)\l     &amp;&amp; sko_strategy_0 DoorB Swap \&gt;=. 0)\l    &amp;&amp; sko_strategy_0 DoorC Stay \&gt;=. 0)\l   &amp;&amp; sko_strategy_0 DoorC Swap \&gt;=. 0)\l  &amp;&amp; ((((sko_strategy_0 DoorA Stay +. sko_strategy_0 DoorA Swap)\l        +. sko_strategy_0 DoorB Stay)\l       +. sko_strategy_0 DoorB Swap)\l      +. sko_strategy_0 DoorC Stay)\l     +. sko_strategy_0 DoorC Swap = 1)\l \|\| (((((600000 *. sko_strategy_0 DoorA Stay\l         +. 200000 *. sko_strategy_0 DoorB Stay)\l        +. 200000 *. sko_strategy_0 DoorC Stay)\l       +. 400000 *. sko_strategy_0 DoorA Swap)\l      +. 800000 *. sko_strategy_0 DoorB Swap)\l     +. 800000 *. sko_strategy_0 DoorC Swap)\l    \&lt;=. 2000000/3)&quot;,shape=box,style=filled,color=&quot;cyan&quot;,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-edd296bb-8570-43bd-a51b-480d713710b8';
  graphviz.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-proof-top"><div class="imandra-fold panel panel-default" id="fold-23e9b5e5-f718-484f-a147-75a840fe5cec"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>proof attempt</span></div></div><div class="panel-body collapse"><div class="imandra-proof"><div class="imandra-alternatives" id="alt-c242a0f3-cb80-491d-b670-e8184eb77529"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>summary</a></li><li class="" data-toggle="tab"><a>full</a></li><li class="" data-toggle="tab"><a>graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-table" id="table-24512dcd-4a84-469b-968c-23529054e292"><table><tr><td><b>ground_instances</b></td><td>0</td></tr><tr><td><b>definitions</b></td><td>0</td></tr><tr><td><b>inductions</b></td><td>0</td></tr><tr><td><b>search_time</b></td><td><pre>0.031s</pre></td></tr><tr><td><b>details</b></td><td><div class="imandra-fold panel panel-default" id="fold-4d5d5372-8aa6-4d35-9a3f-74f7159231ee"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><div class="imandra-table" id="table-7606384e-b393-4678-b44d-2ae5510d62d4"><table><tr><td><b>smt_stats</b></td><td><div class="imandra-table" id="table-8f1a95f7-66b9-4920-bda4-d06403745524"><table><tr><td><b>num checks</b></td><td>1</td></tr><tr><td><b>arith assert lower</b></td><td>8</td></tr><tr><td><b>arith pivots</b></td><td>3</td></tr><tr><td><b>rlimit count</b></td><td>1857</td></tr><tr><td><b>mk clause</b></td><td>3</td></tr><tr><td><b>datatype occurs check</b></td><td>5</td></tr><tr><td><b>mk bool var</b></td><td>16</td></tr><tr><td><b>arith assert upper</b></td><td>1</td></tr><tr><td><b>arith add rows</b></td><td>3</td></tr><tr><td><b>propagations</b></td><td>2</td></tr><tr><td><b>datatype accessor ax</b></td><td>5</td></tr><tr><td><b>num allocs</b></td><td>1714937004</td></tr><tr><td><b>final checks</b></td><td>1</td></tr><tr><td><b>added eqs</b></td><td>1</td></tr><tr><td><b>del clause</b></td><td>3</td></tr><tr><td><b>arith eq adapter</b></td><td>1</td></tr><tr><td><b>memory</b></td><td>31.180000</td></tr><tr><td><b>max memory</b></td><td>31.670000</td></tr></table></div></td></tr></table></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-4d5d5372-8aa6-4d35-9a3f-74f7159231ee';
  fold.hydrate(target);
});
</script></div></td></tr></table></div></div><div class="tab-pane"><div class="imandra-fold panel panel-default" id="fold-2abc50e4-607f-494a-bbc2-454bca10a353"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><ul><li><pre>start[0.031s]
  sko_strategy_0 DoorA Stay &gt;=. 0
  &amp;&amp; sko_strategy_0 DoorA Swap &gt;=. 0
     &amp;&amp; sko_strategy_0 DoorB Stay &gt;=. 0
        &amp;&amp; sko_strategy_0 DoorB Swap &gt;=. 0
           &amp;&amp; sko_strategy_0 DoorC Stay &gt;=. 0
              &amp;&amp; sko_strategy_0 DoorC Swap &gt;=. 0
                 &amp;&amp; ((((sko_strategy_0 DoorA Stay
                        +. sko_strategy_0 DoorA Swap)
                       +. sko_strategy_0 DoorB Stay)
                      +. sko_strategy_0 DoorB Swap)
                     +. sko_strategy_0 DoorC Stay)
                    +. sko_strategy_0 DoorC Swap = 1
  ==&gt; (((((((if DoorA = DoorA then 3 /. 5 else 1 /. 5)
            *. sko_strategy_0 DoorA Stay)
           *. (if DoorA = DoorA then if Stay = Stay then 1000000 else 0
               else if Stay = Swap then 1000000 else 0)
           +. ((if DoorB = DoorA then 3 /. 5 else 1 /. 5)
               *. sko_strategy_0 DoorA Stay)
              *. (if … then … else …))
          +. …)
         +. …)
        +. …)
       +. …)
      &lt;=. …</pre></li><li><div><h4>simplify</h4><div class="imandra-table" id="table-e1f37363-453e-426c-8bb0-73a6ecca789e"><table><tr><td><b>into</b></td><td><pre>not
((((((sko_strategy_0 DoorA Stay &gt;=. 0 &amp;&amp; sko_strategy_0 DoorA Swap &gt;=. 0)
     &amp;&amp; sko_strategy_0 DoorB Stay &gt;=. 0)
    &amp;&amp; sko_strategy_0 DoorB Swap &gt;=. 0)
   &amp;&amp; sko_strategy_0 DoorC Stay &gt;=. 0)
  &amp;&amp; sko_strategy_0 DoorC Swap &gt;=. 0)
 &amp;&amp; ((((sko_strategy_0 DoorA Stay +. sko_strategy_0 DoorA Swap)
       +. sko_strategy_0 DoorB Stay)
      +. sko_strategy_0 DoorB Swap)
     +. sko_strategy_0 DoorC Stay)
    +. sko_strategy_0 DoorC Swap = 1)
|| (((((600000 *. sko_strategy_0 DoorA Stay
        +. 200000 *. sko_strategy_0 DoorB Stay)
       +. 200000 *. sko_strategy_0 DoorC Stay)
      +. 400000 *. sko_strategy_0 DoorA Swap)
     +. 800000 *. sko_strategy_0 DoorB Swap)
    +. 800000 *. sko_strategy_0 DoorC Swap)
   &lt;=. 2000000/3</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><ul></ul></td></tr></table></div></div></li><li>Sat (Some  let strategy x_0 x_1 =
   match (x_0, x_1) with
   | (DoorA, Stay) -&gt; (Real.mk_of_string &quot;399997/600000&quot;)
   | (DoorC, Swap) -&gt; (Real.mk_of_string &quot;200003/600000&quot;)
   | _ -&gt; 0.
 
)</li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-2abc50e4-607f-494a-bbc2-454bca10a353';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-245d0bc7-13dc-46e7-9013-09aa198961a4"><textarea style="display: none">digraph &quot;proof&quot; {
p_291 [label=&quot;Start (sko_strategy_0 DoorA Stay \&gt;=. 0\l       &amp;&amp; sko_strategy_0 DoorA Swap \&gt;=. 0\l          &amp;&amp; sko_strategy_0 DoorB Stay \&gt;=. 0\l             &amp;&amp; sko_strategy_0 DoorB Swap \&gt;=. 0\l                &amp;&amp; sko_strategy_0 DoorC Stay \&gt;=. 0\l                   &amp;&amp; sko_strategy_0 DoorC Swap \&gt;=. 0\l                      &amp;&amp; ((((sko_strategy_0 DoorA Stay\l                             +. sko_strategy_0 DoorA Swap)\l                            +. sko_strategy_0 DoorB Stay)\l                           +. sko_strategy_0 DoorB Swap)\l                          +. sko_strategy_0 DoorC Stay)\l                         +. sko_strategy_0 DoorC Swap = 1\l       ==\&gt; (((((((if DoorA = DoorA then 3 /. 5 else 1 /. 5)\l                 *. sko_strategy_0 DoorA Stay)\l                *. (if DoorA = DoorA then if Stay = Stay then 1000000 else 0\l                    else if Stay = Swap then 1000000 else 0)\l                +. ((if DoorB = DoorA then 3 /. 5 else 1 /. 5)\l                    *. sko_strategy_0 DoorA Stay)\l                   *. (if … then … else …))\l               +. …)\l              +. …)\l             +. …)\l            +. …)\l           \&lt;=. …\l       :time 0.031s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_291 -&gt; p_290 [label=&quot;&quot;];
p_290 [label=&quot;Simplify (not\l          ((((((sko_strategy_0 DoorA Stay \&gt;=. 0\l                &amp;&amp; sko_strategy_0 DoorA Swap \&gt;=. 0)\l               &amp;&amp; sko_strategy_0 DoorB Stay \&gt;=. 0)\l              &amp;&amp; sko_strategy_0 DoorB Swap \&gt;=. 0)\l             &amp;&amp; sko_strategy_0 DoorC Stay \&gt;=. 0)\l            &amp;&amp; sko_strategy_0 DoorC Swap \&gt;=. 0)\l           &amp;&amp; ((((sko_strategy_0 DoorA Stay +. sko_strategy_0 DoorA Swap)\l                 +. sko_strategy_0 DoorB Stay)\l                +. sko_strategy_0 DoorB Swap)\l               +. sko_strategy_0 DoorC Stay)\l              +. sko_strategy_0 DoorC Swap = 1)\l          \|\| (((((600000 *. sko_strategy_0 DoorA Stay\l                  +. 200000 *. sko_strategy_0 DoorB Stay)\l                 +. 200000 *. sko_strategy_0 DoorC Stay)\l                +. 400000 *. sko_strategy_0 DoorA Swap)\l               +. 800000 *. sko_strategy_0 DoorB Swap)\l              +. 800000 *. sko_strategy_0 DoorC Swap)\l             \&lt;=. 2000000/3\l          :expansions [] :rw [] :fc [])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_290 -&gt; p_289 [label=&quot;&quot;];
p_289 [label=&quot;Sat (Some  let strategy x_0 x_1 =\l   match (x_0, x_1) with\l   \| (DoorA, Stay) -\&gt; (Real.mk_of_string \&quot;399997/600000\&quot;)\l   \| (DoorC, Swap) -\&gt; (Real.mk_of_string \&quot;200003/600000\&quot;)\l   \| _ -\&gt; 0.\l \l)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-245d0bc7-13dc-46e7-9013-09aa198961a4';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-c242a0f3-cb80-491d-b670-e8184eb77529';
  alternatives.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-23e9b5e5-f718-484f-a147-75a840fe5cec';
  fold.hydrate(target);
});
</script></div></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-982ceb00-ff96-407e-9bb3-6e6066d460f5';
  alternatives.hydrate(target);
});
</script></div></div></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Imandra suggests that we can do better than 2/3 if we use a mixed strategy of either choosing the <code>DoorA</code> and staying or choosing the <code>DoorC</code> and swapping. Let's test both of these pure strategies and see what would be the expected rewards for each:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-43" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">aStayStrategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">door</span><span class="p">,</span><span class="n">choice</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>
<span class="w">    </span><span class="n">switch</span><span class="p">(</span><span class="n">door</span><span class="p">,</span><span class="n">choice</span><span class="p">){</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">DoorA</span><span class="p">,</span><span class="n">Stay</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="n">expected_reward</span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="n">make_scenario_pmf</span><span class="p">(</span><span class="n">pDoorsBiased</span><span class="p">,</span><span class="n">aStayStrategy</span><span class="p">)</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">cSwapStrategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">door</span><span class="p">,</span><span class="n">choice</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>
<span class="w">    </span><span class="n">switch</span><span class="p">(</span><span class="n">door</span><span class="p">,</span><span class="n">choice</span><span class="p">){</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">DoorC</span><span class="p">,</span><span class="n">Swap</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="n">expected_reward</span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="n">make_scenario_pmf</span><span class="p">(</span><span class="n">pDoorsBiased</span><span class="p">,</span><span class="n">cSwapStrategy</span><span class="p">)</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[22]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val aStayStrategy : door -&gt; choice -&gt; Q.t = &lt;fun&gt;
- : real = 600000
val cSwapStrategy : door -&gt; choice -&gt; Q.t = &lt;fun&gt;
- : real = 800000
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Choosing the <code>DoorC</code> and then swapping increases the chances of winning up to 80%! Again, is this the best outcome one can get?</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-45" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="n">verify</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Real</span><span class="p">.({</span><span class="w"></span>
<span class="w">  </span><span class="n">valid_strategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="n">expected_reward</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="n">make_scenario_pmf</span><span class="p">(</span><span class="n">pDoorsBiased</span><span class="p">,</span><span class="n">strategy</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">800000.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span>
<span class="p">}))</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[23]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : (door -&gt; choice -&gt; real) -&gt; bool = &lt;fun&gt;
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><div class="imandra-vr imandra-vr-proved"><i class="fa fa-check-circle"></i><span>Proved</span></div><div><div class="imandra-alternatives" id="alt-abf2d503-0d30-46c1-a2bf-198abe8a7279"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>proof</a></li><li class="" data-toggle="tab"><a>call graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-proof-top"><div class="imandra-fold panel panel-default" id="fold-72753795-6531-4492-9ab0-d9199c2771e7"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>proof</span></div></div><div class="panel-body collapse"><div class="imandra-proof"><div class="imandra-alternatives" id="alt-8f8d416d-dfd2-49dd-9a0b-29f6823b5cea"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>summary</a></li><li class="" data-toggle="tab"><a>full</a></li><li class="" data-toggle="tab"><a>graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-table" id="table-7bbb26eb-e1dd-4e69-b635-7561ed65f678"><table><tr><td><b>ground_instances</b></td><td>0</td></tr><tr><td><b>definitions</b></td><td>0</td></tr><tr><td><b>inductions</b></td><td>0</td></tr><tr><td><b>search_time</b></td><td><pre>0.030s</pre></td></tr><tr><td><b>details</b></td><td><div class="imandra-fold panel panel-default" id="fold-4a02a593-baa5-44fa-8e45-fdd52ae3d76f"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><div class="imandra-table" id="table-931515c5-1345-4240-b39e-b736f6a2b628"><table><tr><td><b>smt_stats</b></td><td><div class="imandra-table" id="table-6f5ac6cc-d77b-40c4-ba7c-d789a9a043dc"><table><tr><td><b>num checks</b></td><td>1</td></tr><tr><td><b>arith assert lower</b></td><td>8</td></tr><tr><td><b>arith pivots</b></td><td>3</td></tr><tr><td><b>rlimit count</b></td><td>1836</td></tr><tr><td><b>mk clause</b></td><td>3</td></tr><tr><td><b>mk bool var</b></td><td>16</td></tr><tr><td><b>arith assert upper</b></td><td>1</td></tr><tr><td><b>arith add rows</b></td><td>3</td></tr><tr><td><b>propagations</b></td><td>2</td></tr><tr><td><b>conflicts</b></td><td>1</td></tr><tr><td><b>datatype accessor ax</b></td><td>5</td></tr><tr><td><b>arith conflicts</b></td><td>1</td></tr><tr><td><b>num allocs</b></td><td>1808854675</td></tr><tr><td><b>added eqs</b></td><td>1</td></tr><tr><td><b>arith eq adapter</b></td><td>1</td></tr><tr><td><b>memory</b></td><td>34.190000</td></tr><tr><td><b>max memory</b></td><td>34.590000</td></tr></table></div></td></tr></table></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-4a02a593-baa5-44fa-8e45-fdd52ae3d76f';
  fold.hydrate(target);
});
</script></div></td></tr></table></div></div><div class="tab-pane"><div class="imandra-fold panel panel-default" id="fold-ff68340b-d2d0-4bb7-9aea-ecac0e1992da"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><ul><li><pre>start[0.030s]
  sko_strategy_0 DoorA Stay &gt;=. 0
  &amp;&amp; sko_strategy_0 DoorA Swap &gt;=. 0
     &amp;&amp; sko_strategy_0 DoorB Stay &gt;=. 0
        &amp;&amp; sko_strategy_0 DoorB Swap &gt;=. 0
           &amp;&amp; sko_strategy_0 DoorC Stay &gt;=. 0
              &amp;&amp; sko_strategy_0 DoorC Swap &gt;=. 0
                 &amp;&amp; ((((sko_strategy_0 DoorA Stay
                        +. sko_strategy_0 DoorA Swap)
                       +. sko_strategy_0 DoorB Stay)
                      +. sko_strategy_0 DoorB Swap)
                     +. sko_strategy_0 DoorC Stay)
                    +. sko_strategy_0 DoorC Swap = 1
  ==&gt; (((((((if DoorA = DoorA then 3 /. 5 else 1 /. 5)
            *. sko_strategy_0 DoorA Stay)
           *. (if DoorA = DoorA then if Stay = Stay then 1000000 else 0
               else if Stay = Swap then 1000000 else 0)
           +. ((if DoorB = DoorA then 3 /. 5 else 1 /. 5)
               *. sko_strategy_0 DoorA Stay)
              *. (if … then … else …))
          +. …)
         +. …)
        +. …)
       +. …)
      &lt;=. 800000</pre></li><li><div><h4>simplify</h4><div class="imandra-table" id="table-38c865ee-3682-4f2d-adca-0e814599853d"><table><tr><td><b>into</b></td><td><pre>not
((((((sko_strategy_0 DoorA Stay &gt;=. 0 &amp;&amp; sko_strategy_0 DoorA Swap &gt;=. 0)
     &amp;&amp; sko_strategy_0 DoorB Stay &gt;=. 0)
    &amp;&amp; sko_strategy_0 DoorB Swap &gt;=. 0)
   &amp;&amp; sko_strategy_0 DoorC Stay &gt;=. 0)
  &amp;&amp; sko_strategy_0 DoorC Swap &gt;=. 0)
 &amp;&amp; ((((sko_strategy_0 DoorA Stay +. sko_strategy_0 DoorA Swap)
       +. sko_strategy_0 DoorB Stay)
      +. sko_strategy_0 DoorB Swap)
     +. sko_strategy_0 DoorC Stay)
    +. sko_strategy_0 DoorC Swap = 1)
|| (((((600000 *. sko_strategy_0 DoorA Stay
        +. 200000 *. sko_strategy_0 DoorB Stay)
       +. 200000 *. sko_strategy_0 DoorC Stay)
      +. 400000 *. sko_strategy_0 DoorA Swap)
     +. 800000 *. sko_strategy_0 DoorB Swap)
    +. 800000 *. sko_strategy_0 DoorC Swap)
   &lt;=. 800000</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><ul></ul></td></tr></table></div></div></li><li><div><h4>unsat</h4><pre>(let ((a!1 (+ (* 600000.0 (sko_strategy_0_2662 DoorA_2446 Stay_2450))
              (* 200000.0 (sko…</pre></div></li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-ff68340b-d2d0-4bb7-9aea-ecac0e1992da';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-39fb3ff0-c6cf-4be5-814c-c940e438a795"><textarea style="display: none">digraph &quot;proof&quot; {
p_294 [label=&quot;Start (sko_strategy_0 DoorA Stay \&gt;=. 0\l       &amp;&amp; sko_strategy_0 DoorA Swap \&gt;=. 0\l          &amp;&amp; sko_strategy_0 DoorB Stay \&gt;=. 0\l             &amp;&amp; sko_strategy_0 DoorB Swap \&gt;=. 0\l                &amp;&amp; sko_strategy_0 DoorC Stay \&gt;=. 0\l                   &amp;&amp; sko_strategy_0 DoorC Swap \&gt;=. 0\l                      &amp;&amp; ((((sko_strategy_0 DoorA Stay\l                             +. sko_strategy_0 DoorA Swap)\l                            +. sko_strategy_0 DoorB Stay)\l                           +. sko_strategy_0 DoorB Swap)\l                          +. sko_strategy_0 DoorC Stay)\l                         +. sko_strategy_0 DoorC Swap = 1\l       ==\&gt; (((((((if DoorA = DoorA then 3 /. 5 else 1 /. 5)\l                 *. sko_strategy_0 DoorA Stay)\l                *. (if DoorA = DoorA then if Stay = Stay then 1000000 else 0\l                    else if Stay = Swap then 1000000 else 0)\l                +. ((if DoorB = DoorA then 3 /. 5 else 1 /. 5)\l                    *. sko_strategy_0 DoorA Stay)\l                   *. (if … then … else …))\l               +. …)\l              +. …)\l             +. …)\l            +. …)\l           \&lt;=. 800000\l       :time 0.030s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_294 -&gt; p_293 [label=&quot;&quot;];
p_293 [label=&quot;Simplify (not\l          ((((((sko_strategy_0 DoorA Stay \&gt;=. 0\l                &amp;&amp; sko_strategy_0 DoorA Swap \&gt;=. 0)\l               &amp;&amp; sko_strategy_0 DoorB Stay \&gt;=. 0)\l              &amp;&amp; sko_strategy_0 DoorB Swap \&gt;=. 0)\l             &amp;&amp; sko_strategy_0 DoorC Stay \&gt;=. 0)\l            &amp;&amp; sko_strategy_0 DoorC Swap \&gt;=. 0)\l           &amp;&amp; ((((sko_strategy_0 DoorA Stay +. sko_strategy_0 DoorA Swap)\l                 +. sko_strategy_0 DoorB Stay)\l                +. sko_strategy_0 DoorB Swap)\l               +. sko_strategy_0 DoorC Stay)\l              +. sko_strategy_0 DoorC Swap = 1)\l          \|\| (((((600000 *. sko_strategy_0 DoorA Stay\l                  +. 200000 *. sko_strategy_0 DoorB Stay)\l                 +. 200000 *. sko_strategy_0 DoorC Stay)\l                +. 400000 *. sko_strategy_0 DoorA Swap)\l               +. 800000 *. sko_strategy_0 DoorB Swap)\l              +. 800000 *. sko_strategy_0 DoorC Swap)\l             \&lt;=. 800000\l          :expansions [] :rw [] :fc [])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_293 -&gt; p_292 [label=&quot;&quot;];
p_292 -&gt; p_z3_480 [label=&quot;&quot;,fontname=&quot;courier&quot;,fontsize=14];
p_z3_480 [label=&quot;(let ((a!1 (+ (* 600000.0 (sko_strategy_0_2662 DoorA_2446 Stay_2450))
              (* 200000.0 (sko…&quot;,shape=box,fontname=&quot;courier&quot;,fontsize=14];p_292 [label=&quot;unsat&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-39fb3ff0-c6cf-4be5-814c-c940e438a795';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-8f8d416d-dfd2-49dd-9a0b-29f6823b5cea';
  alternatives.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-72753795-6531-4492-9ab0-d9199c2771e7';
  fold.hydrate(target);
});
</script></div></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-d8462d54-bfcf-404a-b0bd-e7e21d37b0ad"><textarea style="display: none">digraph &quot;call graph&quot; {
goal [label=&quot;not\l(not\l ((((((sko_strategy_0 DoorA Stay \&gt;=. 0 &amp;&amp; sko_strategy_0 DoorA Swap \&gt;=. 0)\l      &amp;&amp; sko_strategy_0 DoorB Stay \&gt;=. 0)\l     &amp;&amp; sko_strategy_0 DoorB Swap \&gt;=. 0)\l    &amp;&amp; sko_strategy_0 DoorC Stay \&gt;=. 0)\l   &amp;&amp; sko_strategy_0 DoorC Swap \&gt;=. 0)\l  &amp;&amp; ((((sko_strategy_0 DoorA Stay +. sko_strategy_0 DoorA Swap)\l        +. sko_strategy_0 DoorB Stay)\l       +. sko_strategy_0 DoorB Swap)\l      +. sko_strategy_0 DoorC Stay)\l     +. sko_strategy_0 DoorC Swap = 1)\l \|\| (((((600000 *. sko_strategy_0 DoorA Stay\l         +. 200000 *. sko_strategy_0 DoorB Stay)\l        +. 200000 *. sko_strategy_0 DoorC Stay)\l       +. 400000 *. sko_strategy_0 DoorA Swap)\l      +. 800000 *. sko_strategy_0 DoorB Swap)\l     +. 800000 *. sko_strategy_0 DoorC Swap)\l    \&lt;=. 800000)&quot;,shape=box,style=filled,color=&quot;cyan&quot;,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-d8462d54-bfcf-404a-b0bd-e7e21d37b0ad';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-abf2d503-0d30-46c1-a2bf-198abe8a7279';
  alternatives.hydrate(target);
});
</script></div></div></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>And we've proven that the DoorC-Swap is the best strategy the player can employ in this setup. Intuitively the reason for that is that it is better to choose the least likely door, forcing the host to reveal more information about the prize location in the more likely doors.</p>
<h1 id="Even-more-complex-example">Even more complex example<a class="anchor-link" href="#Even-more-complex-example">&#182;</a></h1><p>Using this approach one can go further and analyse even more complicated Monty-Hall-like games (for example, the prize value might depend on the door and/or player actions).</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-47" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">pDoorsComplex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">door</span><span class="w"> </span>: <span class="nc">door</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Real</span><span class="p">.(</span><span class="w"></span>
<span class="w">  </span><span class="n">switch</span><span class="w"> </span><span class="p">(</span><span class="n">door</span><span class="p">){</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">DoorA</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mf">5.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">10.0</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">DoorB</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mf">3.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">10.0</span><span class="w"> </span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">DoorC</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">10.0</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="n">reward_complex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">prize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">switch</span><span class="p">(</span><span class="n">scenario</span><span class="p">.</span><span class="n">prize</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">DoorA</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mf">1000000.</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">DoorB</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mf">2000000.</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">DoorC</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mf">4000000.</span><span class="w">      </span>
<span class="w">  </span><span class="p">};</span><span class="w"> </span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">scenario</span><span class="p">.</span><span class="n">prize</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">scenario</span><span class="p">.</span><span class="n">first_guess</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">scenario</span><span class="p">.</span><span class="n">choice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Stay</span><span class="p">)</span><span class="w"> </span><span class="n">prize</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">scenario</span><span class="p">.</span><span class="n">choice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Swap</span><span class="p">)</span><span class="w"> </span><span class="n">prize</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="n">expected_reward_complex</span><span class="w"> </span>: <span class="p">(</span><span class="n">scenario</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">real</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">real</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="n">scenario_pmf</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Real</span><span class="p">.({</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">pr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">scenario_pmf</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">reward_complex</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kd">let</span><span class="w"> </span><span class="n">avg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">choice</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">avg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">first_guess</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">pr</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">prize</span>: <span class="nc">DoorA</span><span class="p">,</span><span class="w"> </span><span class="n">first_guess</span><span class="p">,</span><span class="w"> </span><span class="n">choice</span><span class="p">}</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">          </span><span class="n">pr</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">prize</span>: <span class="nc">DoorB</span><span class="p">,</span><span class="w"> </span><span class="n">first_guess</span><span class="p">,</span><span class="w"> </span><span class="n">choice</span><span class="p">}</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">          </span><span class="n">pr</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">prize</span>: <span class="nc">DoorC</span><span class="p">,</span><span class="w"> </span><span class="n">first_guess</span><span class="p">,</span><span class="w"> </span><span class="n">choice</span><span class="p">}</span><span class="w"> </span>
<span class="w">        </span><span class="p">};</span><span class="w"></span>
<span class="w">      </span><span class="n">avg</span><span class="p">(</span><span class="n">DoorA</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">avg</span><span class="p">(</span><span class="n">DoorB</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">avg</span><span class="p">(</span><span class="n">DoorC</span><span class="p">)</span><span class="w"> </span>
<span class="w">      </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="n">avg</span><span class="p">(</span><span class="n">Stay</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">avg</span><span class="p">(</span><span class="n">Swap</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">})</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[24]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val pDoorsComplex : door -&gt; real = &lt;fun&gt;
val reward_complex : scenario -&gt; Q.t = &lt;fun&gt;
val expected_reward_complex : (scenario -&gt; real) -&gt; real = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-48" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="n">verify</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Real</span><span class="p">.({</span><span class="w"></span>
<span class="w">  </span><span class="n">valid_strategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="n">expected_reward_complex</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="n">make_scenario_pmf</span><span class="p">(</span><span class="n">pDoorsComplex</span><span class="p">,</span><span class="n">strategy</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">1400000.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span>
<span class="p">}))</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[25]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : (door -&gt; choice -&gt; real) -&gt; bool = &lt;fun&gt;
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><div class="imandra-vr imandra-vr-proved"><i class="fa fa-check-circle"></i><span>Proved</span></div><div><div class="imandra-alternatives" id="alt-8b100477-39fb-4ee4-a018-55cf12cec72d"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>proof</a></li><li class="" data-toggle="tab"><a>call graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-proof-top"><div class="imandra-fold panel panel-default" id="fold-4885c323-e5a9-4b62-a647-516e7e319ac4"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>proof</span></div></div><div class="panel-body collapse"><div class="imandra-proof"><div class="imandra-alternatives" id="alt-75c018d8-d39a-4a36-8ea3-8279ae6a10a7"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>summary</a></li><li class="" data-toggle="tab"><a>full</a></li><li class="" data-toggle="tab"><a>graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-table" id="table-9c864839-3030-415b-ac5f-fe8809bc7e32"><table><tr><td><b>ground_instances</b></td><td>0</td></tr><tr><td><b>definitions</b></td><td>0</td></tr><tr><td><b>inductions</b></td><td>0</td></tr><tr><td><b>search_time</b></td><td><pre>0.030s</pre></td></tr><tr><td><b>details</b></td><td><div class="imandra-fold panel panel-default" id="fold-13760784-c4b1-415f-a7a2-e3de8d669e7d"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><div class="imandra-table" id="table-e835b048-e491-4544-80f5-85e3e0b05a72"><table><tr><td><b>smt_stats</b></td><td><div class="imandra-table" id="table-6b5c9f63-c49d-40a9-83e7-8749c63ebc21"><table><tr><td><b>num checks</b></td><td>1</td></tr><tr><td><b>arith assert lower</b></td><td>8</td></tr><tr><td><b>arith pivots</b></td><td>2</td></tr><tr><td><b>rlimit count</b></td><td>2238</td></tr><tr><td><b>mk clause</b></td><td>3</td></tr><tr><td><b>mk bool var</b></td><td>16</td></tr><tr><td><b>arith assert upper</b></td><td>1</td></tr><tr><td><b>arith add rows</b></td><td>2</td></tr><tr><td><b>propagations</b></td><td>2</td></tr><tr><td><b>conflicts</b></td><td>1</td></tr><tr><td><b>datatype accessor ax</b></td><td>5</td></tr><tr><td><b>arith conflicts</b></td><td>1</td></tr><tr><td><b>num allocs</b></td><td>1910311756</td></tr><tr><td><b>added eqs</b></td><td>1</td></tr><tr><td><b>arith eq adapter</b></td><td>1</td></tr><tr><td><b>memory</b></td><td>37.330000</td></tr><tr><td><b>max memory</b></td><td>37.810000</td></tr></table></div></td></tr></table></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-13760784-c4b1-415f-a7a2-e3de8d669e7d';
  fold.hydrate(target);
});
</script></div></td></tr></table></div></div><div class="tab-pane"><div class="imandra-fold panel panel-default" id="fold-45c61fe3-62a2-486f-93aa-cf20b7579f4c"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><ul><li><pre>start[0.030s]
  sko_strategy_0 DoorA Stay &gt;=. 0
  &amp;&amp; sko_strategy_0 DoorA Swap &gt;=. 0
     &amp;&amp; sko_strategy_0 DoorB Stay &gt;=. 0
        &amp;&amp; sko_strategy_0 DoorB Swap &gt;=. 0
           &amp;&amp; sko_strategy_0 DoorC Stay &gt;=. 0
              &amp;&amp; sko_strategy_0 DoorC Swap &gt;=. 0
                 &amp;&amp; ((((sko_strategy_0 DoorA Stay
                        +. sko_strategy_0 DoorA Swap)
                       +. sko_strategy_0 DoorB Stay)
                      +. sko_strategy_0 DoorB Swap)
                     +. sko_strategy_0 DoorC Stay)
                    +. sko_strategy_0 DoorC Swap = 1
  ==&gt; (((((((if DoorA = DoorA then 5 /. 10
             else if DoorA = DoorB then 3 /. 10 else 2 /. 10)
            *. sko_strategy_0 DoorA Stay)
           *. (if DoorA = DoorA
               then
                 if Stay = Stay
                 then
                   if DoorA = DoorA then 1000000
                   else if DoorA = DoorB then 2000000 else 4000000
                 else 0
               else
               if Stay = Swap then if DoorA = DoorA then 1000000 else …
               else 0)
           +. …)
          +. …)
         +. …)
        +. …)
       +. …)
      &lt;=. 1400000</pre></li><li><div><h4>simplify</h4><div class="imandra-table" id="table-e96534c7-aa27-43ee-907d-1eb50f95c942"><table><tr><td><b>into</b></td><td><pre>not
((((((sko_strategy_0 DoorA Stay &gt;=. 0 &amp;&amp; sko_strategy_0 DoorA Swap &gt;=. 0)
     &amp;&amp; sko_strategy_0 DoorB Stay &gt;=. 0)
    &amp;&amp; sko_strategy_0 DoorB Swap &gt;=. 0)
   &amp;&amp; sko_strategy_0 DoorC Stay &gt;=. 0)
  &amp;&amp; sko_strategy_0 DoorC Swap &gt;=. 0)
 &amp;&amp; ((((sko_strategy_0 DoorA Stay +. sko_strategy_0 DoorA Swap)
       +. sko_strategy_0 DoorB Stay)
      +. sko_strategy_0 DoorB Swap)
     +. sko_strategy_0 DoorC Stay)
    +. sko_strategy_0 DoorC Swap = 1)
|| (((((500000 *. sko_strategy_0 DoorA Stay
        +. 600000 *. sko_strategy_0 DoorB Stay)
       +. 800000 *. sko_strategy_0 DoorC Stay)
      +. 1400000 *. sko_strategy_0 DoorA Swap)
     +. 1300000 *. sko_strategy_0 DoorB Swap)
    +. 1100000 *. sko_strategy_0 DoorC Swap)
   &lt;=. 1400000</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><ul></ul></td></tr></table></div></div></li><li><div><h4>unsat</h4><pre>(let ((a!1 (+ (sko_strategy_0_2734 DoorA_2446 Stay_2450)
              (sko_strategy_0_2734 DoorA_24…</pre></div></li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-45c61fe3-62a2-486f-93aa-cf20b7579f4c';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-dbb5b6d4-19e8-4441-a994-8693039c8f18"><textarea style="display: none">digraph &quot;proof&quot; {
p_297 [label=&quot;Start (sko_strategy_0 DoorA Stay \&gt;=. 0\l       &amp;&amp; sko_strategy_0 DoorA Swap \&gt;=. 0\l          &amp;&amp; sko_strategy_0 DoorB Stay \&gt;=. 0\l             &amp;&amp; sko_strategy_0 DoorB Swap \&gt;=. 0\l                &amp;&amp; sko_strategy_0 DoorC Stay \&gt;=. 0\l                   &amp;&amp; sko_strategy_0 DoorC Swap \&gt;=. 0\l                      &amp;&amp; ((((sko_strategy_0 DoorA Stay\l                             +. sko_strategy_0 DoorA Swap)\l                            +. sko_strategy_0 DoorB Stay)\l                           +. sko_strategy_0 DoorB Swap)\l                          +. sko_strategy_0 DoorC Stay)\l                         +. sko_strategy_0 DoorC Swap = 1\l       ==\&gt; (((((((if DoorA = DoorA then 5 /. 10\l                  else if DoorA = DoorB then 3 /. 10 else 2 /. 10)\l                 *. sko_strategy_0 DoorA Stay)\l                *. (if DoorA = DoorA\l                    then\l                      if Stay = Stay\l                      then\l                        if DoorA = DoorA then 1000000\l                        else if DoorA = DoorB then 2000000 else 4000000\l                      else 0\l                    else\l                    if Stay = Swap\l                    then if DoorA = DoorA then 1000000 else … else 0)\l                +. …)\l               +. …)\l              +. …)\l             +. …)\l            +. …)\l           \&lt;=. 1400000\l       :time 0.030s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_297 -&gt; p_296 [label=&quot;&quot;];
p_296 [label=&quot;Simplify (not\l          ((((((sko_strategy_0 DoorA Stay \&gt;=. 0\l                &amp;&amp; sko_strategy_0 DoorA Swap \&gt;=. 0)\l               &amp;&amp; sko_strategy_0 DoorB Stay \&gt;=. 0)\l              &amp;&amp; sko_strategy_0 DoorB Swap \&gt;=. 0)\l             &amp;&amp; sko_strategy_0 DoorC Stay \&gt;=. 0)\l            &amp;&amp; sko_strategy_0 DoorC Swap \&gt;=. 0)\l           &amp;&amp; ((((sko_strategy_0 DoorA Stay +. sko_strategy_0 DoorA Swap)\l                 +. sko_strategy_0 DoorB Stay)\l                +. sko_strategy_0 DoorB Swap)\l               +. sko_strategy_0 DoorC Stay)\l              +. sko_strategy_0 DoorC Swap = 1)\l          \|\| (((((500000 *. sko_strategy_0 DoorA Stay\l                  +. 600000 *. sko_strategy_0 DoorB Stay)\l                 +. 800000 *. sko_strategy_0 DoorC Stay)\l                +. 1400000 *. sko_strategy_0 DoorA Swap)\l               +. 1300000 *. sko_strategy_0 DoorB Swap)\l              +. 1100000 *. sko_strategy_0 DoorC Swap)\l             \&lt;=. 1400000\l          :expansions [] :rw [] :fc [])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_296 -&gt; p_295 [label=&quot;&quot;];
p_295 -&gt; p_z3_1303 [label=&quot;&quot;,fontname=&quot;courier&quot;,fontsize=14];
p_z3_1303 [label=&quot;(let ((a!1 (+ (sko_strategy_0_2734 DoorA_2446 Stay_2450)
              (sko_strategy_0_2734 DoorA_24…&quot;,shape=box,fontname=&quot;courier&quot;,fontsize=14];p_295 [label=&quot;unsat&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-dbb5b6d4-19e8-4441-a994-8693039c8f18';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-75c018d8-d39a-4a36-8ea3-8279ae6a10a7';
  alternatives.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-4885c323-e5a9-4b62-a647-516e7e319ac4';
  fold.hydrate(target);
});
</script></div></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-2929d54c-a069-4de9-9f42-00fd9047b190"><textarea style="display: none">digraph &quot;call graph&quot; {
goal [label=&quot;not\l(not\l ((((((sko_strategy_0 DoorA Stay \&gt;=. 0 &amp;&amp; sko_strategy_0 DoorA Swap \&gt;=. 0)\l      &amp;&amp; sko_strategy_0 DoorB Stay \&gt;=. 0)\l     &amp;&amp; sko_strategy_0 DoorB Swap \&gt;=. 0)\l    &amp;&amp; sko_strategy_0 DoorC Stay \&gt;=. 0)\l   &amp;&amp; sko_strategy_0 DoorC Swap \&gt;=. 0)\l  &amp;&amp; ((((sko_strategy_0 DoorA Stay +. sko_strategy_0 DoorA Swap)\l        +. sko_strategy_0 DoorB Stay)\l       +. sko_strategy_0 DoorB Swap)\l      +. sko_strategy_0 DoorC Stay)\l     +. sko_strategy_0 DoorC Swap = 1)\l \|\| (((((500000 *. sko_strategy_0 DoorA Stay\l         +. 600000 *. sko_strategy_0 DoorB Stay)\l        +. 800000 *. sko_strategy_0 DoorC Stay)\l       +. 1400000 *. sko_strategy_0 DoorA Swap)\l      +. 1300000 *. sko_strategy_0 DoorB Swap)\l     +. 1100000 *. sko_strategy_0 DoorC Swap)\l    \&lt;=. 1400000)&quot;,shape=box,style=filled,color=&quot;cyan&quot;,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-2929d54c-a069-4de9-9f42-00fd9047b190';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-8b100477-39fb-4ee4-a018-55cf12cec72d';
  alternatives.hydrate(target);
});
</script></div></div></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20ReasonML.ipynb%23try-cell-49" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-rust"><pre><span></span><span class="n">instance</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Real</span><span class="p">.({</span><span class="w"></span>
<span class="w">  </span><span class="n">valid_strategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="n">expected_reward_complex</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="n">make_scenario_pmf</span><span class="p">(</span><span class="n">pDoorsComplex</span><span class="p">,</span><span class="n">strategy</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1400000.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span>
<span class="p">}))</span><span class="w"></span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[26]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : (door -&gt; choice -&gt; real) -&gt; bool = &lt;fun&gt;
module CX : sig val strategy : door -&gt; choice -&gt; Q.t end
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre>Instance (after 0 steps, 0.033s):
 let strategy x_0 x_1 =
   match (x_0, x_1) with
   | (DoorA, Swap) -&gt; 1.
   | _ -&gt; 0.
 
</pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><div class="imandra-vr imandra-vr-proved"><i class="fa fa-check-circle"></i><span>Instance</span></div><div><div class="imandra-alternatives" id="alt-da6b6cc8-a41d-4de6-844a-136a4207d771"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>call graph</a></li><li class="" data-toggle="tab"><a>proof-attempt</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-graphviz" id="graphviz-a9937ea8-628e-4d51-af29-e80fba88af6b"><textarea style="display: none">digraph &quot;call graph&quot; {
goal [label=&quot;((((((sko_strategy_0 DoorA Stay \&gt;=. 0 &amp;&amp; sko_strategy_0 DoorA Swap \&gt;=. 0)\l     &amp;&amp; sko_strategy_0 DoorB Stay \&gt;=. 0)\l    &amp;&amp; sko_strategy_0 DoorB Swap \&gt;=. 0)\l   &amp;&amp; sko_strategy_0 DoorC Stay \&gt;=. 0)\l  &amp;&amp; sko_strategy_0 DoorC Swap \&gt;=. 0)\l &amp;&amp; ((((sko_strategy_0 DoorA Stay +. sko_strategy_0 DoorA Swap)\l       +. sko_strategy_0 DoorB Stay)\l      +. sko_strategy_0 DoorB Swap)\l     +. sko_strategy_0 DoorC Stay)\l    +. sko_strategy_0 DoorC Swap = 1)\l&amp;&amp; ((((500000 *. sko_strategy_0 DoorA Stay\l       +. 600000 *. sko_strategy_0 DoorB Stay)\l      +. 800000 *. sko_strategy_0 DoorC Stay)\l     +. 1400000 *. sko_strategy_0 DoorA Swap)\l    +. 1300000 *. sko_strategy_0 DoorB Swap)\l   +. 1100000 *. sko_strategy_0 DoorC Swap = 1400000&quot;,shape=box,style=filled,color=&quot;cyan&quot;,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-a9937ea8-628e-4d51-af29-e80fba88af6b';
  graphviz.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-proof-top"><div class="imandra-fold panel panel-default" id="fold-8231e36c-dcb5-46ca-92be-6c9c50a75124"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>proof attempt</span></div></div><div class="panel-body collapse"><div class="imandra-proof"><div class="imandra-alternatives" id="alt-412f17e0-a726-4a58-85ee-ae0f3467941d"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>summary</a></li><li class="" data-toggle="tab"><a>full</a></li><li class="" data-toggle="tab"><a>graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-table" id="table-4a7b5164-0276-40b5-b91d-9ab20cccad4b"><table><tr><td><b>ground_instances</b></td><td>0</td></tr><tr><td><b>definitions</b></td><td>0</td></tr><tr><td><b>inductions</b></td><td>0</td></tr><tr><td><b>search_time</b></td><td><pre>0.034s</pre></td></tr><tr><td><b>details</b></td><td><div class="imandra-fold panel panel-default" id="fold-bd4dbb1e-73e2-4a6f-9b1d-d7e6afda9e01"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><div class="imandra-table" id="table-5131770a-6748-4156-a972-5a6112364a7a"><table><tr><td><b>smt_stats</b></td><td><div class="imandra-table" id="table-7a4e21cc-ee46-4bad-aee7-aa195a68d214"><table><tr><td><b>num checks</b></td><td>1</td></tr><tr><td><b>arith assert lower</b></td><td>8</td></tr><tr><td><b>arith pivots</b></td><td>2</td></tr><tr><td><b>rlimit count</b></td><td>2247</td></tr><tr><td><b>mk clause</b></td><td>6</td></tr><tr><td><b>datatype occurs check</b></td><td>5</td></tr><tr><td><b>mk bool var</b></td><td>18</td></tr><tr><td><b>arith assert upper</b></td><td>2</td></tr><tr><td><b>arith add rows</b></td><td>2</td></tr><tr><td><b>propagations</b></td><td>4</td></tr><tr><td><b>datatype accessor ax</b></td><td>5</td></tr><tr><td><b>num allocs</b></td><td>2015481934</td></tr><tr><td><b>final checks</b></td><td>1</td></tr><tr><td><b>added eqs</b></td><td>2</td></tr><tr><td><b>del clause</b></td><td>6</td></tr><tr><td><b>arith eq adapter</b></td><td>2</td></tr><tr><td><b>memory</b></td><td>40.470000</td></tr><tr><td><b>max memory</b></td><td>40.970000</td></tr></table></div></td></tr></table></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-bd4dbb1e-73e2-4a6f-9b1d-d7e6afda9e01';
  fold.hydrate(target);
});
</script></div></td></tr></table></div></div><div class="tab-pane"><div class="imandra-fold panel panel-default" id="fold-0822620a-be64-46be-a8af-9915356d6847"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><ul><li><pre>start[0.034s]
  (sko_strategy_0 DoorA Stay &gt;=. 0
   &amp;&amp; sko_strategy_0 DoorA Swap &gt;=. 0
      &amp;&amp; sko_strategy_0 DoorB Stay &gt;=. 0
         &amp;&amp; sko_strategy_0 DoorB Swap &gt;=. 0
            &amp;&amp; sko_strategy_0 DoorC Stay &gt;=. 0
               &amp;&amp; sko_strategy_0 DoorC Swap &gt;=. 0
                  &amp;&amp; ((((sko_strategy_0 DoorA Stay
                         +. sko_strategy_0 DoorA Swap)
                        +. sko_strategy_0 DoorB Stay)
                       +. sko_strategy_0 DoorB Swap)
                      +. sko_strategy_0 DoorC Stay)
                     +. sko_strategy_0 DoorC Swap = 1)
  &amp;&amp; ((((((if DoorA = DoorA then 5 /. 10
           else if DoorA = DoorB then 3 /. 10 else 2 /. 10)
          *. sko_strategy_0 DoorA Stay)
         *. (if DoorA = DoorA
             then
               if Stay = Stay
               then
                 if DoorA = DoorA then 1000000
                 else if DoorA = DoorB then 2000000 else 4000000
               else 0
             else
             if Stay = Swap then if DoorA = DoorA then 1000000 else …
             else 0)
         +. …)
        +. …)
       +. …)
      +. …)
     +. … = 1400000</pre></li><li><div><h4>simplify</h4><div class="imandra-table" id="table-000bf1ba-ab37-4fd4-8fdd-25661932e875"><table><tr><td><b>into</b></td><td><pre>((((((sko_strategy_0 DoorA Stay &gt;=. 0 &amp;&amp; sko_strategy_0 DoorA Swap &gt;=. 0)
     &amp;&amp; sko_strategy_0 DoorB Stay &gt;=. 0)
    &amp;&amp; sko_strategy_0 DoorB Swap &gt;=. 0)
   &amp;&amp; sko_strategy_0 DoorC Stay &gt;=. 0)
  &amp;&amp; sko_strategy_0 DoorC Swap &gt;=. 0)
 &amp;&amp; ((((sko_strategy_0 DoorA Stay +. sko_strategy_0 DoorA Swap)
       +. sko_strategy_0 DoorB Stay)
      +. sko_strategy_0 DoorB Swap)
     +. sko_strategy_0 DoorC Stay)
    +. sko_strategy_0 DoorC Swap = 1)
&amp;&amp; ((((500000 *. sko_strategy_0 DoorA Stay
       +. 600000 *. sko_strategy_0 DoorB Stay)
      +. 800000 *. sko_strategy_0 DoorC Stay)
     +. 1400000 *. sko_strategy_0 DoorA Swap)
    +. 1300000 *. sko_strategy_0 DoorB Swap)
   +. 1100000 *. sko_strategy_0 DoorC Swap = 1400000</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><ul></ul></td></tr></table></div></div></li><li>Sat (Some  let strategy x_0 x_1 =
   match (x_0, x_1) with
   | (DoorA, Swap) -&gt; 1.
   | _ -&gt; 0.
 
)</li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-0822620a-be64-46be-a8af-9915356d6847';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-c5728f7d-f265-4337-b63c-03a5a10ab5d0"><textarea style="display: none">digraph &quot;proof&quot; {
p_300 [label=&quot;Start ((sko_strategy_0 DoorA Stay \&gt;=. 0\l        &amp;&amp; sko_strategy_0 DoorA Swap \&gt;=. 0\l           &amp;&amp; sko_strategy_0 DoorB Stay \&gt;=. 0\l              &amp;&amp; sko_strategy_0 DoorB Swap \&gt;=. 0\l                 &amp;&amp; sko_strategy_0 DoorC Stay \&gt;=. 0\l                    &amp;&amp; sko_strategy_0 DoorC Swap \&gt;=. 0\l                       &amp;&amp; ((((sko_strategy_0 DoorA Stay\l                              +. sko_strategy_0 DoorA Swap)\l                             +. sko_strategy_0 DoorB Stay)\l                            +. sko_strategy_0 DoorB Swap)\l                           +. sko_strategy_0 DoorC Stay)\l                          +. sko_strategy_0 DoorC Swap = 1)\l       &amp;&amp; ((((((if DoorA = DoorA then 5 /. 10\l                else if DoorA = DoorB then 3 /. 10 else 2 /. 10)\l               *. sko_strategy_0 DoorA Stay)\l              *. (if DoorA = DoorA\l                  then\l                    if Stay = Stay\l                    then\l                      if DoorA = DoorA then 1000000\l                      else if DoorA = DoorB then 2000000 else 4000000\l                    else 0\l                  else\l                  if Stay = Swap then if DoorA = DoorA then 1000000 else …\l                  else 0)\l              +. …)\l             +. …)\l            +. …)\l           +. …)\l          +. … = 1400000\l       :time 0.034s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_300 -&gt; p_299 [label=&quot;&quot;];
p_299 [label=&quot;Simplify (((((((sko_strategy_0 DoorA Stay \&gt;=. 0\l                &amp;&amp; sko_strategy_0 DoorA Swap \&gt;=. 0)\l               &amp;&amp; sko_strategy_0 DoorB Stay \&gt;=. 0)\l              &amp;&amp; sko_strategy_0 DoorB Swap \&gt;=. 0)\l             &amp;&amp; sko_strategy_0 DoorC Stay \&gt;=. 0)\l            &amp;&amp; sko_strategy_0 DoorC Swap \&gt;=. 0)\l           &amp;&amp; ((((sko_strategy_0 DoorA Stay +. sko_strategy_0 DoorA Swap)\l                 +. sko_strategy_0 DoorB Stay)\l                +. sko_strategy_0 DoorB Swap)\l               +. sko_strategy_0 DoorC Stay)\l              +. sko_strategy_0 DoorC Swap = 1)\l          &amp;&amp; ((((500000 *. sko_strategy_0 DoorA Stay\l                 +. 600000 *. sko_strategy_0 DoorB Stay)\l                +. 800000 *. sko_strategy_0 DoorC Stay)\l               +. 1400000 *. sko_strategy_0 DoorA Swap)\l              +. 1300000 *. sko_strategy_0 DoorB Swap)\l             +. 1100000 *. sko_strategy_0 DoorC Swap = 1400000\l          :expansions [] :rw [] :fc [])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_299 -&gt; p_298 [label=&quot;&quot;];
p_298 [label=&quot;Sat (Some  let strategy x_0 x_1 =\l   match (x_0, x_1) with\l   \| (DoorA, Swap) -\&gt; 1.\l   \| _ -\&gt; 0.\l \l)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-c5728f7d-f265-4337-b63c-03a5a10ab5d0';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-412f17e0-a726-4a58-85ee-ae0f3467941d';
  alternatives.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-8231e36c-dcb5-46ca-92be-6c9c50a75124';
  fold.hydrate(target);
});
</script></div></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-da6b6cc8-a41d-4de6-844a-136a4207d771';
  alternatives.hydrate(target);
});
</script></div></div></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>More generally, this illustrates how we can use Imandra’s ability to reason about functional values and real arithmetic to formally prove and refute statements about probability distributions. These abilities allow us to us to formally analyse many kinds of scenarios requiring the ability to reason about random variables.</p>
</div>
</div>
</div>
                    </div>

                    <div class="sidebar-right">
                        <div class="sidebar-right__menu">
                            
                            <a class="sidebar-right__menu-item sidebar-right__menu-item--h1" href="#Monty-Hall problem">Monty Hall problem</a>
                            
                            <a class="sidebar-right__menu-item sidebar-right__menu-item--h2" href="#Probability-mass-functions ">Probability mass functions </a>
                            
                            <a class="sidebar-right__menu-item sidebar-right__menu-item--h2" href="#Expected-rewards">Expected rewards</a>
                            
                            <a class="sidebar-right__menu-item sidebar-right__menu-item--h1" href="#Reasoning-about-Monty-Hall-probabilities">Reasoning about Monty Hall probabilities</a>
                            
                            <a class="sidebar-right__menu-item sidebar-right__menu-item--h1" href="#Biased-Monty-Hall">Biased Monty Hall</a>
                            
                            <a class="sidebar-right__menu-item sidebar-right__menu-item--h1" href="#Even-more-complex-example">Even more complex example</a>
                            
                        </div>
                    </div></article>
            </main>
            <footer class="Footer">
                <a class="Copyrights"href="http://imandra.ai">&#9400; 2018 Aesthetic Integration Ltd. All rights reserved.</a>
            </footer>
        </div>
    
 


    </body>
</html>
