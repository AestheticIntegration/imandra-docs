<!DOCTYPE html>
<html>
    <head><meta charset="utf-8" />
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <title>Imandra Documentation - Probabilistic Reasoning in OCaml</title>
        <meta property="og:url" content="https://docs.imandra.ai/imandra-docs/notebooks/probabilistic-reasoning-in-ocaml/">
        <meta property="og:type" content="website">
        <meta property="og:title" content="Imandra Documentation - Probabilistic Reasoning in OCaml">
        <meta property="og:description" content="In this notebook, we employ Imandra ability to reason about functional values to analyse probabilistic scenarios following the example of the Monty Hall problem.">
        <meta property="og:image" content="https://storage.googleapis.com/imandra-assets/images/og_image_default_i78.jpg">


        
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-116937440-6"></script>
        <script>
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());

         gtag('config', 'UA-116937440-1');
        </script>
        <script type="text/javascript"> var sc_project=11767520; var sc_invisible=1; var sc_security="fa7e88d1"; </script>
        <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async></script>
        <noscript><div class="statcounter">
            <a title="Web Analytics" href="http://statcounter.com/" target="_blank">
                <img class="statcounter" src="//c.statcounter.com/11767520/0/fa7e88d1/1/" alt="Web Analytics"></a>
        </div></noscript>
        

        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather+Sans:300,300i,400,400i%7CMerriweather:300,300i,400,400i%7CRoboto+Slab:300,300i,400,400i">

        <link rel="stylesheet" href="/imandra-docs/static/style/style.min.c7df16ea.css" type="text/css">
        <link rel="stylesheet" href="/imandra-docs/static/nbextensions/nbimandra/styles.b466ce6f.css" type="text/css">
        <link rel="stylesheet" href="/imandra-docs/static/docs-styles.b9de737f.css" type="text/css">
        
        <link rel="stylesheet" href="/imandra-docs/static/jekyll-styles.ad852e85.css" type="text/css">
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <script src="/imandra-docs/static/nbimandra-rjs-bundle.b85e58fd.js"></script>

        <style type="text/css">
         .highlight .hll { background-color: #ffffcc }
         .highlight  { background: #f8f8f8; }
         .highlight .c { color: #408080; font-style: italic } /* Comment */
         .highlight .err { border: 1px solid #FF0000 } /* Error */
         .highlight .k { color: #008000; font-weight: bold } /* Keyword */
         .highlight .o { color: #666666 } /* Operator */
         .highlight .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
         .highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
         .highlight .cp { color: #BC7A00 } /* Comment.Preproc */
         .highlight .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
         .highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
         .highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
         .highlight .gd { color: #A00000 } /* Generic.Deleted */
         .highlight .ge { font-style: italic } /* Generic.Emph */
         .highlight .gr { color: #FF0000 } /* Generic.Error */
         .highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
         .highlight .gi { color: #00A000 } /* Generic.Inserted */
         .highlight .go { color: #888888 } /* Generic.Output */
         .highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
         .highlight .gs { font-weight: bold } /* Generic.Strong */
         .highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
         .highlight .gt { color: #0044DD } /* Generic.Traceback */
         .highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
         .highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
         .highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
         .highlight .kp { color: #008000 } /* Keyword.Pseudo */
         .highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
         .highlight .kt { color: #B00040 } /* Keyword.Type */
         .highlight .m { color: #666666 } /* Literal.Number */
         .highlight .s { color: #BA2121 } /* Literal.String */
         .highlight .na { color: #7D9029 } /* Name.Attribute */
         .highlight .nb { color: #008000 } /* Name.Builtin */
         .highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
         .highlight .no { color: #880000 } /* Name.Constant */
         .highlight .nd { color: #AA22FF } /* Name.Decorator */
         .highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
         .highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
         .highlight .nf { color: #0000FF } /* Name.Function */
         .highlight .nl { color: #A0A000 } /* Name.Label */
         .highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
         .highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
         .highlight .nv { color: #19177C } /* Name.Variable */
         .highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
         .highlight .w { color: #bbbbbb } /* Text.Whitespace */
         .highlight .mb { color: #666666 } /* Literal.Number.Bin */
         .highlight .mf { color: #666666 } /* Literal.Number.Float */
         .highlight .mh { color: #666666 } /* Literal.Number.Hex */
         .highlight .mi { color: #666666 } /* Literal.Number.Integer */
         .highlight .mo { color: #666666 } /* Literal.Number.Oct */
         .highlight .sa { color: #BA2121 } /* Literal.String.Affix */
         .highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
         .highlight .sc { color: #BA2121 } /* Literal.String.Char */
         .highlight .dl { color: #BA2121 } /* Literal.String.Delimiter */
         .highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
         .highlight .s2 { color: #BA2121 } /* Literal.String.Double */
         .highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
         .highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
         .highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
         .highlight .sx { color: #008000 } /* Literal.String.Other */
         .highlight .sr { color: #BB6688 } /* Literal.String.Regex */
         .highlight .s1 { color: #BA2121 } /* Literal.String.Single */
         .highlight .ss { color: #19177C } /* Literal.String.Symbol */
         .highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
         .highlight .fm { color: #0000FF } /* Name.Function.Magic */
         .highlight .vc { color: #19177C } /* Name.Variable.Class */
         .highlight .vg { color: #19177C } /* Name.Variable.Global */
         .highlight .vi { color: #19177C } /* Name.Variable.Instance */
         .highlight .vm { color: #19177C } /* Name.Variable.Magic */
         .highlight .il { color: #666666 } /* Literal.Number.Integer.Long */
        </style>

        <!-- Loading mathjax macro -->
        <!-- Load mathjax -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-MML-AM_CHTML-full,Safe"> </script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    init_mathjax = function() {
        if (window.MathJax) {
        // MathJax loaded
            MathJax.Hub.Config({
                TeX: {
                    equationNumbers: {
                    autoNumber: "AMS",
                    useLabelIds: true
                    }
                },
                tex2jax: {
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                    processEscapes: true,
                    processEnvironments: true
                },
                displayAlign: 'center',
                CommonHTML: {
                    linebreaks: { 
                    automatic: true 
                    }
                },
                "HTML-CSS": {
                    linebreaks: { 
                    automatic: true 
                    }
                }
            });
        
            MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        }
    }
    init_mathjax();
    </script>
    <!-- End of mathjax configuration --><script>
  function handleCopyClick() {
      var el = this;
      var terminal = el.closest('.terminal');
      var highlight = terminal.getElementsByClassName('highlight')[0];
      copyToClipboardMsg(highlight);

      terminal.classList.add('terminal--hide');
      setTimeout(function () {
          terminal.classList.remove('terminal--hide');
      }, 2000);


      function copyToClipboardMsg(elem) {
          var succeed = copyToClipboard(elem);
          var msg;
          if (!succeed) {
              msg = 'Error!';
          } else {
              msg = 'Copied!';
          }

          var msgElem = terminal.querySelector('.terminal__copy-msg');
          msgElem.innerHTML = msg;
          setTimeout(function () {
              msgElem.innerHTML = 'You rock!';
          }, 1000);
      }

      function copyToClipboard(elem) {
          // create hidden text element, if it doesn't already exist
          var targetId = '_hiddenCopyText_';
          var isInput = elem.tagName === 'INPUT' || elem.tagName === 'TEXTAREA';
          var origSelectionStart, origSelectionEnd;
          if (isInput) {
              // can just use the original source element for the selection and copy
              target = elem;
              origSelectionStart = elem.selectionStart;
              origSelectionEnd = elem.selectionEnd;
          } else {
              // must use a temporary form element for the selection and copy
              target = terminal.querySelector('#' + targetId);
              if (!target) {
                  var target = document.createElement('textarea');
                  // target.style.display = 'flex';
                  // target.style.position = 'absolute';
                  // target.style.left = '-1000%';
                  target.id = targetId;
                 elem.appendChild(target);
              }
              target.textContent = elem.textContent.trim();
          }

          // select the content
          var currentFocus = document.activeElement;
          target.focus();
          target.setSelectionRange(0, target.value.length);

          // copy the selection
          var succeed;
          try {
              succeed = document.execCommand('copy');
          } catch (e) {
              succeed = false;
          }
          // restore original focus
          if (currentFocus && typeof currentFocus.focus === 'function') {
              currentFocus.focus();
          }

          if (isInput) {
              // restore prior selection
              elem.setSelectionRange(origSelectionStart, origSelectionEnd);
          } else {
              // clear temporary content
              elem.removeChild(target);
          }
          return succeed;
      }
  }
</script>
    </head>
    <body>
        <div class="background">
        </div>
        <div class="page-container">
            <main class="main-content-column">
                <!-- Jupyter (Imandra core docs) version -->
<header class="header">
    <div class="top-row-container">
        <div class="top-row">

            <div id="toggler--left" class="side__left-menu-toggler">
                <div class="side__toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <p class="side__toggle-text">Docs</p>
            </div>

            <div class="side__logo-container">
                <a class="side__logo-link" href="/">
                    <img class="side__logo " src = "/imandra-docs/jekyll-resources/assets/img/imandra-gradient-logo-docs.svg" alt="Imandra Logo" title="Imandra Logo">
                    <img class="side__logo--min " src="/imandra-docs/jekyll-resources/assets/img/imandra-gradient-logo-min.svg" alt="Imandra Logo" title="Imandra Logo">

                </a>
            </div>

            <div id="toggler--right" class="side__right-menu-toggler">
                <p class="side__toggle-text">Pages</p>
                <div class="side__toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>

            <nav id="side-nav-menu" class="side__nav-container side__nav-container--hidden">
                <ul class="side__nav-list">
                    
                    <li class="side__nav-list-item">
                        <a class="side__nav-link" href="/">Documentation Home</a>
                        
                    </li>
                    
                    <li class="side__nav-list-item">
                        <a class="side__nav-link side__nav-link--active" href="/imandra-docs">Imandra Core</a>
                        
                        <ul class="side__nav-list--sub-level-1">
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/welcome">A quick tour</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 ">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/installation">Installation</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/installation-simple">Installer</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/installation-manual-opam">Manual (opam)</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/installation-docker">Docker Image</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/installation-jupyter">Jupyter Notebook</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/installation-vscode">VSCode</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/installation-server-image">Server Image</a>
                                            
                                            
                                            
                                        </li>
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/logic-and-program-modes">Logic and Program modes</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 ">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/verification">Verification</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/verification-commands">Commands</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/verification-attributes">Attributes</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/verification-unrolling">Unrolling</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/verification-simplification">Simplification</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/verification-blast">Blast</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/verification-induction">Induction</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/verification-waterfall">Waterfall</a>
                                            
                                            
                                            
                                        </li>
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/proving-program-termination">Proving program termination</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 ">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/decomposition">Region Decomposition</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/imandra-tools-intro">Imandra tools introduction</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/idf">Iterative Decomposition Framework</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/region-probabilities">Region Probabilities</a>
                                            
                                            
                                            
                                        </li>
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/loading-files">Multifile development</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/extracting-ocaml-modules-with-imandra-extract">Extracting OCaml modules</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/plugins">Code generation and plugins</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/reflection">Reflection of terms</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 ">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/examples">Examples</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        <span class="side__nav-link side__nav-link--minisec">Beginner</span>
                                        </li>
                                        
                                        
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/webservice-auth-logic">Analysing Web-app authentication logic</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/simple-vehicle-controller">Simple vehicle controller</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/simple-stoplight-model">Simple car intersection model</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/reasonml-tic-tac-toe">Tic Tac Toe with ReasonML</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/reasonml-facetime-state-machines">Exploring The Apple FaceTime Bug with ReasonML State Machines</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/crossing-river-safely">Crossing the river safely</a>
                                            
                                            
                                            
                                        </li>
                                        
                                    
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        <span class="side__nav-link side__nav-link--minisec">Intermediate</span>
                                        </li>
                                        
                                        
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/ubs-case-study">Analysing the UBS ATS Dark Pool</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/six-swiss-exchange-pricing">Region Decomposition - Exchange Pricing</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/verifying-an-ros-node">Creating and Verifying a ROS Node</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/key-pair-security">Key Pair Security in Imandra</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/sudoku">Solving Sudoku with Imandra</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/solver-synthesis">Synthesising a game solver in Imandra</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/exchange-implied-trading">Exchange Implied Trading</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/school-scheduler">Solving school scheduling during COVID</a>
                                            
                                            
                                            
                                        </li>
                                        
                                    
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        <span class="side__nav-link side__nav-link--minisec">Advanced</span>
                                        </li>
                                        
                                        
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/recursion-induction-and-rewriting">Recursion, Induction and Rewriting</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/verifying-merge-sort">Verifying merge sort in Imandra</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/ripple-carry-adder">Verifying a Ripple Carry Adder</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/region-probabilities-example">Calculating Region Probabilities</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/supervised-learning">Analysing Machine Learning Models</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/probabilistic-reasoning-in-reasonml">Probabilistic Reasoning in ReasonML</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/a-comparison-with-tla-plus">A comparison with TLA+</a>
                                            
                                            
                                            
                                        </li>
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 ">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/reference">Reference</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/odoc/imandra-base/Imandra_prelude/">Standard Library</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/odoc/">API Docs</a>
                                            
                                            
                                            
                                        </li>
                                        
                                    
                                </ul>
                                
                            </li>
                            
                        </ul>
                        
                    </li>
                    
                    <li class="side__nav-list-item">
                        <a class="side__nav-link" href="/idf-py">Py IDF</a>
                        
                    </li>
                    
                    <li class="side__nav-list-item">
                        <a class="side__nav-link" href="/ipl">Imandra Protocol Language</a>
                        
                    </li>
                    
                    <li class="side__nav-list-item">
                        <a class="side__nav-link" href="/imandra-rule-synth">Imandra Rule Synth</a>
                        
                    </li>
                    
                    <li class="side__nav-list-item">
                        <a class="side__nav-link" href="/fix-engine">FIX Engine</a>
                        
                    </li>
                    
                </ul>
            </nav>
        </div>
    </div>

    <div class="background">
    </div>



    <div class="template-header">
        <div class="top-bar">
            <div class="side__nav-search">
                <input id="search" type="search" placeholder="Search">
                <div class="side__nav-search-icon">
                    <i class="fa fa-search"></i>
                </div>
            </div>

            <nav class="top-bar__nav-container" id="top-menu">
                <a href="#" class="top-bar__toggle">≡</a>
                <div class="top-nav-bar__group ">
                    <div class="top-nav-bar__nav nav-bar--blue top-nav-bar__nav--hidden">

                        <ul class="top-nav-bar__links top-nav-bar__links--hidden-smaller-than-tablet">



                            <li class="top-nav-bar__item top-nav-bar__item--flex">
                                <a href="https://www.imandra.ai/" class="top-nav-bar__link">Home</a>
                            </li>



                            <li class="top-nav-bar__item top-nav-bar__item--group dropdown--explore">
                                <p class="top-nav-bar__link top-nav-bar__link--group" onclick="">Explore</p>
                                <ul class="dropdown-content dropdown-content--explore">
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--core.svg" alt="Try Imandra" title="Try Imandra Icon">
                                        <a class="dropdown__link" href="https://try.imandra.ai/">Try Online</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--demos.svg" alt="Imandra Demo Gallery" title="Imandra Demo Gallery Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/demos">Demo Gallery</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--demos.svg" alt="IPL Demo Gallery" title="IPL Gallery Icon">
                                        <a class="dropdown__link dropdown__link--last" href="https://www.imandra.ai/ipl-gallery">IPL Gallery</a>
                                    </li>
                                </ul>
                            </li>




                            <li class="top-nav-bar__item top-nav-bar__item--group dropdown--docs">
                                <p class="top-nav-bar__link top-nav-bar__link--group" onclick="">Docs</p>
                                <ul class="dropdown-content dropdown-content--docs">
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--docs.svg" alt="Docs" title="Docs Icon">
                                        <a class="dropdown__link" href="https://docs.imandra.ai/imandra-docs/">Imandra Core</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--docs.svg" alt="Docs" title="Docs Icon">
                                        <a class="dropdown__link" href="https://docs.imandra.ai/idf-py/">PYIDF</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--docs.svg" alt="Docs" title="Docs Icon">
                                        <a class="dropdown__link" href="https://docs.imandra.ai/ipl/">IPL</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--docs.svg" alt="Docs" title="Docs Icon">
                                        <a class="dropdown__link" href="https://docs.imandra.ai/imandra-rule-synth/">Rule Synthesis</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--docs.svg" alt="Docs" title="Docs Icon">
                                        <a class="dropdown__link dropdown__link--last" href="https://docs.imandra.ai/fix-engine/">Fix Engine</a>
                                    </li>
                                </ul>
                            </li>



                            <li class="top-nav-bar__item top-nav-bar__item--group dropdown--products">
                                <p class="top-nav-bar__link top-nav-bar__link--group" onclick="">Products</p>
                                <ul class="dropdown-content dropdown-content--products">
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--core.svg" alt="Imandra Core" title="Imandra Core Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/core">Imandra Core</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--systems.svg" alt="Imandra Protocol Language" title="Imandra Protocol Language Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/ipl-product">Imandra Protocol Language</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--systems.svg" alt="Imandra Markets - Systems" title="Imandra Markets - Systems Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/systems">Imandra Markets - Systems</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--connectivity.svg" alt="Imandra Markets - Connectivity" title="Imandra Markets - Connectivity Icon">
                                        <a class="dropdown__link dropdown__link--last" href="https://www.imandra.ai/connectivity">Imandra Markets - Connectivity</a>
                                    </li>
                                </ul>
                            </li>



                            <li class="top-nav-bar__item top-nav-bar__item--group dropdown--industries">
                                <p class="top-nav-bar__link top-nav-bar__link--group" onclick="">Industries</p>
                                <ul class="dropdown-content dropdown-content--industries">
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--financial.svg" alt="Financial Markets" title="Financial Markets Icon">
                                        <a class="dropdown__link " href="https://www.imandra.ai/markets">Financial Markets</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--autonomy.svg" alt="Autonomous Systems" title="Autonomous Systems Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/autonomy">Autonomous Systems</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--ml.svg" alt="Machine Learning" title="Machine Learning Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/ml">Machine Learning</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--government.svg" alt="Machine Learning" title="Machine Learning Icon">
                                        <a class="dropdown__link dropdown__link--last" href="https://www.imandra.ai/government">Government and defense</a>
                                    </li>
                                </ul>
                            </li>

                            <li class="top-nav-bar__item top-nav-bar__item--group dropdown--media">
                                <p class="top-nav-bar__link top-nav-bar__link--group" onclick="">Media</p>
                                <ul class="dropdown-content dropdown-content--media">
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--media.svg" alt="Media" title="Media Icon">
                                        <a class="dropdown__link " href="https://www.imandra.ai/media">Media</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--blog.svg" alt="Blog" title="Blog Icon">
                                        <a class="dropdown__link dropdown__link--last " href="https://medium.com/imandra">Blog</a>
                                    </li>
                                </ul>
                            </li>

                            <li class="top-nav-bar__item top-nav-bar__item--group dropdown--company">
                                <p class="top-nav-bar__link top-nav-bar__link--group" onclick="">Company</p>
                                <ul class="dropdown-content dropdown-content--company">
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--about.svg" alt="About" title="About Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/about">About</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--careers.svg" alt=" Careers" title="Careers Icon">
                                        <a class="dropdown__link dropdown__link--bottom" href="https://www.imandra.ai/careers">Careers</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--research.svg" alt="Research" title="Research Icon">
                                        <a class="dropdown__link dropdown__link--last" href="https://www.imandra.ai/research">Research</a>
                                    </li>
                                </ul>
                            </li>
                        </ul>

                    </div>
                </div>
            </nav>
        </div>

        

        <div class="template-header__image-container">
            <a class="template-header__image" href="/imandra-docs">
                <img class="site-specific-image" src="/imandra-docs/static/img/site_specific_image_v_2.svg">
            </a>
        </div>
    </div>



    <script>
        document.getElementById('toggler--left').addEventListener('click', function () {
            document.querySelector('.side__right-menu-toggler .side__toggle').classList.remove(
                'side__toggle--active');
            document.querySelector('.side__left-menu-toggler .side__toggle').classList.toggle(
                'side__toggle--active');
            document.getElementsByClassName('side__nav-container')[0].classList.toggle(
                'side__nav-container--hidden');
            document.getElementsByClassName('top-nav-bar__nav')[0].classList.add('top-nav-bar__nav--hidden');
        });

        document.getElementById('toggler--right').addEventListener('click', function () {
            document.querySelector('.side__left-menu-toggler .side__toggle').classList.remove(
                'side__toggle--active');
            document.querySelector('.side__right-menu-toggler .side__toggle').classList.toggle(
                'side__toggle--active');

            document.getElementsByClassName('side__nav-container')[0].classList.add(
                'side__nav-container--hidden');
            document.getElementsByClassName('top-nav-bar__nav')[0].classList.toggle(
                'top-nav-bar__nav--hidden');
        });
    </script>
</header>
                <article class="article__container article__container--notebooks">
                    <div class="main-content main-content--jupyter">
                        
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>An amazing feature of Imandra is the ability to reason about functional inputs and generate functional instances and counterexamples. For example we can introduce a variant type and a second-order function that evaluates its argument on each variant and computes the sum of the results.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-2" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">type</span> <span class="n">t</span> <span class="o">=</span> <span class="nc">A</span> <span class="o">|</span> <span class="nc">B</span> <span class="o">|</span> <span class="nc">C</span>
<span class="k">let</span> <span class="n">sum</span> <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">(</span><span class="nc">A</span><span class="o">)</span> <span class="o">+</span> <span class="n">f</span><span class="o">(</span><span class="nc">B</span><span class="o">)</span> <span class="o">+</span> <span class="n">f</span><span class="o">(</span><span class="nc">C</span><span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[1]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>type t = A | B | C
val sum : (t -&gt; int) -&gt; int = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Now, let's ask Imandra to come up with an instance of a function <code>f</code> that returns positive values and that produces <code>42</code> when calling <code>sum(f)</code>:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-4" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="n">instance</span><span class="o">(</span> <span class="k">fun</span> <span class="o">(</span><span class="n">f</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">f</span><span class="o">(</span><span class="nc">A</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="o">(</span><span class="nc">B</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sum</span><span class="o">(</span><span class="n">f</span><span class="o">)</span> <span class="o">=</span> <span class="mi">42</span> <span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[2]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : (t -&gt; int) -&gt; bool = &lt;fun&gt;
module CX : sig val f : t -&gt; int end
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre>Instance (after 0 steps, 0.032s):
 let f = function
   | B -&gt; 1
   | C -&gt; 0
   | _ -&gt; 41
 
</pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><div style="font-size: 1.2em; padding: 0.5em; border-top: 1px solid green; border-bottom: 1px solid green"><i class="fa fa-check-circle" style="margin-right: 0.5em; color: green"></i><span>Instance</span></div><div><div class="imandra-alternatives" id="alt-1d54973e-38ff-4078-bad7-5c8060bd9f5b"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>call graph</a></li><li class="" data-toggle="tab"><a>proof</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-graphviz" id="graphviz-1429d8f1-1c72-49d3-88f6-d48d9bd0c459"><textarea style="display: none">digraph &quot;call graph&quot; {
goal [label=&quot;let (_x_0 : int) = sko_f_0 A in\llet (_x_1 : int) = sko_f_0 B in\l(not (_x_0 \&lt;= 0) &amp;&amp; not (_x_1 \&lt;= 0)) &amp;&amp; _x_0 + _x_1 + sko_f_0 C = 42&quot;,shape=box,style=filled,color=&quot;cyan&quot;,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-1429d8f1-1c72-49d3-88f6-d48d9bd0c459';
  graphviz.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-proof-top"><div class="imandra-fold panel panel-default" id="fold-6c1c2a2c-8f2c-415d-a009-bc02218c08ec"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>proof attempt</span></div></div><div class="panel-body collapse"><div class="imandra-proof"><div class="imandra-alternatives" id="alt-e926a697-506f-4f3e-94ef-6dee3cfb64de"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>summary</a></li><li class="" data-toggle="tab"><a>full</a></li><li class="" data-toggle="tab"><a>graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-table" id="table-a7c5dc2c-5cea-4578-846b-b181523b8942"><table><tr><td><b>ground_instances</b></td><td>0</td></tr><tr><td><b>definitions</b></td><td>0</td></tr><tr><td><b>inductions</b></td><td>0</td></tr><tr><td><b>search_time</b></td><td><pre>0.032s</pre></td></tr><tr><td><b>details</b></td><td><div class="imandra-fold panel panel-default" id="fold-a26aca8f-d5d0-4934-81d1-e3f2e223b727"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><div class="imandra-table" id="table-4e1b4262-1d6e-4316-8c2c-394fe94ebdb7"><table><tr><td><b>smt_stats</b></td><td><div class="imandra-table" id="table-11fc76b8-bad3-4f0f-8ac3-9972182cb237"><table><tr><td><b>num checks</b></td><td>1</td></tr><tr><td><b>arith-make-feasible</b></td><td>2</td></tr><tr><td><b>arith-max-columns</b></td><td>9</td></tr><tr><td><b>rlimit count</b></td><td>356</td></tr><tr><td><b>mk clause</b></td><td>4</td></tr><tr><td><b>datatype occurs check</b></td><td>3</td></tr><tr><td><b>mk bool var</b></td><td>8</td></tr><tr><td><b>arith-lower</b></td><td>1</td></tr><tr><td><b>propagations</b></td><td>2</td></tr><tr><td><b>arith-max-rows</b></td><td>2</td></tr><tr><td><b>datatype accessor ax</b></td><td>3</td></tr><tr><td><b>num allocs</b></td><td>945987171</td></tr><tr><td><b>final checks</b></td><td>1</td></tr><tr><td><b>added eqs</b></td><td>3</td></tr><tr><td><b>del clause</b></td><td>4</td></tr><tr><td><b>arith eq adapter</b></td><td>1</td></tr><tr><td><b>arith-upper</b></td><td>3</td></tr><tr><td><b>memory</b></td><td>11.530000</td></tr><tr><td><b>max memory</b></td><td>24.340000</td></tr></table></div></td></tr></table></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-a26aca8f-d5d0-4934-81d1-e3f2e223b727';
  fold.hydrate(target);
});
</script></div></td></tr></table></div></div><div class="tab-pane"><div class="imandra-fold panel panel-default" id="fold-63b646d1-ee1a-48cd-a4d1-c57be02cd911"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><ul><li><pre>start[0.032s]
  let (_x_0 : int) = sko_f_0 A in
  let (_x_1 : int) = sko_f_0 B in
  _x_0 &gt; 0 &amp;&amp; _x_1 &gt; 0 &amp;&amp; _x_0 + _x_1 + sko_f_0 C = 42</pre></li><li><div><h4>simplify</h4><div class="imandra-table" id="table-2eaff772-cc1e-4fdb-be01-d64ba3ddf965"><table><tr><td><b>into</b></td><td><pre>let (_x_0 : int) = sko_f_0 A in
let (_x_1 : int) = sko_f_0 B in
(not (_x_0 &lt;= 0) &amp;&amp; not (_x_1 &lt;= 0)) &amp;&amp; _x_0 + _x_1 + sko_f_0 C = 42</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><ul></ul></td></tr></table></div></div></li><li>Sat (Some  let f = function
   | B -&gt; 1
   | C -&gt; 0
   | _ -&gt; 41
 
)</li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-63b646d1-ee1a-48cd-a4d1-c57be02cd911';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-dd3829f5-e0ec-4e39-8cb3-53662e8fdfcc"><textarea style="display: none">digraph &quot;proof&quot; {
p_246 [label=&quot;Start (let (_x_0 : int) = sko_f_0 A in\l       let (_x_1 : int) = sko_f_0 B in\l       _x_0 \&gt; 0 &amp;&amp; _x_1 \&gt; 0 &amp;&amp; _x_0 + _x_1 + sko_f_0 C = 42 :time 0.032s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_246 -&gt; p_245 [label=&quot;&quot;];
p_245 [label=&quot;Simplify (let (_x_0 : int) = sko_f_0 A in\l          let (_x_1 : int) = sko_f_0 B in\l          (not (_x_0 \&lt;= 0) &amp;&amp; not (_x_1 \&lt;= 0))\l          &amp;&amp; _x_0 + _x_1 + sko_f_0 C = 42 :expansions [] :rw [] :fc [])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_245 -&gt; p_244 [label=&quot;&quot;];
p_244 [label=&quot;Sat (Some  let f = function\l   \| B -\&gt; 1\l   \| C -\&gt; 0\l   \| _ -\&gt; 41\l \l)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-dd3829f5-e0ec-4e39-8cb3-53662e8fdfcc';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-e926a697-506f-4f3e-94ef-6dee3cfb64de';
  alternatives.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-6c1c2a2c-8f2c-415d-a009-bc02218c08ec';
  fold.hydrate(target);
});
</script></div></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-1d54973e-38ff-4078-bad7-5c8060bd9f5b';
  alternatives.hydrate(target);
});
</script></div></div></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>A natural application of this ability is to apply it to formal reasoning about random variables and probability distributions over them. In the following, we'll consider an application of this kind of reasoning to analyse the famous Monty Hall problem.</p>
<h1 id="Monty-Hall&#160;problem">Monty Hall&#160;problem<a class="anchor-link" href="#Monty-Hall&#160;problem">&#182;</a></h1><p>In the Monty Hall problem, you are participating in a game where you are given three doors to choose from. One of the doors randomly contains a $1,000,000 prize. Let’s encode that in OCaml — we’ll introduce the value of the prize and the variant type for the doors.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-6" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">prize</span> <span class="o">=</span> <span class="mi">1000000</span><span class="o">.</span><span class="mi">0</span>

<span class="k">type</span> <span class="n">door</span> <span class="o">=</span>
  <span class="o">|</span> <span class="nc">DoorA</span>
  <span class="o">|</span> <span class="nc">DoorB</span>
  <span class="o">|</span> <span class="nc">DoorC</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[3]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val prize : real = 1000000
type door = DoorA | DoorB | DoorC
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The game then proceeds as follows: first, you guess one of the doors, then the host opens another door — a door that, the host knows, doesn’t contain the prize. The host then offers you to change your initial guess or stay with it.</p>
<p>To encode that, we’ll introduce another variant type for the player choice and gather all the values that describe a single Monty Hall trial into a <code>scenario</code> record.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-8" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">type</span> <span class="n">choice</span> <span class="o">=</span>
  <span class="o">|</span> <span class="nc">Stay</span>
  <span class="o">|</span> <span class="nc">Swap</span>

<span class="k">type</span> <span class="n">scenario</span> <span class="o">=</span> 
  <span class="o">{</span> <span class="n">prize</span>       <span class="o">:</span> <span class="n">door</span>
  <span class="o">;</span> <span class="n">first_guess</span> <span class="o">:</span> <span class="n">door</span>
  <span class="o">;</span> <span class="n">choice</span>      <span class="o">:</span> <span class="n">choice</span>
  <span class="o">}</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[4]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>type choice = Stay | Swap
type scenario = { prize : door; first_guess : door; choice : choice; }
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Probability-mass-functions&#160;">Probability mass functions&#160;<a class="anchor-link" href="#Probability-mass-functions&#160;">&#182;</a></h2><p>We want to treat scenarios described by the "scenario" record as random. This means that we would like to deal with <a href="https://en.wikipedia.org/wiki/Probability_mass_function">probability mass functions</a> (PMFs) over the variables of the declared types. As a first example, let's make a PMF for the doors that distributes over the three doors with equal probabilities:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-10" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">pDoorsEqual</span> <span class="o">:</span> <span class="o">(</span><span class="n">door</span> <span class="o">-&gt;</span> <span class="n">real</span><span class="o">)</span> <span class="o">=</span> <span class="k">fun</span> <span class="o">(</span><span class="n">door</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="nn">Real</span><span class="p">.</span><span class="o">(</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span> <span class="o">/</span> <span class="mi">3</span><span class="o">.</span><span class="mi">0</span><span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[5]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val pDoorsEqual : door -&gt; real = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Notice that we are using the <code>real</code> type for numeric values in our examples. Internally, Imandra represents reals in an arbitrary-precision manner. The real-valued arithmetic operators are gathered in the <code>Real</code> module. Further, we’ll be explicitly opening the <code>Real</code> module to stress that we are dealing with real arithmetic.</p>
<p>Not just any function can be a probability mass function — PMFs must satisfy the so-called “measure axioms”: all the returned values must be non-negative and the total probability over the whole function domain must sum to one. Let’s make a predicate that checks whether a function is a valid PMF over doors.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-12" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">valid_door_pmf</span> <span class="o">:</span> <span class="o">(</span><span class="n">door</span> <span class="o">-&gt;</span> <span class="n">real</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="kt">bool</span> <span class="o">=</span>  
  <span class="k">fun</span> <span class="o">(</span><span class="n">pmf</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="nn">Real</span><span class="p">.</span><span class="o">(</span>
    <span class="o">(</span><span class="n">pmf</span><span class="o">(</span><span class="nc">DoorA</span><span class="o">)</span> <span class="o">+</span> <span class="n">pmf</span><span class="o">(</span><span class="nc">DoorB</span><span class="o">)</span> <span class="o">+</span> <span class="n">pmf</span><span class="o">(</span><span class="nc">DoorC</span><span class="o">)</span> <span class="o">=</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
    <span class="o">(</span><span class="n">pmf</span><span class="o">(</span><span class="nc">DoorA</span><span class="o">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
    <span class="o">(</span><span class="n">pmf</span><span class="o">(</span><span class="nc">DoorB</span><span class="o">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
    <span class="o">(</span><span class="n">pmf</span><span class="o">(</span><span class="nc">DoorC</span><span class="o">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">)</span>  
  <span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[6]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val valid_door_pmf : (door -&gt; real) -&gt; bool = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To check that this predicate works we use it on our <code>pDoorsEqual</code> function.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-14" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="n">valid_door_pmf</span><span class="o">(</span><span class="n">pDoorsEqual</span><span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[7]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : bool = true
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The player controls the <code>first_guess</code> and the <code>choice</code> fields of the <code>scenario</code> record. In general, the player can also choose his actions randomly. Following the game theory nomenclature, we’ll call the probability distribution over the player choices a “strategy”. For example, here is a strategy that chooses the first guess door randomly and then stays with that choice:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-16" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">random_then_stay_strategy</span> <span class="o">:</span> <span class="o">(</span><span class="n">door</span> <span class="o">-&gt;</span> <span class="n">choice</span> <span class="o">-&gt;</span> <span class="n">real</span><span class="o">)</span> <span class="o">=</span>
  <span class="k">fun</span> <span class="n">door</span> <span class="n">choice</span> <span class="o">-&gt;</span> <span class="nn">Real</span><span class="p">.</span><span class="o">(</span>
    <span class="k">match</span> <span class="n">door</span><span class="o">,</span><span class="n">choice</span> <span class="k">with</span>
    <span class="o">|</span> <span class="o">(</span> <span class="o">_</span> <span class="o">,</span><span class="nc">Stay</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span> <span class="o">/</span> <span class="mi">3</span><span class="o">.</span><span class="mi">0</span>
    <span class="o">|</span> <span class="o">(</span> <span class="o">_</span> <span class="o">,</span><span class="nc">Swap</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span> 
  <span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[8]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val random_then_stay_strategy : door -&gt; choice -&gt; real = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>A strategy’s type is <code>door -&gt; choice -&gt; real</code>: it takes in which door the player chooses and which choice he makes and returns the probability with which that happens. To check that such a function is a valid probability mass function we introduce and apply a predicate for it:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-18" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">valid_strategy</span> <span class="o">:</span> <span class="o">(</span><span class="n">door</span> <span class="o">-&gt;</span> <span class="n">choice</span> <span class="o">-&gt;</span> <span class="n">real</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="kt">bool</span> <span class="o">=</span> 
  <span class="k">fun</span> <span class="n">strategy</span> <span class="o">-&gt;</span> <span class="nn">Real</span><span class="p">.</span><span class="o">(</span>  
    <span class="o">(</span><span class="n">strategy</span> <span class="nc">DoorA</span> <span class="nc">Stay</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">strategy</span> <span class="nc">DoorA</span> <span class="nc">Swap</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
    <span class="o">(</span><span class="n">strategy</span> <span class="nc">DoorB</span> <span class="nc">Stay</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">strategy</span> <span class="nc">DoorB</span> <span class="nc">Swap</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
    <span class="o">(</span><span class="n">strategy</span> <span class="nc">DoorC</span> <span class="nc">Stay</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">strategy</span> <span class="nc">DoorC</span> <span class="nc">Swap</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
    <span class="o">(</span> <span class="n">strategy</span> <span class="nc">DoorA</span> <span class="nc">Stay</span> <span class="o">+</span> <span class="n">strategy</span> <span class="nc">DoorA</span> <span class="nc">Swap</span> <span class="o">+</span>
      <span class="n">strategy</span> <span class="nc">DoorB</span> <span class="nc">Stay</span> <span class="o">+</span> <span class="n">strategy</span> <span class="nc">DoorB</span> <span class="nc">Swap</span> <span class="o">+</span>
      <span class="n">strategy</span> <span class="nc">DoorC</span> <span class="nc">Stay</span> <span class="o">+</span> <span class="n">strategy</span> <span class="nc">DoorC</span> <span class="nc">Swap</span> <span class="o">=</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">)</span> 
  <span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[9]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val valid_strategy : (door -&gt; choice -&gt; real) -&gt; bool = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-19" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="n">valid_strategy</span><span class="o">(</span><span class="n">random_then_stay_strategy</span><span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[10]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : bool = true
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Finally, we’ll need one last function that constructs a PMF over the whole scenario record. It shall take a <code>door -&gt; real</code> prize PMF, a <code>door -&gt; choice -&gt; real</code> player strategy and return a <code>scenario -&gt; real</code> PMF over the scenarios. Since we consider the host and the player choices to be independent, the total probability of the full scenario must be the product of the probabilities of the host and player choices:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-21" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">make_scenario_pmf</span> <span class="o">:</span> <span class="o">(</span><span class="n">door</span> <span class="o">-&gt;</span> <span class="n">real</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="n">door</span> <span class="o">-&gt;</span> <span class="n">choice</span> <span class="o">-&gt;</span> <span class="n">real</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="n">scenario</span> <span class="o">-&gt;</span> <span class="n">real</span><span class="o">)</span> <span class="o">=</span> 
  <span class="k">fun</span> <span class="n">door_pmf</span> <span class="n">strategy</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="nn">Real</span><span class="p">.</span><span class="o">(</span>
    <span class="n">door_pmf</span> <span class="n">s</span><span class="o">.</span><span class="n">prize</span> <span class="o">*</span> <span class="n">strategy</span> <span class="n">s</span><span class="o">.</span><span class="n">first_guess</span> <span class="n">s</span><span class="o">.</span><span class="n">choice</span>
  <span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[11]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val make_scenario_pmf :
  (door -&gt; real) -&gt; (door -&gt; choice -&gt; real) -&gt; scenario -&gt; real = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Expected-rewards">Expected rewards<a class="anchor-link" href="#Expected-rewards">&#182;</a></h2><p>Given a <code>scenario</code> variable, we can calculate the player's "reward." When the first guess is equal to the prize location, then we return the prize value if the player decided to stay. Alternatively, when the first guess is not equal to the prize location, then we return the prize value if the player decided to swap.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-23" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">reward</span> <span class="n">scenario</span> <span class="o">=</span>
  <span class="k">if</span> <span class="n">scenario</span><span class="o">.</span><span class="n">prize</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">first_guess</span> <span class="k">then</span> <span class="o">(</span>
      <span class="k">if</span> <span class="n">scenario</span><span class="o">.</span><span class="n">choice</span> <span class="o">=</span> <span class="nc">Stay</span> <span class="k">then</span> <span class="n">prize</span> <span class="k">else</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span>
  <span class="o">)</span> <span class="k">else</span> <span class="o">(</span>
      <span class="k">if</span> <span class="n">scenario</span><span class="o">.</span><span class="n">choice</span> <span class="o">=</span> <span class="nc">Swap</span> <span class="k">then</span> <span class="n">prize</span> <span class="k">else</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span>
  <span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[12]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val reward : scenario -&gt; real = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Given a probability distribution over scenarios, we want to calculate the expected value of the reward - the probability-weighted average of possible values of the reward for each outcome.</p>
$$ E[reward] = \sum_s P(s)\,reward(s) $$<p>We create a function that performs this averaging: it takes in a scenario PMF of type <code>scenario =&gt; real</code> and returns a <code>real</code> for the expected value:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-25" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">expected_reward</span> <span class="o">:</span> <span class="o">(</span><span class="n">scenario</span> <span class="o">-&gt;</span> <span class="n">real</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">real</span> <span class="o">=</span> 
  <span class="k">let</span> <span class="k">open</span> <span class="nc">Real</span> <span class="k">in</span>
  <span class="k">fun</span> <span class="n">scenario_pmf</span> <span class="o">-&gt;</span> 
    <span class="k">let</span> <span class="n">pr</span> <span class="n">s</span> <span class="o">=</span> <span class="n">scenario_pmf</span><span class="o">(</span><span class="n">s</span><span class="o">)</span> <span class="o">*</span> <span class="n">reward</span><span class="o">(</span><span class="n">s</span><span class="o">)</span> <span class="k">in</span>
      <span class="k">let</span> <span class="n">avg</span> <span class="n">choice</span> <span class="o">=</span> 
        <span class="k">let</span> <span class="n">avg</span> <span class="n">first_guess</span> <span class="o">=</span>
          <span class="n">pr</span> <span class="o">{</span> <span class="n">prize</span> <span class="o">=</span> <span class="nc">DoorA</span><span class="o">;</span> <span class="n">first_guess</span><span class="o">;</span> <span class="n">choice</span><span class="o">}</span> <span class="o">+</span>
          <span class="n">pr</span> <span class="o">{</span> <span class="n">prize</span> <span class="o">=</span> <span class="nc">DoorB</span><span class="o">;</span> <span class="n">first_guess</span><span class="o">;</span> <span class="n">choice</span><span class="o">}</span> <span class="o">+</span>
          <span class="n">pr</span> <span class="o">{</span> <span class="n">prize</span> <span class="o">=</span> <span class="nc">DoorC</span><span class="o">;</span> <span class="n">first_guess</span><span class="o">;</span> <span class="n">choice</span><span class="o">}</span> 
        <span class="k">in</span>
      <span class="n">avg</span><span class="o">(</span><span class="nc">DoorA</span><span class="o">)</span> <span class="o">+</span> <span class="n">avg</span><span class="o">(</span><span class="nc">DoorB</span><span class="o">)</span> <span class="o">+</span> <span class="n">avg</span><span class="o">(</span><span class="nc">DoorC</span><span class="o">)</span> 
      <span class="k">in</span>
    <span class="n">avg</span><span class="o">(</span><span class="nc">Stay</span><span class="o">)</span> <span class="o">+</span> <span class="n">avg</span><span class="o">(</span><span class="nc">Swap</span><span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[13]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val expected_reward : (scenario -&gt; real) -&gt; real = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>As a final example, let’s use what we’ve built so far to calculate the expected reward for the scenario when the host hides the prize equally randomly and the player uses the <code>random_then_stay_strategy</code>:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-27" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="n">random_then_stay_strategy</span>
<span class="o">|&gt;</span> <span class="n">make_scenario_pmf</span> <span class="n">pDoorsEqual</span> 
<span class="o">|&gt;</span> <span class="n">expected_reward</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[14]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : real = 1000000/3
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We get an obvious result that if we choose a random door and stay with it, then the expected reward is 1/3 of a $1,000,000. That seems reasonable and it is not very obvious that one can increase his chances of winning.</p>
<h1 id="Reasoning-about-Monty-Hall-probabilities">Reasoning about Monty Hall probabilities<a class="anchor-link" href="#Reasoning-about-Monty-Hall-probabilities">&#182;</a></h1><p>Let’s ask Imandra if 1/3 of a 1,000,000$ is the best outcome for any strategy the player can employ. To do this we’ll use Imandra <code>verify</code> directive to verify that, for any valid strategy, the scenario with equally probable prize placement gives an expected reward less or equal than 1000000/3.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-29" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="n">verify</span> <span class="o">(</span> <span class="k">fun</span> <span class="n">strategy</span> <span class="o">-&gt;</span> <span class="nn">Real</span><span class="p">.</span><span class="o">(</span>
  <span class="n">valid_strategy</span><span class="o">(</span><span class="n">strategy</span><span class="o">)</span> <span class="o">==&gt;</span>
  <span class="o">(</span> <span class="n">expected_reward</span> <span class="o">(</span><span class="n">make_scenario_pmf</span> <span class="n">pDoorsEqual</span> <span class="n">strategy</span><span class="o">)</span>
  <span class="o">)</span> <span class="o">&lt;=</span> <span class="mi">1000000</span><span class="o">.</span><span class="mi">0</span> <span class="o">/</span> <span class="mi">3</span><span class="o">.</span><span class="mi">0</span> <span class="o">)</span> 
<span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[15]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : (door -&gt; choice -&gt; real) -&gt; bool = &lt;fun&gt;
module CX : sig val strategy : door -&gt; choice -&gt; real end
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre>Counterexample (after 0 steps, 0.022s):
 let strategy x_0 x_1 =
   match (x_0, x_1) with
   | (DoorB, Stay) -&gt; (Real.mk_of_string &quot;999997/1000000&quot;)
   | (DoorB, Swap) -&gt; (Real.mk_of_string &quot;3/1000000&quot;)
   | _ -&gt; 0.0
 
</pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><div style="font-size: 1.2em; padding: 0.5em; border-top: 1px dashed #D84315; border-bottom: 1px dashed #D84315"><i class="fa fa-times-circle-o" style="margin-right: 0.5em; color: #D84315"></i><span>Refuted</span></div><div><div class="imandra-alternatives" id="alt-970622b0-7b9c-4552-8dc5-d489b2da8284"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>call graph</a></li><li class="" data-toggle="tab"><a>proof</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-graphviz" id="graphviz-2784b9df-76fd-48d9-8b4c-37292e3c0d97"><textarea style="display: none">digraph &quot;call graph&quot; {
goal [label=&quot;let (_x_0 : real) = sko_strategy_0 DoorA Stay in\llet (_x_1 : real) = sko_strategy_0 DoorA Swap in\llet (_x_2 : real) = sko_strategy_0 DoorB Stay in\llet (_x_3 : real) = sko_strategy_0 DoorB Swap in\llet (_x_4 : real) = sko_strategy_0 DoorC Stay in\llet (_x_5 : real) = sko_strategy_0 DoorC Swap in\lnot\l(not\l ((((((_x_0 \&gt;=. 0 &amp;&amp; _x_1 \&gt;=. 0) &amp;&amp; _x_2 \&gt;=. 0) &amp;&amp; _x_3 \&gt;=. 0) &amp;&amp; _x_4 \&gt;=. 0)\l   &amp;&amp; _x_5 \&gt;=. 0)\l  &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)\l \|\| (1000000/3 *. _x_0 +. 1000000/3 *. _x_2 +. 1000000/3 *. _x_4\l     +. 2000000/3 *. _x_1 +. 2000000/3 *. _x_3 +. 2000000/3 *. _x_5)\l    \&lt;=. 1000000/3)&quot;,shape=box,style=filled,color=&quot;cyan&quot;,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-2784b9df-76fd-48d9-8b4c-37292e3c0d97';
  graphviz.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-proof-top"><div class="imandra-fold panel panel-default" id="fold-07c9f4b9-efe9-4799-8054-88409f0d9232"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>proof attempt</span></div></div><div class="panel-body collapse"><div class="imandra-proof"><div class="imandra-alternatives" id="alt-c8c65de8-e041-441a-b596-56b2d478416c"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>summary</a></li><li class="" data-toggle="tab"><a>full</a></li><li class="" data-toggle="tab"><a>graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-table" id="table-289c5a46-a217-424b-9d08-11689719c828"><table><tr><td><b>ground_instances</b></td><td>0</td></tr><tr><td><b>definitions</b></td><td>0</td></tr><tr><td><b>inductions</b></td><td>0</td></tr><tr><td><b>search_time</b></td><td><pre>0.022s</pre></td></tr><tr><td><b>details</b></td><td><div class="imandra-fold panel panel-default" id="fold-cb100cfd-89b6-4d1d-af89-4f673691621d"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><div class="imandra-table" id="table-01574921-47c5-4e19-86e9-c7694ba56c57"><table><tr><td><b>smt_stats</b></td><td><div class="imandra-table" id="table-ef1fbd0f-4f2e-4006-9e19-2f3e0230a49d"><table><tr><td><b>num checks</b></td><td>1</td></tr><tr><td><b>arith-make-feasible</b></td><td>2</td></tr><tr><td><b>arith-max-columns</b></td><td>12</td></tr><tr><td><b>rlimit count</b></td><td>1820</td></tr><tr><td><b>mk clause</b></td><td>4</td></tr><tr><td><b>datatype occurs check</b></td><td>5</td></tr><tr><td><b>mk bool var</b></td><td>13</td></tr><tr><td><b>arith-lower</b></td><td>1</td></tr><tr><td><b>propagations</b></td><td>2</td></tr><tr><td><b>arith-max-rows</b></td><td>2</td></tr><tr><td><b>datatype accessor ax</b></td><td>5</td></tr><tr><td><b>num allocs</b></td><td>1015324027</td></tr><tr><td><b>final checks</b></td><td>1</td></tr><tr><td><b>added eqs</b></td><td>3</td></tr><tr><td><b>del clause</b></td><td>4</td></tr><tr><td><b>arith eq adapter</b></td><td>1</td></tr><tr><td><b>arith-upper</b></td><td>8</td></tr><tr><td><b>memory</b></td><td>13.800000</td></tr><tr><td><b>max memory</b></td><td>24.340000</td></tr></table></div></td></tr></table></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-cb100cfd-89b6-4d1d-af89-4f673691621d';
  fold.hydrate(target);
});
</script></div></td></tr></table></div></div><div class="tab-pane"><div class="imandra-fold panel panel-default" id="fold-c29a9ef5-6faf-4372-bf5c-42c15cef3c22"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><ul><li><pre>start[0.022s]
  let (_x_0 : real) = sko_strategy_0 DoorA Stay in
  let (_x_1 : real) = sko_strategy_0 DoorA Swap in
  let (_x_2 : real) = sko_strategy_0 DoorB Stay in
  let (_x_3 : real) = sko_strategy_0 DoorB Swap in
  let (_x_4 : real) = sko_strategy_0 DoorC Stay in
  let (_x_5 : real) = sko_strategy_0 DoorC Swap in
  let (_x_6 : real) = 1 /. 3 in
  let (_x_7 : real) = _x_6 *. _x_0 in
  let (_x_8 : real) = if Stay = Swap then 1000000 else 0 in
  let (_x_9 : bool) = DoorB = DoorA in
  let (_x_10 : bool) = DoorC = DoorA in
  let (_x_11 : real) = _x_6 *. _x_2 in
  let (_x_12 : bool) = DoorA = DoorB in
  let (_x_13 : bool) = DoorC = DoorB in
  let (_x_14 : real) = _x_6 *. _x_4 in
  let (_x_15 : bool) = DoorA = DoorC in
  let (_x_16 : bool) = DoorB = DoorC in
  let (_x_17 : real) = _x_6 *. _x_1 in
  let (_x_18 : real) = if Swap = Stay then 1000000 else 0 in
  let (_x_19 : real) = _x_6 *. _x_3 in
  let (_x_20 : real) = _x_6 *. _x_5 in
  _x_0 &gt;=. 0
  &amp;&amp; _x_1 &gt;=. 0
     &amp;&amp; _x_2 &gt;=. 0
        &amp;&amp; _x_3 &gt;=. 0
           &amp;&amp; _x_4 &gt;=. 0
              &amp;&amp; _x_5 &gt;=. 0
                 &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1
  ==&gt; (_x_7 *. 1000000 +. _x_7 *. (if _x_9 then 1000000 else _x_8)
       +. _x_7 *. (if _x_10 then 1000000 else _x_8)
       +. (_x_11 *. (if _x_12 then 1000000 else _x_8) +. _x_11 *. 1000000
           +. _x_11 *. (if _x_13 then 1000000 else _x_8))
       +. (_x_14 *. (if _x_15 then 1000000 else _x_8)
           +. _x_14 *. (if _x_16 then 1000000 else _x_8) +. _x_14 *. 1000000)
       +. (_x_17 *. _x_18 +. _x_17 *. (if _x_9 then _x_18 else 1000000)
           +. _x_17 *. (if _x_10 then _x_18 else 1000000)
           +. (_x_19 *. (if _x_12 then _x_18 else 1000000) +. _x_19 *. _x_18
               +. _x_19 *. (if _x_13 then _x_18 else 1000000))
           +. (_x_20 *. (if _x_15 then _x_18 else 1000000)
               +. _x_20 *. (if _x_16 then _x_18 else 1000000)
               +. _x_20 *. _x_18)))
      &lt;=. (1000000 /. 3)</pre></li><li><div><h4>simplify</h4><div class="imandra-table" id="table-c7717370-b6d1-4257-ab69-d6f854cf1423"><table><tr><td><b>into</b></td><td><pre>let (_x_0 : real) = sko_strategy_0 DoorA Stay in
let (_x_1 : real) = sko_strategy_0 DoorA Swap in
let (_x_2 : real) = sko_strategy_0 DoorB Stay in
let (_x_3 : real) = sko_strategy_0 DoorB Swap in
let (_x_4 : real) = sko_strategy_0 DoorC Stay in
let (_x_5 : real) = sko_strategy_0 DoorC Swap in
not
((((((_x_0 &gt;=. 0 &amp;&amp; _x_1 &gt;=. 0) &amp;&amp; _x_2 &gt;=. 0) &amp;&amp; _x_3 &gt;=. 0) &amp;&amp; _x_4 &gt;=. 0)
  &amp;&amp; _x_5 &gt;=. 0)
 &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)
|| (1000000/3 *. _x_0 +. 1000000/3 *. _x_2 +. 1000000/3 *. _x_4
    +. 2000000/3 *. _x_1 +. 2000000/3 *. _x_3 +. 2000000/3 *. _x_5)
   &lt;=. 1000000/3</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><ul></ul></td></tr></table></div></div></li><li>Sat (Some  let strategy x_0 x_1 =
   match (x_0, x_1) with
   | (DoorB, Stay) -&gt; (Real.mk_of_string &quot;999997/1000000&quot;)
   | (DoorB, Swap) -&gt; (Real.mk_of_string &quot;3/1000000&quot;)
   | _ -&gt; 0.0
 
)</li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-c29a9ef5-6faf-4372-bf5c-42c15cef3c22';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-f335df70-66f2-4dde-b49f-f069534742d5"><textarea style="display: none">digraph &quot;proof&quot; {
p_249 [label=&quot;Start (let (_x_0 : real) = sko_strategy_0 DoorA Stay in\l       let (_x_1 : real) = sko_strategy_0 DoorA Swap in\l       let (_x_2 : real) = sko_strategy_0 DoorB Stay in\l       let (_x_3 : real) = sko_strategy_0 DoorB Swap in\l       let (_x_4 : real) = sko_strategy_0 DoorC Stay in\l       let (_x_5 : real) = sko_strategy_0 DoorC Swap in\l       let (_x_6 : real) = 1 /. 3 in\l       let (_x_7 : real) = _x_6 *. _x_0 in\l       let (_x_8 : real) = if Stay = Swap then 1000000 else 0 in\l       let (_x_9 : bool) = DoorB = DoorA in\l       let (_x_10 : bool) = DoorC = DoorA in\l       let (_x_11 : real) = _x_6 *. _x_2 in\l       let (_x_12 : bool) = DoorA = DoorB in\l       let (_x_13 : bool) = DoorC = DoorB in\l       let (_x_14 : real) = _x_6 *. _x_4 in\l       let (_x_15 : bool) = DoorA = DoorC in\l       let (_x_16 : bool) = DoorB = DoorC in\l       let (_x_17 : real) = _x_6 *. _x_1 in\l       let (_x_18 : real) = if Swap = Stay then 1000000 else 0 in\l       let (_x_19 : real) = _x_6 *. _x_3 in\l       let (_x_20 : real) = _x_6 *. _x_5 in\l       _x_0 \&gt;=. 0\l       &amp;&amp; _x_1 \&gt;=. 0\l          &amp;&amp; _x_2 \&gt;=. 0\l             &amp;&amp; _x_3 \&gt;=. 0\l                &amp;&amp; _x_4 \&gt;=. 0\l                   &amp;&amp; _x_5 \&gt;=. 0\l                      &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1\l       ==\&gt; (_x_7 *. 1000000 +. _x_7 *. (if _x_9 then 1000000 else _x_8)\l            +. _x_7 *. (if _x_10 then 1000000 else _x_8)\l            +. (_x_11 *. (if _x_12 then 1000000 else _x_8)\l                +. _x_11 *. 1000000\l                +. _x_11 *. (if _x_13 then 1000000 else _x_8))\l            +. (_x_14 *. (if _x_15 then 1000000 else _x_8)\l                +. _x_14 *. (if _x_16 then 1000000 else _x_8)\l                +. _x_14 *. 1000000)\l            +. (_x_17 *. _x_18 +. _x_17 *. (if _x_9 then _x_18 else 1000000)\l                +. _x_17 *. (if _x_10 then _x_18 else 1000000)\l                +. (_x_19 *. (if _x_12 then _x_18 else 1000000)\l                    +. _x_19 *. _x_18\l                    +. _x_19 *. (if _x_13 then _x_18 else 1000000))\l                +. (_x_20 *. (if _x_15 then _x_18 else 1000000)\l                    +. _x_20 *. (if _x_16 then _x_18 else 1000000)\l                    +. _x_20 *. _x_18)))\l           \&lt;=. (1000000 /. 3)\l       :time 0.022s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_249 -&gt; p_248 [label=&quot;&quot;];
p_248 [label=&quot;Simplify (let (_x_0 : real) = sko_strategy_0 DoorA Stay in\l          let (_x_1 : real) = sko_strategy_0 DoorA Swap in\l          let (_x_2 : real) = sko_strategy_0 DoorB Stay in\l          let (_x_3 : real) = sko_strategy_0 DoorB Swap in\l          let (_x_4 : real) = sko_strategy_0 DoorC Stay in\l          let (_x_5 : real) = sko_strategy_0 DoorC Swap in\l          not\l          ((((((_x_0 \&gt;=. 0 &amp;&amp; _x_1 \&gt;=. 0) &amp;&amp; _x_2 \&gt;=. 0) &amp;&amp; _x_3 \&gt;=. 0)\l             &amp;&amp; _x_4 \&gt;=. 0)\l            &amp;&amp; _x_5 \&gt;=. 0)\l           &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)\l          \|\| (1000000/3 *. _x_0 +. 1000000/3 *. _x_2 +. 1000000/3 *. _x_4\l              +. 2000000/3 *. _x_1 +. 2000000/3 *. _x_3 +. 2000000/3 *. _x_5)\l             \&lt;=. 1000000/3\l          :expansions [] :rw [] :fc [])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_248 -&gt; p_247 [label=&quot;&quot;];
p_247 [label=&quot;Sat (Some  let strategy x_0 x_1 =\l   match (x_0, x_1) with\l   \| (DoorB, Stay) -\&gt; (Real.mk_of_string \&quot;999997/1000000\&quot;)\l   \| (DoorB, Swap) -\&gt; (Real.mk_of_string \&quot;3/1000000\&quot;)\l   \| _ -\&gt; 0.0\l \l)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-f335df70-66f2-4dde-b49f-f069534742d5';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-c8c65de8-e041-441a-b596-56b2d478416c';
  alternatives.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-07c9f4b9-efe9-4799-8054-88409f0d9232';
  fold.hydrate(target);
});
</script></div></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-970622b0-7b9c-4552-8dc5-d489b2da8284';
  alternatives.hydrate(target);
});
</script></div></div></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Imandra refuted our statement and provided us with a counterexample strategy. Imandra suggests that the expected reward will be greater than 1000000/3 if the player chooses <code>DoorA</code> and then <code>Swap</code>s his choice in 0.0003% of the cases. The counterexample strategy is defined in the <code>CX</code> module, so let's  see what is the expected reward with this strategy:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-31" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="nn">CX</span><span class="p">.</span><span class="n">strategy</span>
<span class="o">|&gt;</span> <span class="n">make_scenario_pmf</span> <span class="n">pDoorsEqual</span> 
<span class="o">|&gt;</span> <span class="n">expected_reward</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[16]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : real = 1000003/3
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The counterexample strategy that Imandra produced increased our expected winnings by 1$. This counterexample strategy employs swapping instead of staying. What would be our expected reward if we always swap?</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-33" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">random_then_swap_strategy</span> <span class="n">door</span> <span class="n">choice</span> <span class="o">=</span> 
  <span class="k">match</span> <span class="o">(</span><span class="n">door</span><span class="o">,</span><span class="n">choice</span><span class="o">)</span> <span class="k">with</span> <span class="o">|</span> <span class="o">_,</span><span class="nc">Swap</span> <span class="o">-&gt;</span> <span class="nn">Real</span><span class="p">.</span><span class="o">(</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span> <span class="o">/</span> <span class="mi">3</span><span class="o">.</span><span class="mi">0</span><span class="o">)</span> <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span> <span class="k">in</span>
<span class="n">random_then_swap_strategy</span>
<span class="o">|&gt;</span> <span class="n">make_scenario_pmf</span> <span class="n">pDoorsEqual</span>
<span class="o">|&gt;</span> <span class="n">expected_reward</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[17]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : real = 2000000/3
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>By always swapping we’ve increased our chances of winning up to 2/3. Is this the best possible expected reward one might get in this game?</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-35" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="n">verify</span> <span class="o">(</span> <span class="k">fun</span> <span class="n">strategy</span> <span class="o">-&gt;</span> <span class="nn">Real</span><span class="p">.</span><span class="o">(</span>
  <span class="n">valid_strategy</span><span class="o">(</span><span class="n">strategy</span><span class="o">)</span> <span class="o">==&gt;</span>
  <span class="o">(</span> <span class="n">expected_reward</span> <span class="o">(</span><span class="n">make_scenario_pmf</span> <span class="n">pDoorsEqual</span> <span class="n">strategy</span><span class="o">)</span>
  <span class="o">)</span> <span class="o">&lt;=</span> <span class="mi">2000000</span><span class="o">.</span><span class="mi">0</span> <span class="o">/</span> <span class="mi">3</span><span class="o">.</span><span class="mi">0</span> <span class="o">)</span> 
<span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[18]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : (door -&gt; choice -&gt; real) -&gt; bool = &lt;fun&gt;
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><div style="font-size: 1.2em; padding: 0.5em; border-top: 1px solid green; border-bottom: 1px solid green"><i class="fa fa-check-circle" style="margin-right: 0.5em; color: green"></i><span>Proved</span></div><div><div class="imandra-alternatives" id="alt-d762d25d-1c0a-4f3a-ba75-cdd04a7c50c2"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>proof</a></li><li class="" data-toggle="tab"><a>call graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-proof-top"><div class="imandra-fold panel panel-default" id="fold-70854f5d-5357-41ee-858a-4b0ce4c61113"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>proof</span></div></div><div class="panel-body collapse"><div class="imandra-proof"><div class="imandra-alternatives" id="alt-eaebd1d2-ead7-4f26-873e-2cea74148ffe"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>summary</a></li><li class="" data-toggle="tab"><a>full</a></li><li class="" data-toggle="tab"><a>graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-table" id="table-b67ba251-4911-4ca4-881a-96886a1bc062"><table><tr><td><b>ground_instances</b></td><td>0</td></tr><tr><td><b>definitions</b></td><td>0</td></tr><tr><td><b>inductions</b></td><td>0</td></tr><tr><td><b>search_time</b></td><td><pre>0.019s</pre></td></tr><tr><td><b>details</b></td><td><div class="imandra-fold panel panel-default" id="fold-9c2ba453-7596-4877-949d-60a82991048a"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><div class="imandra-table" id="table-16c59fd8-8596-4212-a265-95f66ce7ff4b"><table><tr><td><b>smt_stats</b></td><td><div class="imandra-table" id="table-96a0a643-25df-494b-a637-d9847a505808"><table><tr><td><b>num checks</b></td><td>1</td></tr><tr><td><b>arith-make-feasible</b></td><td>1</td></tr><tr><td><b>arith-max-columns</b></td><td>12</td></tr><tr><td><b>rlimit count</b></td><td>1776</td></tr><tr><td><b>mk clause</b></td><td>6</td></tr><tr><td><b>mk bool var</b></td><td>13</td></tr><tr><td><b>arith-max-rows</b></td><td>2</td></tr><tr><td><b>conflicts</b></td><td>1</td></tr><tr><td><b>datatype accessor ax</b></td><td>5</td></tr><tr><td><b>arith-bound-propagations-lp</b></td><td>2</td></tr><tr><td><b>num allocs</b></td><td>1048565502</td></tr><tr><td><b>added eqs</b></td><td>2</td></tr><tr><td><b>arith eq adapter</b></td><td>1</td></tr><tr><td><b>arith-upper</b></td><td>7</td></tr><tr><td><b>memory</b></td><td>16.500000</td></tr><tr><td><b>max memory</b></td><td>24.340000</td></tr></table></div></td></tr></table></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-9c2ba453-7596-4877-949d-60a82991048a';
  fold.hydrate(target);
});
</script></div></td></tr></table></div></div><div class="tab-pane"><div class="imandra-fold panel panel-default" id="fold-3088012d-3229-4bd6-bb38-f048e6b670bb"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><ul><li><pre>start[0.019s]
  let (_x_0 : real) = sko_strategy_0 DoorA Stay in
  let (_x_1 : real) = sko_strategy_0 DoorA Swap in
  let (_x_2 : real) = sko_strategy_0 DoorB Stay in
  let (_x_3 : real) = sko_strategy_0 DoorB Swap in
  let (_x_4 : real) = sko_strategy_0 DoorC Stay in
  let (_x_5 : real) = sko_strategy_0 DoorC Swap in
  let (_x_6 : real) = 1 /. 3 in
  let (_x_7 : real) = _x_6 *. _x_0 in
  let (_x_8 : real) = if Stay = Swap then 1000000 else 0 in
  let (_x_9 : bool) = DoorB = DoorA in
  let (_x_10 : bool) = DoorC = DoorA in
  let (_x_11 : real) = _x_6 *. _x_2 in
  let (_x_12 : bool) = DoorA = DoorB in
  let (_x_13 : bool) = DoorC = DoorB in
  let (_x_14 : real) = _x_6 *. _x_4 in
  let (_x_15 : bool) = DoorA = DoorC in
  let (_x_16 : bool) = DoorB = DoorC in
  let (_x_17 : real) = _x_6 *. _x_1 in
  let (_x_18 : real) = if Swap = Stay then 1000000 else 0 in
  let (_x_19 : real) = _x_6 *. _x_3 in
  let (_x_20 : real) = _x_6 *. _x_5 in
  _x_0 &gt;=. 0
  &amp;&amp; _x_1 &gt;=. 0
     &amp;&amp; _x_2 &gt;=. 0
        &amp;&amp; _x_3 &gt;=. 0
           &amp;&amp; _x_4 &gt;=. 0
              &amp;&amp; _x_5 &gt;=. 0
                 &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1
  ==&gt; (_x_7 *. 1000000 +. _x_7 *. (if _x_9 then 1000000 else _x_8)
       +. _x_7 *. (if _x_10 then 1000000 else _x_8)
       +. (_x_11 *. (if _x_12 then 1000000 else _x_8) +. _x_11 *. 1000000
           +. _x_11 *. (if _x_13 then 1000000 else _x_8))
       +. (_x_14 *. (if _x_15 then 1000000 else _x_8)
           +. _x_14 *. (if _x_16 then 1000000 else _x_8) +. _x_14 *. 1000000)
       +. (_x_17 *. _x_18 +. _x_17 *. (if _x_9 then _x_18 else 1000000)
           +. _x_17 *. (if _x_10 then _x_18 else 1000000)
           +. (_x_19 *. (if _x_12 then _x_18 else 1000000) +. _x_19 *. _x_18
               +. _x_19 *. (if _x_13 then _x_18 else 1000000))
           +. (_x_20 *. (if _x_15 then _x_18 else 1000000)
               +. _x_20 *. (if _x_16 then _x_18 else 1000000)
               +. _x_20 *. _x_18)))
      &lt;=. (2000000 /. 3)</pre></li><li><div><h4>simplify</h4><div class="imandra-table" id="table-cd248f25-2f51-4b80-b563-e132f6356abf"><table><tr><td><b>into</b></td><td><pre>let (_x_0 : real) = sko_strategy_0 DoorA Stay in
let (_x_1 : real) = sko_strategy_0 DoorA Swap in
let (_x_2 : real) = sko_strategy_0 DoorB Stay in
let (_x_3 : real) = sko_strategy_0 DoorB Swap in
let (_x_4 : real) = sko_strategy_0 DoorC Stay in
let (_x_5 : real) = sko_strategy_0 DoorC Swap in
not
((((((_x_0 &gt;=. 0 &amp;&amp; _x_1 &gt;=. 0) &amp;&amp; _x_2 &gt;=. 0) &amp;&amp; _x_3 &gt;=. 0) &amp;&amp; _x_4 &gt;=. 0)
  &amp;&amp; _x_5 &gt;=. 0)
 &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)
|| (1000000/3 *. _x_0 +. 1000000/3 *. _x_2 +. 1000000/3 *. _x_4
    +. 2000000/3 *. _x_1 +. 2000000/3 *. _x_3 +. 2000000/3 *. _x_5)
   &lt;=. 2000000/3</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><ul></ul></td></tr></table></div></div></li><li>Unsat</li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-3088012d-3229-4bd6-bb38-f048e6b670bb';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-ba9e289b-c762-4aeb-a65c-7ed4302771b5"><textarea style="display: none">digraph &quot;proof&quot; {
p_252 [label=&quot;Start (let (_x_0 : real) = sko_strategy_0 DoorA Stay in\l       let (_x_1 : real) = sko_strategy_0 DoorA Swap in\l       let (_x_2 : real) = sko_strategy_0 DoorB Stay in\l       let (_x_3 : real) = sko_strategy_0 DoorB Swap in\l       let (_x_4 : real) = sko_strategy_0 DoorC Stay in\l       let (_x_5 : real) = sko_strategy_0 DoorC Swap in\l       let (_x_6 : real) = 1 /. 3 in\l       let (_x_7 : real) = _x_6 *. _x_0 in\l       let (_x_8 : real) = if Stay = Swap then 1000000 else 0 in\l       let (_x_9 : bool) = DoorB = DoorA in\l       let (_x_10 : bool) = DoorC = DoorA in\l       let (_x_11 : real) = _x_6 *. _x_2 in\l       let (_x_12 : bool) = DoorA = DoorB in\l       let (_x_13 : bool) = DoorC = DoorB in\l       let (_x_14 : real) = _x_6 *. _x_4 in\l       let (_x_15 : bool) = DoorA = DoorC in\l       let (_x_16 : bool) = DoorB = DoorC in\l       let (_x_17 : real) = _x_6 *. _x_1 in\l       let (_x_18 : real) = if Swap = Stay then 1000000 else 0 in\l       let (_x_19 : real) = _x_6 *. _x_3 in\l       let (_x_20 : real) = _x_6 *. _x_5 in\l       _x_0 \&gt;=. 0\l       &amp;&amp; _x_1 \&gt;=. 0\l          &amp;&amp; _x_2 \&gt;=. 0\l             &amp;&amp; _x_3 \&gt;=. 0\l                &amp;&amp; _x_4 \&gt;=. 0\l                   &amp;&amp; _x_5 \&gt;=. 0\l                      &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1\l       ==\&gt; (_x_7 *. 1000000 +. _x_7 *. (if _x_9 then 1000000 else _x_8)\l            +. _x_7 *. (if _x_10 then 1000000 else _x_8)\l            +. (_x_11 *. (if _x_12 then 1000000 else _x_8)\l                +. _x_11 *. 1000000\l                +. _x_11 *. (if _x_13 then 1000000 else _x_8))\l            +. (_x_14 *. (if _x_15 then 1000000 else _x_8)\l                +. _x_14 *. (if _x_16 then 1000000 else _x_8)\l                +. _x_14 *. 1000000)\l            +. (_x_17 *. _x_18 +. _x_17 *. (if _x_9 then _x_18 else 1000000)\l                +. _x_17 *. (if _x_10 then _x_18 else 1000000)\l                +. (_x_19 *. (if _x_12 then _x_18 else 1000000)\l                    +. _x_19 *. _x_18\l                    +. _x_19 *. (if _x_13 then _x_18 else 1000000))\l                +. (_x_20 *. (if _x_15 then _x_18 else 1000000)\l                    +. _x_20 *. (if _x_16 then _x_18 else 1000000)\l                    +. _x_20 *. _x_18)))\l           \&lt;=. (2000000 /. 3)\l       :time 0.019s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_252 -&gt; p_251 [label=&quot;&quot;];
p_251 [label=&quot;Simplify (let (_x_0 : real) = sko_strategy_0 DoorA Stay in\l          let (_x_1 : real) = sko_strategy_0 DoorA Swap in\l          let (_x_2 : real) = sko_strategy_0 DoorB Stay in\l          let (_x_3 : real) = sko_strategy_0 DoorB Swap in\l          let (_x_4 : real) = sko_strategy_0 DoorC Stay in\l          let (_x_5 : real) = sko_strategy_0 DoorC Swap in\l          not\l          ((((((_x_0 \&gt;=. 0 &amp;&amp; _x_1 \&gt;=. 0) &amp;&amp; _x_2 \&gt;=. 0) &amp;&amp; _x_3 \&gt;=. 0)\l             &amp;&amp; _x_4 \&gt;=. 0)\l            &amp;&amp; _x_5 \&gt;=. 0)\l           &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)\l          \|\| (1000000/3 *. _x_0 +. 1000000/3 *. _x_2 +. 1000000/3 *. _x_4\l              +. 2000000/3 *. _x_1 +. 2000000/3 *. _x_3 +. 2000000/3 *. _x_5)\l             \&lt;=. 2000000/3\l          :expansions [] :rw [] :fc [])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_251 -&gt; p_250 [label=&quot;&quot;];
p_250 [label=&quot;Unsat&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-ba9e289b-c762-4aeb-a65c-7ed4302771b5';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-eaebd1d2-ead7-4f26-873e-2cea74148ffe';
  alternatives.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-70854f5d-5357-41ee-858a-4b0ce4c61113';
  fold.hydrate(target);
});
</script></div></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-ada95963-0c3e-4ac3-8173-cd9d61f554ed"><textarea style="display: none">digraph &quot;call graph&quot; {
goal [label=&quot;let (_x_0 : real) = sko_strategy_0 DoorA Stay in\llet (_x_1 : real) = sko_strategy_0 DoorA Swap in\llet (_x_2 : real) = sko_strategy_0 DoorB Stay in\llet (_x_3 : real) = sko_strategy_0 DoorB Swap in\llet (_x_4 : real) = sko_strategy_0 DoorC Stay in\llet (_x_5 : real) = sko_strategy_0 DoorC Swap in\lnot\l(not\l ((((((_x_0 \&gt;=. 0 &amp;&amp; _x_1 \&gt;=. 0) &amp;&amp; _x_2 \&gt;=. 0) &amp;&amp; _x_3 \&gt;=. 0) &amp;&amp; _x_4 \&gt;=. 0)\l   &amp;&amp; _x_5 \&gt;=. 0)\l  &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)\l \|\| (1000000/3 *. _x_0 +. 1000000/3 *. _x_2 +. 1000000/3 *. _x_4\l     +. 2000000/3 *. _x_1 +. 2000000/3 *. _x_3 +. 2000000/3 *. _x_5)\l    \&lt;=. 2000000/3)&quot;,shape=box,style=filled,color=&quot;cyan&quot;,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-ada95963-0c3e-4ac3-8173-cd9d61f554ed';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-d762d25d-1c0a-4f3a-ba75-cdd04a7c50c2';
  alternatives.hydrate(target);
});
</script></div></div></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We’ve proven that the best possible expected reward in the Monty Hall game is 2/3 of a $1,000,000 in an (arguably, rather counterintuitive) result that one has to always swap his first choice to double his chances of winning.</p>
<p>Suppose now that we don’t know the winning strategy, but we do know that it is possible to win in 2/3 of the cases. Can we ask Imandra to synthesise the optimal strategy? For this purpose we can use the <code>instance</code> directive:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-37" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="n">instance</span> <span class="o">(</span> <span class="k">fun</span> <span class="n">strategy</span> <span class="o">-&gt;</span> <span class="nn">Real</span><span class="p">.</span><span class="o">(</span>
  <span class="n">valid_strategy</span><span class="o">(</span><span class="n">strategy</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
  <span class="o">(</span> <span class="n">expected_reward</span> <span class="o">(</span><span class="n">make_scenario_pmf</span> <span class="n">pDoorsEqual</span> <span class="n">strategy</span><span class="o">)</span>
  <span class="o">)</span> <span class="o">=</span> <span class="mi">2000000</span><span class="o">.</span><span class="mi">0</span> <span class="o">/</span> <span class="mi">3</span><span class="o">.</span><span class="mi">0</span> <span class="o">)</span> 
<span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[19]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : (door -&gt; choice -&gt; real) -&gt; bool = &lt;fun&gt;
module CX : sig val strategy : door -&gt; choice -&gt; real end
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre>Instance (after 0 steps, 0.019s):
 let strategy x_0 x_1 =
   match (x_0, x_1) with
   | (DoorB, Swap) -&gt; 1.0
   | _ -&gt; 0.0
 
</pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><div style="font-size: 1.2em; padding: 0.5em; border-top: 1px solid green; border-bottom: 1px solid green"><i class="fa fa-check-circle" style="margin-right: 0.5em; color: green"></i><span>Instance</span></div><div><div class="imandra-alternatives" id="alt-130edd9c-b83c-41c5-91eb-6bd0c3bc3178"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>call graph</a></li><li class="" data-toggle="tab"><a>proof</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-graphviz" id="graphviz-1ce7696a-17d7-480f-b63f-3a54b3aa45dc"><textarea style="display: none">digraph &quot;call graph&quot; {
goal [label=&quot;let (_x_0 : real) = sko_strategy_0 DoorA Stay in\llet (_x_1 : real) = sko_strategy_0 DoorA Swap in\llet (_x_2 : real) = sko_strategy_0 DoorB Stay in\llet (_x_3 : real) = sko_strategy_0 DoorB Swap in\llet (_x_4 : real) = sko_strategy_0 DoorC Stay in\llet (_x_5 : real) = sko_strategy_0 DoorC Swap in\l((((((_x_0 \&gt;=. 0 &amp;&amp; _x_1 \&gt;=. 0) &amp;&amp; _x_2 \&gt;=. 0) &amp;&amp; _x_3 \&gt;=. 0) &amp;&amp; _x_4 \&gt;=. 0)\l  &amp;&amp; _x_5 \&gt;=. 0)\l &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)\l&amp;&amp; 1000000/3 *. _x_0 +. 1000000/3 *. _x_2 +. 1000000/3 *. _x_4\l   +. 2000000/3 *. _x_1 +. 2000000/3 *. _x_3 +. 2000000/3 *. _x_5 = 2000000/3&quot;,shape=box,style=filled,color=&quot;cyan&quot;,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-1ce7696a-17d7-480f-b63f-3a54b3aa45dc';
  graphviz.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-proof-top"><div class="imandra-fold panel panel-default" id="fold-10985494-aefc-4f24-81f7-a378fdd8af42"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>proof attempt</span></div></div><div class="panel-body collapse"><div class="imandra-proof"><div class="imandra-alternatives" id="alt-3750fbcf-d542-4cfe-82ad-67d0c31ee775"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>summary</a></li><li class="" data-toggle="tab"><a>full</a></li><li class="" data-toggle="tab"><a>graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-table" id="table-b5acb100-513e-4410-a652-700c72b1ee54"><table><tr><td><b>ground_instances</b></td><td>0</td></tr><tr><td><b>definitions</b></td><td>0</td></tr><tr><td><b>inductions</b></td><td>0</td></tr><tr><td><b>search_time</b></td><td><pre>0.019s</pre></td></tr><tr><td><b>details</b></td><td><div class="imandra-fold panel panel-default" id="fold-396c70c2-4ac8-4f36-9302-34e9735012d6"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><div class="imandra-table" id="table-a7234198-9671-4633-9068-38d271509ea0"><table><tr><td><b>smt_stats</b></td><td><div class="imandra-table" id="table-c9e2d7fc-8693-4f86-bee5-356eb1627998"><table><tr><td><b>num checks</b></td><td>1</td></tr><tr><td><b>arith-make-feasible</b></td><td>2</td></tr><tr><td><b>arith-max-columns</b></td><td>13</td></tr><tr><td><b>rlimit count</b></td><td>1794</td></tr><tr><td><b>mk clause</b></td><td>8</td></tr><tr><td><b>datatype occurs check</b></td><td>5</td></tr><tr><td><b>mk bool var</b></td><td>15</td></tr><tr><td><b>arith-lower</b></td><td>2</td></tr><tr><td><b>propagations</b></td><td>3</td></tr><tr><td><b>arith-max-rows</b></td><td>3</td></tr><tr><td><b>datatype accessor ax</b></td><td>5</td></tr><tr><td><b>arith-bound-propagations-lp</b></td><td>1</td></tr><tr><td><b>num allocs</b></td><td>1082203896</td></tr><tr><td><b>final checks</b></td><td>1</td></tr><tr><td><b>added eqs</b></td><td>4</td></tr><tr><td><b>del clause</b></td><td>8</td></tr><tr><td><b>arith eq adapter</b></td><td>2</td></tr><tr><td><b>arith-upper</b></td><td>8</td></tr><tr><td><b>memory</b></td><td>19.240000</td></tr><tr><td><b>max memory</b></td><td>24.340000</td></tr></table></div></td></tr></table></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-396c70c2-4ac8-4f36-9302-34e9735012d6';
  fold.hydrate(target);
});
</script></div></td></tr></table></div></div><div class="tab-pane"><div class="imandra-fold panel panel-default" id="fold-4ced0b3d-818f-4427-b8e4-8842ccacb133"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><ul><li><pre>start[0.019s]
  let (_x_0 : real) = sko_strategy_0 DoorA Stay in
  let (_x_1 : real) = sko_strategy_0 DoorA Swap in
  let (_x_2 : real) = sko_strategy_0 DoorB Stay in
  let (_x_3 : real) = sko_strategy_0 DoorB Swap in
  let (_x_4 : real) = sko_strategy_0 DoorC Stay in
  let (_x_5 : real) = sko_strategy_0 DoorC Swap in
  let (_x_6 : real) = 1 /. 3 in
  let (_x_7 : real) = _x_6 *. _x_0 in
  let (_x_8 : real) = if Stay = Swap then 1000000 else 0 in
  let (_x_9 : bool) = DoorB = DoorA in
  let (_x_10 : bool) = DoorC = DoorA in
  let (_x_11 : real) = _x_6 *. _x_2 in
  let (_x_12 : bool) = DoorA = DoorB in
  let (_x_13 : bool) = DoorC = DoorB in
  let (_x_14 : real) = _x_6 *. _x_4 in
  let (_x_15 : bool) = DoorA = DoorC in
  let (_x_16 : bool) = DoorB = DoorC in
  let (_x_17 : real) = _x_6 *. _x_1 in
  let (_x_18 : real) = if Swap = Stay then 1000000 else 0 in
  let (_x_19 : real) = _x_6 *. _x_3 in
  let (_x_20 : real) = _x_6 *. _x_5 in
  (_x_0 &gt;=. 0
   &amp;&amp; _x_1 &gt;=. 0
      &amp;&amp; _x_2 &gt;=. 0
         &amp;&amp; _x_3 &gt;=. 0
            &amp;&amp; _x_4 &gt;=. 0
               &amp;&amp; _x_5 &gt;=. 0
                  &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)
  &amp;&amp; _x_7 *. 1000000 +. _x_7 *. (if _x_9 then 1000000 else _x_8)
     +. _x_7 *. (if _x_10 then 1000000 else _x_8)
     +. (_x_11 *. (if _x_12 then 1000000 else _x_8) +. _x_11 *. 1000000
         +. _x_11 *. (if _x_13 then 1000000 else _x_8))
     +. (_x_14 *. (if _x_15 then 1000000 else _x_8)
         +. _x_14 *. (if _x_16 then 1000000 else _x_8) +. _x_14 *. 1000000)
     +. (_x_17 *. _x_18 +. _x_17 *. (if _x_9 then _x_18 else 1000000)
         +. _x_17 *. (if _x_10 then _x_18 else 1000000)
         +. (_x_19 *. (if _x_12 then _x_18 else 1000000) +. _x_19 *. _x_18
             +. _x_19 *. (if _x_13 then _x_18 else 1000000))
         +. (_x_20 *. (if _x_15 then _x_18 else 1000000)
             +. _x_20 *. (if _x_16 then _x_18 else 1000000) +. _x_20 *. _x_18))
     = 2000000 /. 3</pre></li><li><div><h4>simplify</h4><div class="imandra-table" id="table-373cf127-5c5c-4a77-a1ad-38b8ce727e36"><table><tr><td><b>into</b></td><td><pre>let (_x_0 : real) = sko_strategy_0 DoorA Stay in
let (_x_1 : real) = sko_strategy_0 DoorA Swap in
let (_x_2 : real) = sko_strategy_0 DoorB Stay in
let (_x_3 : real) = sko_strategy_0 DoorB Swap in
let (_x_4 : real) = sko_strategy_0 DoorC Stay in
let (_x_5 : real) = sko_strategy_0 DoorC Swap in
((((((_x_0 &gt;=. 0 &amp;&amp; _x_1 &gt;=. 0) &amp;&amp; _x_2 &gt;=. 0) &amp;&amp; _x_3 &gt;=. 0) &amp;&amp; _x_4 &gt;=. 0)
  &amp;&amp; _x_5 &gt;=. 0)
 &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)
&amp;&amp; 1000000/3 *. _x_0 +. 1000000/3 *. _x_2 +. 1000000/3 *. _x_4
   +. 2000000/3 *. _x_1 +. 2000000/3 *. _x_3 +. 2000000/3 *. _x_5 = 2000000/3</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><ul></ul></td></tr></table></div></div></li><li>Sat (Some  let strategy x_0 x_1 =
   match (x_0, x_1) with
   | (DoorB, Swap) -&gt; 1.0
   | _ -&gt; 0.0
 
)</li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-4ced0b3d-818f-4427-b8e4-8842ccacb133';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-2bbd7d16-ded8-438e-829a-3552ad47ae34"><textarea style="display: none">digraph &quot;proof&quot; {
p_255 [label=&quot;Start (let (_x_0 : real) = sko_strategy_0 DoorA Stay in\l       let (_x_1 : real) = sko_strategy_0 DoorA Swap in\l       let (_x_2 : real) = sko_strategy_0 DoorB Stay in\l       let (_x_3 : real) = sko_strategy_0 DoorB Swap in\l       let (_x_4 : real) = sko_strategy_0 DoorC Stay in\l       let (_x_5 : real) = sko_strategy_0 DoorC Swap in\l       let (_x_6 : real) = 1 /. 3 in\l       let (_x_7 : real) = _x_6 *. _x_0 in\l       let (_x_8 : real) = if Stay = Swap then 1000000 else 0 in\l       let (_x_9 : bool) = DoorB = DoorA in\l       let (_x_10 : bool) = DoorC = DoorA in\l       let (_x_11 : real) = _x_6 *. _x_2 in\l       let (_x_12 : bool) = DoorA = DoorB in\l       let (_x_13 : bool) = DoorC = DoorB in\l       let (_x_14 : real) = _x_6 *. _x_4 in\l       let (_x_15 : bool) = DoorA = DoorC in\l       let (_x_16 : bool) = DoorB = DoorC in\l       let (_x_17 : real) = _x_6 *. _x_1 in\l       let (_x_18 : real) = if Swap = Stay then 1000000 else 0 in\l       let (_x_19 : real) = _x_6 *. _x_3 in\l       let (_x_20 : real) = _x_6 *. _x_5 in\l       (_x_0 \&gt;=. 0\l        &amp;&amp; _x_1 \&gt;=. 0\l           &amp;&amp; _x_2 \&gt;=. 0\l              &amp;&amp; _x_3 \&gt;=. 0\l                 &amp;&amp; _x_4 \&gt;=. 0\l                    &amp;&amp; _x_5 \&gt;=. 0\l                       &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)\l       &amp;&amp; _x_7 *. 1000000 +. _x_7 *. (if _x_9 then 1000000 else _x_8)\l          +. _x_7 *. (if _x_10 then 1000000 else _x_8)\l          +. (_x_11 *. (if _x_12 then 1000000 else _x_8) +. _x_11 *. 1000000\l              +. _x_11 *. (if _x_13 then 1000000 else _x_8))\l          +. (_x_14 *. (if _x_15 then 1000000 else _x_8)\l              +. _x_14 *. (if _x_16 then 1000000 else _x_8)\l              +. _x_14 *. 1000000)\l          +. (_x_17 *. _x_18 +. _x_17 *. (if _x_9 then _x_18 else 1000000)\l              +. _x_17 *. (if _x_10 then _x_18 else 1000000)\l              +. (_x_19 *. (if _x_12 then _x_18 else 1000000)\l                  +. _x_19 *. _x_18\l                  +. _x_19 *. (if _x_13 then _x_18 else 1000000))\l              +. (_x_20 *. (if _x_15 then _x_18 else 1000000)\l                  +. _x_20 *. (if _x_16 then _x_18 else 1000000)\l                  +. _x_20 *. _x_18))\l          = 2000000 /. 3\l       :time 0.019s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_255 -&gt; p_254 [label=&quot;&quot;];
p_254 [label=&quot;Simplify (let (_x_0 : real) = sko_strategy_0 DoorA Stay in\l          let (_x_1 : real) = sko_strategy_0 DoorA Swap in\l          let (_x_2 : real) = sko_strategy_0 DoorB Stay in\l          let (_x_3 : real) = sko_strategy_0 DoorB Swap in\l          let (_x_4 : real) = sko_strategy_0 DoorC Stay in\l          let (_x_5 : real) = sko_strategy_0 DoorC Swap in\l          ((((((_x_0 \&gt;=. 0 &amp;&amp; _x_1 \&gt;=. 0) &amp;&amp; _x_2 \&gt;=. 0) &amp;&amp; _x_3 \&gt;=. 0)\l             &amp;&amp; _x_4 \&gt;=. 0)\l            &amp;&amp; _x_5 \&gt;=. 0)\l           &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)\l          &amp;&amp; 1000000/3 *. _x_0 +. 1000000/3 *. _x_2 +. 1000000/3 *. _x_4\l             +. 2000000/3 *. _x_1 +. 2000000/3 *. _x_3 +. 2000000/3 *. _x_5 =\l             2000000/3\l          :expansions [] :rw [] :fc [])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_254 -&gt; p_253 [label=&quot;&quot;];
p_253 [label=&quot;Sat (Some  let strategy x_0 x_1 =\l   match (x_0, x_1) with\l   \| (DoorB, Swap) -\&gt; 1.0\l   \| _ -\&gt; 0.0\l \l)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-2bbd7d16-ded8-438e-829a-3552ad47ae34';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-3750fbcf-d542-4cfe-82ad-67d0c31ee775';
  alternatives.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-10985494-aefc-4f24-81f7-a378fdd8af42';
  fold.hydrate(target);
});
</script></div></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-130edd9c-b83c-41c5-91eb-6bd0c3bc3178';
  alternatives.hydrate(target);
});
</script></div></div></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We've got an example of an optimal strategy - this one doesn't randomize over doors, but suggests to always choose the DoorA and then swap.</p>
<h1 id="Biased-Monty-Hall">Biased Monty Hall<a class="anchor-link" href="#Biased-Monty-Hall">&#182;</a></h1><p>Now let's apply what we've learned about the "standard" Monty Hall paradox to a more complicated game setup - suppose that we somehow know that the host is biased towards the <code>DoorA</code> -- the probability that the host will hide the prize behind the first door is 3 times higher than the individual probabilities for two other doors. Should one still always swap? Or, maybe, it makes more sense to always choose the more likely <code>DoorA</code> and stay?</p>
<p>We encode our biased host in the biased PMF over doors (also doing a sanity check that it is a valid probability distribution):</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-39" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">pDoorsBiased</span> <span class="n">door</span> <span class="o">=</span> <span class="nn">Real</span><span class="p">.</span><span class="o">(</span>
  <span class="k">match</span> <span class="n">door</span> <span class="k">with</span>
  <span class="o">|</span> <span class="nc">DoorA</span> <span class="o">-&gt;</span> <span class="mi">3</span><span class="o">.</span><span class="mi">0</span> <span class="o">/</span> <span class="mi">5</span><span class="o">.</span><span class="mi">0</span>
  <span class="o">|</span> <span class="nc">DoorB</span> <span class="o">|</span> <span class="nc">DoorC</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span> <span class="o">/</span> <span class="mi">5</span><span class="o">.</span><span class="mi">0</span>
<span class="o">);;</span>

<span class="n">valid_door_pmf</span><span class="o">(</span><span class="n">pDoorsBiased</span><span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[20]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val pDoorsBiased : door -&gt; real = &lt;fun&gt;
- : bool = true
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In the previous section, we've proven that the maximal possible expected reward in the "standard" Monty Hall problem is 2/3 of a million. Again, we ask Imandra whether we can improve on this in the biased case:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-41" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="n">verify</span> <span class="o">(</span> <span class="k">fun</span> <span class="o">(</span><span class="n">strategy</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="nn">Real</span><span class="p">.</span><span class="o">(</span>
  <span class="n">valid_strategy</span><span class="o">(</span><span class="n">strategy</span><span class="o">)</span> <span class="o">==&gt;</span>
  <span class="o">(</span> <span class="n">expected_reward</span> <span class="o">(</span><span class="n">make_scenario_pmf</span> <span class="n">pDoorsBiased</span> <span class="n">strategy</span><span class="o">)</span>
  <span class="o">)</span> <span class="o">&lt;=</span> <span class="mi">2000000</span><span class="o">.</span><span class="mi">0</span> <span class="o">/</span> <span class="mi">3</span><span class="o">.</span><span class="mi">0</span> <span class="o">)</span> 
<span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[21]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : (door -&gt; choice -&gt; real) -&gt; bool = &lt;fun&gt;
module CX : sig val strategy : door -&gt; choice -&gt; real end
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre>Counterexample (after 0 steps, 0.032s):
 let strategy x_0 x_1 =
   match (x_0, x_1) with
   | (DoorA, Swap) -&gt; (Real.mk_of_string &quot;399997/1200000&quot;)
   | (DoorB, Swap) -&gt; (Real.mk_of_string &quot;800003/1200000&quot;)
   | _ -&gt; 0.0
 
</pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><div style="font-size: 1.2em; padding: 0.5em; border-top: 1px dashed #D84315; border-bottom: 1px dashed #D84315"><i class="fa fa-times-circle-o" style="margin-right: 0.5em; color: #D84315"></i><span>Refuted</span></div><div><div class="imandra-alternatives" id="alt-14d81f5e-cb2f-4836-bba2-cb702bb274dc"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>call graph</a></li><li class="" data-toggle="tab"><a>proof</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-graphviz" id="graphviz-a3057254-01d7-4a47-bd81-f0248a733f6b"><textarea style="display: none">digraph &quot;call graph&quot; {
goal [label=&quot;let (_x_0 : real) = sko_strategy_0 DoorA Stay in\llet (_x_1 : real) = sko_strategy_0 DoorA Swap in\llet (_x_2 : real) = sko_strategy_0 DoorB Stay in\llet (_x_3 : real) = sko_strategy_0 DoorB Swap in\llet (_x_4 : real) = sko_strategy_0 DoorC Stay in\llet (_x_5 : real) = sko_strategy_0 DoorC Swap in\lnot\l(not\l ((((((_x_0 \&gt;=. 0 &amp;&amp; _x_1 \&gt;=. 0) &amp;&amp; _x_2 \&gt;=. 0) &amp;&amp; _x_3 \&gt;=. 0) &amp;&amp; _x_4 \&gt;=. 0)\l   &amp;&amp; _x_5 \&gt;=. 0)\l  &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)\l \|\| (600000 *. _x_0 +. 200000 *. _x_2 +. 200000 *. _x_4 +. 400000 *. _x_1\l     +. 800000 *. _x_3 +. 800000 *. _x_5)\l    \&lt;=. 2000000/3)&quot;,shape=box,style=filled,color=&quot;cyan&quot;,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-a3057254-01d7-4a47-bd81-f0248a733f6b';
  graphviz.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-proof-top"><div class="imandra-fold panel panel-default" id="fold-ced81d78-115d-498f-afa7-f17f6acacaeb"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>proof attempt</span></div></div><div class="panel-body collapse"><div class="imandra-proof"><div class="imandra-alternatives" id="alt-2fa5336f-bf85-4f35-87ae-47f22e25e1a9"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>summary</a></li><li class="" data-toggle="tab"><a>full</a></li><li class="" data-toggle="tab"><a>graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-table" id="table-7efd4827-f5cc-4527-928f-da894bb9d248"><table><tr><td><b>ground_instances</b></td><td>0</td></tr><tr><td><b>definitions</b></td><td>0</td></tr><tr><td><b>inductions</b></td><td>0</td></tr><tr><td><b>search_time</b></td><td><pre>0.032s</pre></td></tr><tr><td><b>details</b></td><td><div class="imandra-fold panel panel-default" id="fold-6a31e858-1064-4398-bd41-a1aa6d876051"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><div class="imandra-table" id="table-96e466fa-b237-4688-8d1b-ea5f30f6b11a"><table><tr><td><b>smt_stats</b></td><td><div class="imandra-table" id="table-80ae48b1-db6e-401d-a02d-edde1131eeeb"><table><tr><td><b>num checks</b></td><td>1</td></tr><tr><td><b>arith-make-feasible</b></td><td>2</td></tr><tr><td><b>arith-max-columns</b></td><td>12</td></tr><tr><td><b>rlimit count</b></td><td>2074</td></tr><tr><td><b>mk clause</b></td><td>4</td></tr><tr><td><b>datatype occurs check</b></td><td>5</td></tr><tr><td><b>mk bool var</b></td><td>13</td></tr><tr><td><b>arith-lower</b></td><td>1</td></tr><tr><td><b>propagations</b></td><td>2</td></tr><tr><td><b>arith-max-rows</b></td><td>2</td></tr><tr><td><b>datatype accessor ax</b></td><td>5</td></tr><tr><td><b>num allocs</b></td><td>1144782814</td></tr><tr><td><b>final checks</b></td><td>1</td></tr><tr><td><b>added eqs</b></td><td>3</td></tr><tr><td><b>del clause</b></td><td>4</td></tr><tr><td><b>arith eq adapter</b></td><td>1</td></tr><tr><td><b>arith-upper</b></td><td>8</td></tr><tr><td><b>memory</b></td><td>19.540000</td></tr><tr><td><b>max memory</b></td><td>24.340000</td></tr></table></div></td></tr></table></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-6a31e858-1064-4398-bd41-a1aa6d876051';
  fold.hydrate(target);
});
</script></div></td></tr></table></div></div><div class="tab-pane"><div class="imandra-fold panel panel-default" id="fold-a63673e1-4ed3-4181-b14a-1865c89624a2"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><ul><li><pre>start[0.032s]
  let (_x_0 : real) = sko_strategy_0 DoorA Stay in
  let (_x_1 : real) = sko_strategy_0 DoorA Swap in
  let (_x_2 : real) = sko_strategy_0 DoorB Stay in
  let (_x_3 : real) = sko_strategy_0 DoorB Swap in
  let (_x_4 : real) = sko_strategy_0 DoorC Stay in
  let (_x_5 : real) = sko_strategy_0 DoorC Swap in
  let (_x_6 : real) = 3 /. 5 in
  let (_x_7 : real) = 1 /. 5 in
  let (_x_8 : bool) = DoorB = DoorA in
  let (_x_9 : real) = if _x_8 then _x_6 else _x_7 in
  let (_x_10 : real) = if Stay = Swap then 1000000 else 0 in
  let (_x_11 : bool) = DoorC = DoorA in
  let (_x_12 : real) = if _x_11 then _x_6 else _x_7 in
  let (_x_13 : bool) = DoorA = DoorB in
  let (_x_14 : bool) = DoorC = DoorB in
  let (_x_15 : bool) = DoorA = DoorC in
  let (_x_16 : bool) = DoorB = DoorC in
  let (_x_17 : real) = if Swap = Stay then 1000000 else 0 in
  _x_0 &gt;=. 0
  &amp;&amp; _x_1 &gt;=. 0
     &amp;&amp; _x_2 &gt;=. 0
        &amp;&amp; _x_3 &gt;=. 0
           &amp;&amp; _x_4 &gt;=. 0
              &amp;&amp; _x_5 &gt;=. 0
                 &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1
  ==&gt; (_x_6 *. _x_0 *. 1000000
       +. _x_9 *. _x_0 *. (if _x_8 then 1000000 else _x_10)
       +. _x_12 *. _x_0 *. (if _x_11 then 1000000 else _x_10)
       +. (_x_6 *. _x_2 *. (if _x_13 then 1000000 else _x_10)
           +. _x_9 *. _x_2 *. 1000000
           +. _x_12 *. _x_2 *. (if _x_14 then 1000000 else _x_10))
       +. (_x_6 *. _x_4 *. (if _x_15 then 1000000 else _x_10)
           +. _x_9 *. _x_4 *. (if _x_16 then 1000000 else _x_10)
           +. _x_12 *. _x_4 *. 1000000)
       +. (_x_6 *. _x_1 *. _x_17
           +. _x_9 *. _x_1 *. (if _x_8 then _x_17 else 1000000)
           +. _x_12 *. _x_1 *. (if _x_11 then _x_17 else 1000000)
           +. (_x_6 *. _x_3 *. (if _x_13 then _x_17 else 1000000)
               +. _x_9 *. _x_3 *. _x_17
               +. _x_12 *. _x_3 *. (if _x_14 then _x_17 else 1000000))
           +. (_x_6 *. _x_5 *. (if _x_15 then _x_17 else 1000000)
               +. _x_9 *. _x_5 *. (if _x_16 then _x_17 else 1000000)
               +. _x_12 *. _x_5 *. _x_17)))
      &lt;=. (2000000 /. 3)</pre></li><li><div><h4>simplify</h4><div class="imandra-table" id="table-72374db5-56b0-4c16-9433-4c4eb3c993c0"><table><tr><td><b>into</b></td><td><pre>let (_x_0 : real) = sko_strategy_0 DoorA Stay in
let (_x_1 : real) = sko_strategy_0 DoorA Swap in
let (_x_2 : real) = sko_strategy_0 DoorB Stay in
let (_x_3 : real) = sko_strategy_0 DoorB Swap in
let (_x_4 : real) = sko_strategy_0 DoorC Stay in
let (_x_5 : real) = sko_strategy_0 DoorC Swap in
not
((((((_x_0 &gt;=. 0 &amp;&amp; _x_1 &gt;=. 0) &amp;&amp; _x_2 &gt;=. 0) &amp;&amp; _x_3 &gt;=. 0) &amp;&amp; _x_4 &gt;=. 0)
  &amp;&amp; _x_5 &gt;=. 0)
 &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)
|| (600000 *. _x_0 +. 200000 *. _x_2 +. 200000 *. _x_4 +. 400000 *. _x_1
    +. 800000 *. _x_3 +. 800000 *. _x_5)
   &lt;=. 2000000/3</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><ul></ul></td></tr></table></div></div></li><li>Sat (Some  let strategy x_0 x_1 =
   match (x_0, x_1) with
   | (DoorA, Swap) -&gt; (Real.mk_of_string &quot;399997/1200000&quot;)
   | (DoorB, Swap) -&gt; (Real.mk_of_string &quot;800003/1200000&quot;)
   | _ -&gt; 0.0
 
)</li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-a63673e1-4ed3-4181-b14a-1865c89624a2';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-aee0ae85-205a-4a70-ae02-ddfec8ce912f"><textarea style="display: none">digraph &quot;proof&quot; {
p_258 [label=&quot;Start (let (_x_0 : real) = sko_strategy_0 DoorA Stay in\l       let (_x_1 : real) = sko_strategy_0 DoorA Swap in\l       let (_x_2 : real) = sko_strategy_0 DoorB Stay in\l       let (_x_3 : real) = sko_strategy_0 DoorB Swap in\l       let (_x_4 : real) = sko_strategy_0 DoorC Stay in\l       let (_x_5 : real) = sko_strategy_0 DoorC Swap in\l       let (_x_6 : real) = 3 /. 5 in\l       let (_x_7 : real) = 1 /. 5 in\l       let (_x_8 : bool) = DoorB = DoorA in\l       let (_x_9 : real) = if _x_8 then _x_6 else _x_7 in\l       let (_x_10 : real) = if Stay = Swap then 1000000 else 0 in\l       let (_x_11 : bool) = DoorC = DoorA in\l       let (_x_12 : real) = if _x_11 then _x_6 else _x_7 in\l       let (_x_13 : bool) = DoorA = DoorB in\l       let (_x_14 : bool) = DoorC = DoorB in\l       let (_x_15 : bool) = DoorA = DoorC in\l       let (_x_16 : bool) = DoorB = DoorC in\l       let (_x_17 : real) = if Swap = Stay then 1000000 else 0 in\l       _x_0 \&gt;=. 0\l       &amp;&amp; _x_1 \&gt;=. 0\l          &amp;&amp; _x_2 \&gt;=. 0\l             &amp;&amp; _x_3 \&gt;=. 0\l                &amp;&amp; _x_4 \&gt;=. 0\l                   &amp;&amp; _x_5 \&gt;=. 0\l                      &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1\l       ==\&gt; (_x_6 *. _x_0 *. 1000000\l            +. _x_9 *. _x_0 *. (if _x_8 then 1000000 else _x_10)\l            +. _x_12 *. _x_0 *. (if _x_11 then 1000000 else _x_10)\l            +. (_x_6 *. _x_2 *. (if _x_13 then 1000000 else _x_10)\l                +. _x_9 *. _x_2 *. 1000000\l                +. _x_12 *. _x_2 *. (if _x_14 then 1000000 else _x_10))\l            +. (_x_6 *. _x_4 *. (if _x_15 then 1000000 else _x_10)\l                +. _x_9 *. _x_4 *. (if _x_16 then 1000000 else _x_10)\l                +. _x_12 *. _x_4 *. 1000000)\l            +. (_x_6 *. _x_1 *. _x_17\l                +. _x_9 *. _x_1 *. (if _x_8 then _x_17 else 1000000)\l                +. _x_12 *. _x_1 *. (if _x_11 then _x_17 else 1000000)\l                +. (_x_6 *. _x_3 *. (if _x_13 then _x_17 else 1000000)\l                    +. _x_9 *. _x_3 *. _x_17\l                    +. _x_12 *. _x_3 *. (if _x_14 then _x_17 else 1000000))\l                +. (_x_6 *. _x_5 *. (if _x_15 then _x_17 else 1000000)\l                    +. _x_9 *. _x_5 *. (if _x_16 then _x_17 else 1000000)\l                    +. _x_12 *. _x_5 *. _x_17)))\l           \&lt;=. (2000000 /. 3)\l       :time 0.032s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_258 -&gt; p_257 [label=&quot;&quot;];
p_257 [label=&quot;Simplify (let (_x_0 : real) = sko_strategy_0 DoorA Stay in\l          let (_x_1 : real) = sko_strategy_0 DoorA Swap in\l          let (_x_2 : real) = sko_strategy_0 DoorB Stay in\l          let (_x_3 : real) = sko_strategy_0 DoorB Swap in\l          let (_x_4 : real) = sko_strategy_0 DoorC Stay in\l          let (_x_5 : real) = sko_strategy_0 DoorC Swap in\l          not\l          ((((((_x_0 \&gt;=. 0 &amp;&amp; _x_1 \&gt;=. 0) &amp;&amp; _x_2 \&gt;=. 0) &amp;&amp; _x_3 \&gt;=. 0)\l             &amp;&amp; _x_4 \&gt;=. 0)\l            &amp;&amp; _x_5 \&gt;=. 0)\l           &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)\l          \|\| (600000 *. _x_0 +. 200000 *. _x_2 +. 200000 *. _x_4\l              +. 400000 *. _x_1 +. 800000 *. _x_3 +. 800000 *. _x_5)\l             \&lt;=. 2000000/3\l          :expansions [] :rw [] :fc [])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_257 -&gt; p_256 [label=&quot;&quot;];
p_256 [label=&quot;Sat (Some  let strategy x_0 x_1 =\l   match (x_0, x_1) with\l   \| (DoorA, Swap) -\&gt; (Real.mk_of_string \&quot;399997/1200000\&quot;)\l   \| (DoorB, Swap) -\&gt; (Real.mk_of_string \&quot;800003/1200000\&quot;)\l   \| _ -\&gt; 0.0\l \l)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-aee0ae85-205a-4a70-ae02-ddfec8ce912f';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-2fa5336f-bf85-4f35-87ae-47f22e25e1a9';
  alternatives.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-ced81d78-115d-498f-afa7-f17f6acacaeb';
  fold.hydrate(target);
});
</script></div></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-14d81f5e-cb2f-4836-bba2-cb702bb274dc';
  alternatives.hydrate(target);
});
</script></div></div></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Imandra suggests that we can do better than 2/3 if we use a mixed strategy of either choosing the <code>DoorA</code> and staying or choosing the <code>DoorC</code> and swapping. Let's test both of these pure strategies and see what would be the expected rewards for each:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-43" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">aStayStrategy</span> <span class="n">door</span> <span class="n">choice</span> <span class="o">=</span> 
  <span class="k">match</span> <span class="n">door</span><span class="o">,</span><span class="n">choice</span> <span class="k">with</span> <span class="o">|</span> <span class="nc">DoorA</span><span class="o">,</span><span class="nc">Stay</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span> <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span> <span class="k">in</span>
<span class="n">aStayStrategy</span>
<span class="o">|&gt;</span> <span class="n">make_scenario_pmf</span> <span class="n">pDoorsBiased</span>
<span class="o">|&gt;</span> <span class="n">expected_reward</span> 
<span class="o">;;</span>
<span class="k">let</span> <span class="n">cSwapStrategy</span> <span class="n">door</span> <span class="n">choice</span> <span class="o">=</span> 
  <span class="k">match</span> <span class="n">door</span><span class="o">,</span><span class="n">choice</span> <span class="k">with</span> <span class="o">|</span> <span class="nc">DoorC</span><span class="o">,</span><span class="nc">Swap</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span> <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span> <span class="k">in</span>
<span class="n">cSwapStrategy</span>
<span class="o">|&gt;</span> <span class="n">make_scenario_pmf</span> <span class="n">pDoorsBiased</span>
<span class="o">|&gt;</span> <span class="n">expected_reward</span> 
<span class="o">;;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[22]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : real = 600000
- : real = 800000
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Choosing the <code>DoorC</code> and then swapping increases the chances of winning up to 80%! Again, is this the best outcome one can get?</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-45" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="n">verify</span> <span class="o">(</span> <span class="k">fun</span> <span class="n">strategy</span> <span class="o">-&gt;</span> <span class="nn">Real</span><span class="p">.</span><span class="o">(</span>
  <span class="n">valid_strategy</span><span class="o">(</span><span class="n">strategy</span><span class="o">)</span> <span class="o">==&gt;</span>
  <span class="o">(</span> <span class="n">expected_reward</span> <span class="o">(</span><span class="n">make_scenario_pmf</span> <span class="n">pDoorsBiased</span> <span class="n">strategy</span><span class="o">)</span>
  <span class="o">)</span> <span class="o">&lt;=</span> <span class="mi">800000</span><span class="o">.</span><span class="mi">0</span> <span class="o">)</span> 
<span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[23]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : (door -&gt; choice -&gt; real) -&gt; bool = &lt;fun&gt;
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><div style="font-size: 1.2em; padding: 0.5em; border-top: 1px solid green; border-bottom: 1px solid green"><i class="fa fa-check-circle" style="margin-right: 0.5em; color: green"></i><span>Proved</span></div><div><div class="imandra-alternatives" id="alt-1c30189b-0bc3-422a-a29e-95ffada77e8c"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>proof</a></li><li class="" data-toggle="tab"><a>call graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-proof-top"><div class="imandra-fold panel panel-default" id="fold-fc952820-5b09-499f-a465-af60fe1a2af3"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>proof</span></div></div><div class="panel-body collapse"><div class="imandra-proof"><div class="imandra-alternatives" id="alt-8858842a-1332-43f3-acbb-7555be22a11c"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>summary</a></li><li class="" data-toggle="tab"><a>full</a></li><li class="" data-toggle="tab"><a>graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-table" id="table-7365ae62-5aeb-4c10-ab3a-4ffce7bbaf7a"><table><tr><td><b>ground_instances</b></td><td>0</td></tr><tr><td><b>definitions</b></td><td>0</td></tr><tr><td><b>inductions</b></td><td>0</td></tr><tr><td><b>search_time</b></td><td><pre>0.018s</pre></td></tr><tr><td><b>details</b></td><td><div class="imandra-fold panel panel-default" id="fold-268f8ff9-35b2-4c91-b210-4cf81bf089ae"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><div class="imandra-table" id="table-85e49601-0280-448a-bb09-512349a32ec6"><table><tr><td><b>smt_stats</b></td><td><div class="imandra-table" id="table-91e45072-5110-43cb-8541-b6685e9c1916"><table><tr><td><b>num checks</b></td><td>1</td></tr><tr><td><b>arith-make-feasible</b></td><td>1</td></tr><tr><td><b>arith-max-columns</b></td><td>12</td></tr><tr><td><b>rlimit count</b></td><td>2028</td></tr><tr><td><b>mk clause</b></td><td>6</td></tr><tr><td><b>mk bool var</b></td><td>13</td></tr><tr><td><b>arith-max-rows</b></td><td>2</td></tr><tr><td><b>conflicts</b></td><td>1</td></tr><tr><td><b>datatype accessor ax</b></td><td>5</td></tr><tr><td><b>arith-bound-propagations-lp</b></td><td>2</td></tr><tr><td><b>num allocs</b></td><td>1214071242</td></tr><tr><td><b>added eqs</b></td><td>2</td></tr><tr><td><b>arith eq adapter</b></td><td>1</td></tr><tr><td><b>arith-upper</b></td><td>7</td></tr><tr><td><b>memory</b></td><td>19.450000</td></tr><tr><td><b>max memory</b></td><td>24.340000</td></tr></table></div></td></tr></table></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-268f8ff9-35b2-4c91-b210-4cf81bf089ae';
  fold.hydrate(target);
});
</script></div></td></tr></table></div></div><div class="tab-pane"><div class="imandra-fold panel panel-default" id="fold-09ce3c17-d9cb-408c-99ef-4cb982fe902f"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><ul><li><pre>start[0.018s]
  let (_x_0 : real) = sko_strategy_0 DoorA Stay in
  let (_x_1 : real) = sko_strategy_0 DoorA Swap in
  let (_x_2 : real) = sko_strategy_0 DoorB Stay in
  let (_x_3 : real) = sko_strategy_0 DoorB Swap in
  let (_x_4 : real) = sko_strategy_0 DoorC Stay in
  let (_x_5 : real) = sko_strategy_0 DoorC Swap in
  let (_x_6 : real) = 3 /. 5 in
  let (_x_7 : real) = 1 /. 5 in
  let (_x_8 : bool) = DoorB = DoorA in
  let (_x_9 : real) = if _x_8 then _x_6 else _x_7 in
  let (_x_10 : real) = if Stay = Swap then 1000000 else 0 in
  let (_x_11 : bool) = DoorC = DoorA in
  let (_x_12 : real) = if _x_11 then _x_6 else _x_7 in
  let (_x_13 : bool) = DoorA = DoorB in
  let (_x_14 : bool) = DoorC = DoorB in
  let (_x_15 : bool) = DoorA = DoorC in
  let (_x_16 : bool) = DoorB = DoorC in
  let (_x_17 : real) = if Swap = Stay then 1000000 else 0 in
  _x_0 &gt;=. 0
  &amp;&amp; _x_1 &gt;=. 0
     &amp;&amp; _x_2 &gt;=. 0
        &amp;&amp; _x_3 &gt;=. 0
           &amp;&amp; _x_4 &gt;=. 0
              &amp;&amp; _x_5 &gt;=. 0
                 &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1
  ==&gt; (_x_6 *. _x_0 *. 1000000
       +. _x_9 *. _x_0 *. (if _x_8 then 1000000 else _x_10)
       +. _x_12 *. _x_0 *. (if _x_11 then 1000000 else _x_10)
       +. (_x_6 *. _x_2 *. (if _x_13 then 1000000 else _x_10)
           +. _x_9 *. _x_2 *. 1000000
           +. _x_12 *. _x_2 *. (if _x_14 then 1000000 else _x_10))
       +. (_x_6 *. _x_4 *. (if _x_15 then 1000000 else _x_10)
           +. _x_9 *. _x_4 *. (if _x_16 then 1000000 else _x_10)
           +. _x_12 *. _x_4 *. 1000000)
       +. (_x_6 *. _x_1 *. _x_17
           +. _x_9 *. _x_1 *. (if _x_8 then _x_17 else 1000000)
           +. _x_12 *. _x_1 *. (if _x_11 then _x_17 else 1000000)
           +. (_x_6 *. _x_3 *. (if _x_13 then _x_17 else 1000000)
               +. _x_9 *. _x_3 *. _x_17
               +. _x_12 *. _x_3 *. (if _x_14 then _x_17 else 1000000))
           +. (_x_6 *. _x_5 *. (if _x_15 then _x_17 else 1000000)
               +. _x_9 *. _x_5 *. (if _x_16 then _x_17 else 1000000)
               +. _x_12 *. _x_5 *. _x_17)))
      &lt;=. 800000</pre></li><li><div><h4>simplify</h4><div class="imandra-table" id="table-c792393c-0e23-4c4d-9fd6-25510f3efa73"><table><tr><td><b>into</b></td><td><pre>let (_x_0 : real) = sko_strategy_0 DoorA Stay in
let (_x_1 : real) = sko_strategy_0 DoorA Swap in
let (_x_2 : real) = sko_strategy_0 DoorB Stay in
let (_x_3 : real) = sko_strategy_0 DoorB Swap in
let (_x_4 : real) = sko_strategy_0 DoorC Stay in
let (_x_5 : real) = sko_strategy_0 DoorC Swap in
not
((((((_x_0 &gt;=. 0 &amp;&amp; _x_1 &gt;=. 0) &amp;&amp; _x_2 &gt;=. 0) &amp;&amp; _x_3 &gt;=. 0) &amp;&amp; _x_4 &gt;=. 0)
  &amp;&amp; _x_5 &gt;=. 0)
 &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)
|| (600000 *. _x_0 +. 200000 *. _x_2 +. 200000 *. _x_4 +. 400000 *. _x_1
    +. 800000 *. _x_3 +. 800000 *. _x_5)
   &lt;=. 800000</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><ul></ul></td></tr></table></div></div></li><li>Unsat</li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-09ce3c17-d9cb-408c-99ef-4cb982fe902f';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-1e888a5f-83fe-4319-9180-40cd716c53ec"><textarea style="display: none">digraph &quot;proof&quot; {
p_261 [label=&quot;Start (let (_x_0 : real) = sko_strategy_0 DoorA Stay in\l       let (_x_1 : real) = sko_strategy_0 DoorA Swap in\l       let (_x_2 : real) = sko_strategy_0 DoorB Stay in\l       let (_x_3 : real) = sko_strategy_0 DoorB Swap in\l       let (_x_4 : real) = sko_strategy_0 DoorC Stay in\l       let (_x_5 : real) = sko_strategy_0 DoorC Swap in\l       let (_x_6 : real) = 3 /. 5 in\l       let (_x_7 : real) = 1 /. 5 in\l       let (_x_8 : bool) = DoorB = DoorA in\l       let (_x_9 : real) = if _x_8 then _x_6 else _x_7 in\l       let (_x_10 : real) = if Stay = Swap then 1000000 else 0 in\l       let (_x_11 : bool) = DoorC = DoorA in\l       let (_x_12 : real) = if _x_11 then _x_6 else _x_7 in\l       let (_x_13 : bool) = DoorA = DoorB in\l       let (_x_14 : bool) = DoorC = DoorB in\l       let (_x_15 : bool) = DoorA = DoorC in\l       let (_x_16 : bool) = DoorB = DoorC in\l       let (_x_17 : real) = if Swap = Stay then 1000000 else 0 in\l       _x_0 \&gt;=. 0\l       &amp;&amp; _x_1 \&gt;=. 0\l          &amp;&amp; _x_2 \&gt;=. 0\l             &amp;&amp; _x_3 \&gt;=. 0\l                &amp;&amp; _x_4 \&gt;=. 0\l                   &amp;&amp; _x_5 \&gt;=. 0\l                      &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1\l       ==\&gt; (_x_6 *. _x_0 *. 1000000\l            +. _x_9 *. _x_0 *. (if _x_8 then 1000000 else _x_10)\l            +. _x_12 *. _x_0 *. (if _x_11 then 1000000 else _x_10)\l            +. (_x_6 *. _x_2 *. (if _x_13 then 1000000 else _x_10)\l                +. _x_9 *. _x_2 *. 1000000\l                +. _x_12 *. _x_2 *. (if _x_14 then 1000000 else _x_10))\l            +. (_x_6 *. _x_4 *. (if _x_15 then 1000000 else _x_10)\l                +. _x_9 *. _x_4 *. (if _x_16 then 1000000 else _x_10)\l                +. _x_12 *. _x_4 *. 1000000)\l            +. (_x_6 *. _x_1 *. _x_17\l                +. _x_9 *. _x_1 *. (if _x_8 then _x_17 else 1000000)\l                +. _x_12 *. _x_1 *. (if _x_11 then _x_17 else 1000000)\l                +. (_x_6 *. _x_3 *. (if _x_13 then _x_17 else 1000000)\l                    +. _x_9 *. _x_3 *. _x_17\l                    +. _x_12 *. _x_3 *. (if _x_14 then _x_17 else 1000000))\l                +. (_x_6 *. _x_5 *. (if _x_15 then _x_17 else 1000000)\l                    +. _x_9 *. _x_5 *. (if _x_16 then _x_17 else 1000000)\l                    +. _x_12 *. _x_5 *. _x_17)))\l           \&lt;=. 800000\l       :time 0.018s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_261 -&gt; p_260 [label=&quot;&quot;];
p_260 [label=&quot;Simplify (let (_x_0 : real) = sko_strategy_0 DoorA Stay in\l          let (_x_1 : real) = sko_strategy_0 DoorA Swap in\l          let (_x_2 : real) = sko_strategy_0 DoorB Stay in\l          let (_x_3 : real) = sko_strategy_0 DoorB Swap in\l          let (_x_4 : real) = sko_strategy_0 DoorC Stay in\l          let (_x_5 : real) = sko_strategy_0 DoorC Swap in\l          not\l          ((((((_x_0 \&gt;=. 0 &amp;&amp; _x_1 \&gt;=. 0) &amp;&amp; _x_2 \&gt;=. 0) &amp;&amp; _x_3 \&gt;=. 0)\l             &amp;&amp; _x_4 \&gt;=. 0)\l            &amp;&amp; _x_5 \&gt;=. 0)\l           &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)\l          \|\| (600000 *. _x_0 +. 200000 *. _x_2 +. 200000 *. _x_4\l              +. 400000 *. _x_1 +. 800000 *. _x_3 +. 800000 *. _x_5)\l             \&lt;=. 800000\l          :expansions [] :rw [] :fc [])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_260 -&gt; p_259 [label=&quot;&quot;];
p_259 [label=&quot;Unsat&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-1e888a5f-83fe-4319-9180-40cd716c53ec';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-8858842a-1332-43f3-acbb-7555be22a11c';
  alternatives.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-fc952820-5b09-499f-a465-af60fe1a2af3';
  fold.hydrate(target);
});
</script></div></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-35a3fdfc-c3db-4724-b4fc-b6f40f733d04"><textarea style="display: none">digraph &quot;call graph&quot; {
goal [label=&quot;let (_x_0 : real) = sko_strategy_0 DoorA Stay in\llet (_x_1 : real) = sko_strategy_0 DoorA Swap in\llet (_x_2 : real) = sko_strategy_0 DoorB Stay in\llet (_x_3 : real) = sko_strategy_0 DoorB Swap in\llet (_x_4 : real) = sko_strategy_0 DoorC Stay in\llet (_x_5 : real) = sko_strategy_0 DoorC Swap in\lnot\l(not\l ((((((_x_0 \&gt;=. 0 &amp;&amp; _x_1 \&gt;=. 0) &amp;&amp; _x_2 \&gt;=. 0) &amp;&amp; _x_3 \&gt;=. 0) &amp;&amp; _x_4 \&gt;=. 0)\l   &amp;&amp; _x_5 \&gt;=. 0)\l  &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)\l \|\| (600000 *. _x_0 +. 200000 *. _x_2 +. 200000 *. _x_4 +. 400000 *. _x_1\l     +. 800000 *. _x_3 +. 800000 *. _x_5)\l    \&lt;=. 800000)&quot;,shape=box,style=filled,color=&quot;cyan&quot;,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-35a3fdfc-c3db-4724-b4fc-b6f40f733d04';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-1c30189b-0bc3-422a-a29e-95ffada77e8c';
  alternatives.hydrate(target);
});
</script></div></div></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>And we've proven that the DoorC-Swap is the best strategy the player can employ in this setup. Intuitively the reason for that is that it is better to choose the least likely door, forcing the host to reveal more information about the prize location in the more likely doors.</p>
<h1 id="Even-more-complex-example">Even more complex example<a class="anchor-link" href="#Even-more-complex-example">&#182;</a></h1><p>Using this approach one can go further and analyse even more complicated Monty-Hall-like games (for example, the prize value might depend on the door and/or player actions).</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-47" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">pDoorsComplex</span> <span class="n">door</span> <span class="o">=</span> <span class="nn">Real</span><span class="p">.</span><span class="o">(</span>
  <span class="k">match</span> <span class="n">door</span> <span class="k">with</span>
  <span class="o">|</span> <span class="nc">DoorA</span> <span class="o">-&gt;</span> <span class="mi">5</span><span class="o">.</span><span class="mi">0</span> <span class="o">/</span> <span class="mi">10</span><span class="o">.</span><span class="mi">0</span>
  <span class="o">|</span> <span class="nc">DoorB</span> <span class="o">-&gt;</span> <span class="mi">3</span><span class="o">.</span><span class="mi">0</span> <span class="o">/</span> <span class="mi">10</span><span class="o">.</span><span class="mi">0</span> 
  <span class="o">|</span> <span class="nc">DoorC</span> <span class="o">-&gt;</span> <span class="mi">2</span><span class="o">.</span><span class="mi">0</span> <span class="o">/</span> <span class="mi">10</span><span class="o">.</span><span class="mi">0</span>
<span class="o">);;</span>

<span class="k">let</span> <span class="n">reward_complex</span> <span class="n">scenario</span> <span class="o">=</span> 
  <span class="k">let</span> <span class="n">prize</span> <span class="o">=</span> <span class="k">match</span> <span class="n">scenario</span><span class="o">.</span><span class="n">prize</span> <span class="k">with</span>
    <span class="o">|</span> <span class="nc">DoorA</span> <span class="o">-&gt;</span> <span class="mi">1000000</span><span class="o">.</span>
    <span class="o">|</span> <span class="nc">DoorB</span> <span class="o">-&gt;</span> <span class="mi">2000000</span><span class="o">.</span>
    <span class="o">|</span> <span class="nc">DoorC</span> <span class="o">-&gt;</span> <span class="mi">4000000</span><span class="o">.</span>      
  <span class="k">in</span> 
  <span class="k">if</span> <span class="n">scenario</span><span class="o">.</span><span class="n">prize</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">first_guess</span> <span class="k">then</span> <span class="o">(</span>
      <span class="k">if</span> <span class="n">scenario</span><span class="o">.</span><span class="n">choice</span> <span class="o">=</span> <span class="nc">Stay</span> <span class="k">then</span> <span class="n">prize</span> <span class="k">else</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span>
  <span class="o">)</span> <span class="k">else</span> <span class="o">(</span>
      <span class="k">if</span> <span class="n">scenario</span><span class="o">.</span><span class="n">choice</span> <span class="o">=</span> <span class="nc">Swap</span> <span class="k">then</span> <span class="n">prize</span> <span class="k">else</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span>
  <span class="o">)</span>
<span class="o">;;</span>

<span class="k">let</span> <span class="n">expected_reward_complex</span> <span class="o">:</span> <span class="o">(</span><span class="n">scenario</span> <span class="o">-&gt;</span> <span class="n">real</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">real</span> <span class="o">=</span> 
  <span class="k">let</span> <span class="k">open</span> <span class="nc">Real</span> <span class="k">in</span>
  <span class="k">fun</span> <span class="n">scenario_pmf</span> <span class="o">-&gt;</span> 
    <span class="k">let</span> <span class="n">pr</span> <span class="n">s</span> <span class="o">=</span> <span class="n">scenario_pmf</span><span class="o">(</span><span class="n">s</span><span class="o">)</span> <span class="o">*</span> <span class="n">reward_complex</span><span class="o">(</span><span class="n">s</span><span class="o">)</span> <span class="k">in</span>
      <span class="k">let</span> <span class="n">avg</span> <span class="n">choice</span> <span class="o">=</span> 
        <span class="k">let</span> <span class="n">avg</span> <span class="n">first_guess</span> <span class="o">=</span>
          <span class="n">pr</span> <span class="o">{</span> <span class="n">prize</span> <span class="o">=</span> <span class="nc">DoorA</span><span class="o">;</span> <span class="n">first_guess</span><span class="o">;</span> <span class="n">choice</span><span class="o">}</span> <span class="o">+</span>
          <span class="n">pr</span> <span class="o">{</span> <span class="n">prize</span> <span class="o">=</span> <span class="nc">DoorB</span><span class="o">;</span> <span class="n">first_guess</span><span class="o">;</span> <span class="n">choice</span><span class="o">}</span> <span class="o">+</span>
          <span class="n">pr</span> <span class="o">{</span> <span class="n">prize</span> <span class="o">=</span> <span class="nc">DoorC</span><span class="o">;</span> <span class="n">first_guess</span><span class="o">;</span> <span class="n">choice</span><span class="o">}</span> 
        <span class="k">in</span>
      <span class="n">avg</span><span class="o">(</span><span class="nc">DoorA</span><span class="o">)</span> <span class="o">+</span> <span class="n">avg</span><span class="o">(</span><span class="nc">DoorB</span><span class="o">)</span> <span class="o">+</span> <span class="n">avg</span><span class="o">(</span><span class="nc">DoorC</span><span class="o">)</span> 
      <span class="k">in</span>
    <span class="n">avg</span><span class="o">(</span><span class="nc">Stay</span><span class="o">)</span> <span class="o">+</span> <span class="n">avg</span><span class="o">(</span><span class="nc">Swap</span><span class="o">)</span>
<span class="o">;;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[24]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val pDoorsComplex : door -&gt; real = &lt;fun&gt;
val reward_complex : scenario -&gt; real = &lt;fun&gt;
val expected_reward_complex : (scenario -&gt; real) -&gt; real = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-48" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="n">verify</span> <span class="o">(</span> <span class="k">fun</span> <span class="n">strategy</span> <span class="o">-&gt;</span> <span class="nn">Real</span><span class="p">.</span><span class="o">(</span>
  <span class="n">valid_strategy</span><span class="o">(</span><span class="n">strategy</span><span class="o">)</span> <span class="o">==&gt;</span>
  <span class="o">(</span> <span class="n">expected_reward_complex</span> <span class="o">(</span> <span class="n">make_scenario_pmf</span> <span class="n">pDoorsComplex</span> <span class="n">strategy</span><span class="o">)</span>
  <span class="o">)</span> <span class="o">&lt;=</span> <span class="mi">1400000</span><span class="o">.</span><span class="mi">0</span> <span class="o">)</span> 
<span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[25]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : (door -&gt; choice -&gt; real) -&gt; bool = &lt;fun&gt;
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><div style="font-size: 1.2em; padding: 0.5em; border-top: 1px solid green; border-bottom: 1px solid green"><i class="fa fa-check-circle" style="margin-right: 0.5em; color: green"></i><span>Proved</span></div><div><div class="imandra-alternatives" id="alt-bebca2d0-0aff-42a8-92c4-d0d23ee274ab"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>proof</a></li><li class="" data-toggle="tab"><a>call graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-proof-top"><div class="imandra-fold panel panel-default" id="fold-4a9b9c83-fb29-46d9-a747-5ffbe877d196"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>proof</span></div></div><div class="panel-body collapse"><div class="imandra-proof"><div class="imandra-alternatives" id="alt-50229947-266d-4cee-856c-ccd58aed8b22"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>summary</a></li><li class="" data-toggle="tab"><a>full</a></li><li class="" data-toggle="tab"><a>graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-table" id="table-347d37d2-2852-4ef0-a592-0fdb3a2e5fb7"><table><tr><td><b>ground_instances</b></td><td>0</td></tr><tr><td><b>definitions</b></td><td>0</td></tr><tr><td><b>inductions</b></td><td>0</td></tr><tr><td><b>search_time</b></td><td><pre>0.021s</pre></td></tr><tr><td><b>details</b></td><td><div class="imandra-fold panel panel-default" id="fold-649cdd11-e819-4b8a-833d-bbcef181d10b"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><div class="imandra-table" id="table-54af900a-7136-419e-9688-16879a290e08"><table><tr><td><b>smt_stats</b></td><td><div class="imandra-table" id="table-7cbad97e-d7bb-4954-8b07-165227095018"><table><tr><td><b>num checks</b></td><td>1</td></tr><tr><td><b>arith-make-feasible</b></td><td>2</td></tr><tr><td><b>arith-max-columns</b></td><td>12</td></tr><tr><td><b>arith-conflicts</b></td><td>1</td></tr><tr><td><b>rlimit count</b></td><td>2473</td></tr><tr><td><b>mk clause</b></td><td>4</td></tr><tr><td><b>mk bool var</b></td><td>13</td></tr><tr><td><b>arith-lower</b></td><td>1</td></tr><tr><td><b>propagations</b></td><td>2</td></tr><tr><td><b>arith-max-rows</b></td><td>2</td></tr><tr><td><b>conflicts</b></td><td>1</td></tr><tr><td><b>datatype accessor ax</b></td><td>5</td></tr><tr><td><b>num allocs</b></td><td>1259691697</td></tr><tr><td><b>added eqs</b></td><td>3</td></tr><tr><td><b>arith eq adapter</b></td><td>1</td></tr><tr><td><b>arith-upper</b></td><td>8</td></tr><tr><td><b>memory</b></td><td>22.700000</td></tr><tr><td><b>max memory</b></td><td>24.340000</td></tr></table></div></td></tr></table></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-649cdd11-e819-4b8a-833d-bbcef181d10b';
  fold.hydrate(target);
});
</script></div></td></tr></table></div></div><div class="tab-pane"><div class="imandra-fold panel panel-default" id="fold-96dba3c3-bd55-42a4-8288-d7cdbc127289"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><ul><li><pre>start[0.021s]
  let (_x_0 : real) = sko_strategy_0 DoorA Stay in
  let (_x_1 : real) = sko_strategy_0 DoorA Swap in
  let (_x_2 : real) = sko_strategy_0 DoorB Stay in
  let (_x_3 : real) = sko_strategy_0 DoorB Swap in
  let (_x_4 : real) = sko_strategy_0 DoorC Stay in
  let (_x_5 : real) = sko_strategy_0 DoorC Swap in
  let (_x_6 : real) = 5 /. 10 in
  let (_x_7 : real) = 3 /. 10 in
  let (_x_8 : bool) = DoorB = DoorA in
  let (_x_9 : real) = if _x_8 then _x_6 else _x_7 in
  let (_x_10 : real) = if _x_8 then 1000000 else 2000000 in
  let (_x_11 : bool) = Stay = Swap in
  let (_x_12 : real) = if _x_11 then _x_10 else 0 in
  let (_x_13 : bool) = DoorC = DoorB in
  let (_x_14 : bool) = DoorC = DoorA in
  let (_x_15 : real)
      = if _x_14 then _x_6 else if _x_13 then _x_7 else 2 /. 10
  in
  let (_x_16 : real)
      = if _x_14 then 1000000 else if _x_13 then 2000000 else 4000000
  in
  let (_x_17 : real) = if _x_11 then _x_16 else 0 in
  let (_x_18 : real) = if _x_11 then 1000000 else 0 in
  let (_x_19 : bool) = DoorA = DoorB in
  let (_x_20 : bool) = DoorA = DoorC in
  let (_x_21 : bool) = DoorB = DoorC in
  let (_x_22 : bool) = Swap = Stay in
  let (_x_23 : real) = if _x_22 then 1000000 else 0 in
  let (_x_24 : real) = if _x_22 then _x_10 else 0 in
  let (_x_25 : real) = if _x_22 then _x_16 else 0 in
  _x_0 &gt;=. 0
  &amp;&amp; _x_1 &gt;=. 0
     &amp;&amp; _x_2 &gt;=. 0
        &amp;&amp; _x_3 &gt;=. 0
           &amp;&amp; _x_4 &gt;=. 0
              &amp;&amp; _x_5 &gt;=. 0
                 &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1
  ==&gt; (_x_6 *. _x_0 *. 1000000
       +. _x_9 *. _x_0 *. (if _x_8 then _x_10 else _x_12)
       +. _x_15 *. _x_0 *. (if _x_14 then _x_16 else _x_17)
       +. (_x_6 *. _x_2 *. (if _x_19 then 1000000 else _x_18)
           +. _x_9 *. _x_2 *. _x_10
           +. _x_15 *. _x_2 *. (if _x_13 then _x_16 else _x_17))
       +. (_x_6 *. _x_4 *. (if _x_20 then 1000000 else _x_18)
           +. _x_9 *. _x_4 *. (if _x_21 then _x_10 else _x_12)
           +. _x_15 *. _x_4 *. _x_16)
       +. (_x_6 *. _x_1 *. _x_23
           +. _x_9 *. _x_1 *. (if _x_8 then _x_24 else _x_10)
           +. _x_15 *. _x_1 *. (if _x_14 then _x_25 else _x_16)
           +. (_x_6 *. _x_3 *. (if _x_19 then _x_23 else 1000000)
               +. _x_9 *. _x_3 *. _x_24
               +. _x_15 *. _x_3 *. (if _x_13 then _x_25 else _x_16))
           +. (_x_6 *. _x_5 *. (if _x_20 then _x_23 else 1000000)
               +. _x_9 *. _x_5 *. (if _x_21 then _x_24 else _x_10)
               +. _x_15 *. _x_5 *. _x_25)))
      &lt;=. 1400000</pre></li><li><div><h4>simplify</h4><div class="imandra-table" id="table-d68f9527-bae8-4afc-92fa-95c39518c04a"><table><tr><td><b>into</b></td><td><pre>let (_x_0 : real) = sko_strategy_0 DoorA Stay in
let (_x_1 : real) = sko_strategy_0 DoorA Swap in
let (_x_2 : real) = sko_strategy_0 DoorB Stay in
let (_x_3 : real) = sko_strategy_0 DoorB Swap in
let (_x_4 : real) = sko_strategy_0 DoorC Stay in
let (_x_5 : real) = sko_strategy_0 DoorC Swap in
not
((((((_x_0 &gt;=. 0 &amp;&amp; _x_1 &gt;=. 0) &amp;&amp; _x_2 &gt;=. 0) &amp;&amp; _x_3 &gt;=. 0) &amp;&amp; _x_4 &gt;=. 0)
  &amp;&amp; _x_5 &gt;=. 0)
 &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)
|| (500000 *. _x_0 +. 600000 *. _x_2 +. 800000 *. _x_4 +. 1400000 *. _x_1
    +. 1300000 *. _x_3 +. 1100000 *. _x_5)
   &lt;=. 1400000</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><ul></ul></td></tr></table></div></div></li><li>Unsat</li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-96dba3c3-bd55-42a4-8288-d7cdbc127289';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-be944b6c-de3e-48e7-9d30-460cce9658d0"><textarea style="display: none">digraph &quot;proof&quot; {
p_264 [label=&quot;Start (let (_x_0 : real) = sko_strategy_0 DoorA Stay in\l       let (_x_1 : real) = sko_strategy_0 DoorA Swap in\l       let (_x_2 : real) = sko_strategy_0 DoorB Stay in\l       let (_x_3 : real) = sko_strategy_0 DoorB Swap in\l       let (_x_4 : real) = sko_strategy_0 DoorC Stay in\l       let (_x_5 : real) = sko_strategy_0 DoorC Swap in\l       let (_x_6 : real) = 5 /. 10 in\l       let (_x_7 : real) = 3 /. 10 in\l       let (_x_8 : bool) = DoorB = DoorA in\l       let (_x_9 : real) = if _x_8 then _x_6 else _x_7 in\l       let (_x_10 : real) = if _x_8 then 1000000 else 2000000 in\l       let (_x_11 : bool) = Stay = Swap in\l       let (_x_12 : real) = if _x_11 then _x_10 else 0 in\l       let (_x_13 : bool) = DoorC = DoorB in\l       let (_x_14 : bool) = DoorC = DoorA in\l       let (_x_15 : real)\l           = if _x_14 then _x_6 else if _x_13 then _x_7 else 2 /. 10\l       in\l       let (_x_16 : real)\l           = if _x_14 then 1000000 else if _x_13 then 2000000 else 4000000\l       in\l       let (_x_17 : real) = if _x_11 then _x_16 else 0 in\l       let (_x_18 : real) = if _x_11 then 1000000 else 0 in\l       let (_x_19 : bool) = DoorA = DoorB in\l       let (_x_20 : bool) = DoorA = DoorC in\l       let (_x_21 : bool) = DoorB = DoorC in\l       let (_x_22 : bool) = Swap = Stay in\l       let (_x_23 : real) = if _x_22 then 1000000 else 0 in\l       let (_x_24 : real) = if _x_22 then _x_10 else 0 in\l       let (_x_25 : real) = if _x_22 then _x_16 else 0 in\l       _x_0 \&gt;=. 0\l       &amp;&amp; _x_1 \&gt;=. 0\l          &amp;&amp; _x_2 \&gt;=. 0\l             &amp;&amp; _x_3 \&gt;=. 0\l                &amp;&amp; _x_4 \&gt;=. 0\l                   &amp;&amp; _x_5 \&gt;=. 0\l                      &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1\l       ==\&gt; (_x_6 *. _x_0 *. 1000000\l            +. _x_9 *. _x_0 *. (if _x_8 then _x_10 else _x_12)\l            +. _x_15 *. _x_0 *. (if _x_14 then _x_16 else _x_17)\l            +. (_x_6 *. _x_2 *. (if _x_19 then 1000000 else _x_18)\l                +. _x_9 *. _x_2 *. _x_10\l                +. _x_15 *. _x_2 *. (if _x_13 then _x_16 else _x_17))\l            +. (_x_6 *. _x_4 *. (if _x_20 then 1000000 else _x_18)\l                +. _x_9 *. _x_4 *. (if _x_21 then _x_10 else _x_12)\l                +. _x_15 *. _x_4 *. _x_16)\l            +. (_x_6 *. _x_1 *. _x_23\l                +. _x_9 *. _x_1 *. (if _x_8 then _x_24 else _x_10)\l                +. _x_15 *. _x_1 *. (if _x_14 then _x_25 else _x_16)\l                +. (_x_6 *. _x_3 *. (if _x_19 then _x_23 else 1000000)\l                    +. _x_9 *. _x_3 *. _x_24\l                    +. _x_15 *. _x_3 *. (if _x_13 then _x_25 else _x_16))\l                +. (_x_6 *. _x_5 *. (if _x_20 then _x_23 else 1000000)\l                    +. _x_9 *. _x_5 *. (if _x_21 then _x_24 else _x_10)\l                    +. _x_15 *. _x_5 *. _x_25)))\l           \&lt;=. 1400000\l       :time 0.021s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_264 -&gt; p_263 [label=&quot;&quot;];
p_263 [label=&quot;Simplify (let (_x_0 : real) = sko_strategy_0 DoorA Stay in\l          let (_x_1 : real) = sko_strategy_0 DoorA Swap in\l          let (_x_2 : real) = sko_strategy_0 DoorB Stay in\l          let (_x_3 : real) = sko_strategy_0 DoorB Swap in\l          let (_x_4 : real) = sko_strategy_0 DoorC Stay in\l          let (_x_5 : real) = sko_strategy_0 DoorC Swap in\l          not\l          ((((((_x_0 \&gt;=. 0 &amp;&amp; _x_1 \&gt;=. 0) &amp;&amp; _x_2 \&gt;=. 0) &amp;&amp; _x_3 \&gt;=. 0)\l             &amp;&amp; _x_4 \&gt;=. 0)\l            &amp;&amp; _x_5 \&gt;=. 0)\l           &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)\l          \|\| (500000 *. _x_0 +. 600000 *. _x_2 +. 800000 *. _x_4\l              +. 1400000 *. _x_1 +. 1300000 *. _x_3 +. 1100000 *. _x_5)\l             \&lt;=. 1400000\l          :expansions [] :rw [] :fc [])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_263 -&gt; p_262 [label=&quot;&quot;];
p_262 [label=&quot;Unsat&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-be944b6c-de3e-48e7-9d30-460cce9658d0';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-50229947-266d-4cee-856c-ccd58aed8b22';
  alternatives.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-4a9b9c83-fb29-46d9-a747-5ffbe877d196';
  fold.hydrate(target);
});
</script></div></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-6f43b014-4475-40e6-acc7-f158b50ce5a3"><textarea style="display: none">digraph &quot;call graph&quot; {
goal [label=&quot;let (_x_0 : real) = sko_strategy_0 DoorA Stay in\llet (_x_1 : real) = sko_strategy_0 DoorA Swap in\llet (_x_2 : real) = sko_strategy_0 DoorB Stay in\llet (_x_3 : real) = sko_strategy_0 DoorB Swap in\llet (_x_4 : real) = sko_strategy_0 DoorC Stay in\llet (_x_5 : real) = sko_strategy_0 DoorC Swap in\lnot\l(not\l ((((((_x_0 \&gt;=. 0 &amp;&amp; _x_1 \&gt;=. 0) &amp;&amp; _x_2 \&gt;=. 0) &amp;&amp; _x_3 \&gt;=. 0) &amp;&amp; _x_4 \&gt;=. 0)\l   &amp;&amp; _x_5 \&gt;=. 0)\l  &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)\l \|\| (500000 *. _x_0 +. 600000 *. _x_2 +. 800000 *. _x_4 +. 1400000 *. _x_1\l     +. 1300000 *. _x_3 +. 1100000 *. _x_5)\l    \&lt;=. 1400000)&quot;,shape=box,style=filled,color=&quot;cyan&quot;,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-6f43b014-4475-40e6-acc7-f158b50ce5a3';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-bebca2d0-0aff-42a8-92c4-d0d23ee274ab';
  alternatives.hydrate(target);
});
</script></div></div></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Probabilistic%20Reasoning%20in%20OCaml.ipynb%23try-cell-49" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="n">instance</span> <span class="o">(</span> <span class="k">fun</span> <span class="n">strategy</span> <span class="o">-&gt;</span> <span class="nn">Real</span><span class="p">.</span><span class="o">(</span>
  <span class="n">valid_strategy</span><span class="o">(</span><span class="n">strategy</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
  <span class="o">(</span> <span class="n">expected_reward_complex</span> <span class="o">(</span> <span class="n">make_scenario_pmf</span> <span class="n">pDoorsComplex</span> <span class="n">strategy</span><span class="o">)</span>
  <span class="o">)</span> <span class="o">=</span> <span class="mi">1400000</span><span class="o">.</span><span class="mi">0</span> <span class="o">)</span> 
<span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[26]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : (door -&gt; choice -&gt; real) -&gt; bool = &lt;fun&gt;
module CX : sig val strategy : door -&gt; choice -&gt; real end
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre>Instance (after 0 steps, 0.021s):
 let strategy x_0 x_1 =
   match (x_0, x_1) with
   | (DoorA, Swap) -&gt; 1.0
   | _ -&gt; 0.0
 
</pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><div style="font-size: 1.2em; padding: 0.5em; border-top: 1px solid green; border-bottom: 1px solid green"><i class="fa fa-check-circle" style="margin-right: 0.5em; color: green"></i><span>Instance</span></div><div><div class="imandra-alternatives" id="alt-f42a6d20-cab9-4315-933e-4959b2b607de"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>call graph</a></li><li class="" data-toggle="tab"><a>proof</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-graphviz" id="graphviz-3c3b2be1-0cef-4223-9ad2-63679bcd5fbc"><textarea style="display: none">digraph &quot;call graph&quot; {
goal [label=&quot;let (_x_0 : real) = sko_strategy_0 DoorA Stay in\llet (_x_1 : real) = sko_strategy_0 DoorA Swap in\llet (_x_2 : real) = sko_strategy_0 DoorB Stay in\llet (_x_3 : real) = sko_strategy_0 DoorB Swap in\llet (_x_4 : real) = sko_strategy_0 DoorC Stay in\llet (_x_5 : real) = sko_strategy_0 DoorC Swap in\l((((((_x_0 \&gt;=. 0 &amp;&amp; _x_1 \&gt;=. 0) &amp;&amp; _x_2 \&gt;=. 0) &amp;&amp; _x_3 \&gt;=. 0) &amp;&amp; _x_4 \&gt;=. 0)\l  &amp;&amp; _x_5 \&gt;=. 0)\l &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)\l&amp;&amp; 500000 *. _x_0 +. 600000 *. _x_2 +. 800000 *. _x_4 +. 1400000 *. _x_1\l   +. 1300000 *. _x_3 +. 1100000 *. _x_5 = 1400000&quot;,shape=box,style=filled,color=&quot;cyan&quot;,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-3c3b2be1-0cef-4223-9ad2-63679bcd5fbc';
  graphviz.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-proof-top"><div class="imandra-fold panel panel-default" id="fold-3de88851-046a-41cb-95a8-f5b5c53a26bd"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>proof attempt</span></div></div><div class="panel-body collapse"><div class="imandra-proof"><div class="imandra-alternatives" id="alt-5c1afff8-9590-4093-979a-94085ee1cbd0"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>summary</a></li><li class="" data-toggle="tab"><a>full</a></li><li class="" data-toggle="tab"><a>graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-table" id="table-59bf7cb0-565b-4219-b180-adfe0426f9d4"><table><tr><td><b>ground_instances</b></td><td>0</td></tr><tr><td><b>definitions</b></td><td>0</td></tr><tr><td><b>inductions</b></td><td>0</td></tr><tr><td><b>search_time</b></td><td><pre>0.021s</pre></td></tr><tr><td><b>details</b></td><td><div class="imandra-fold panel panel-default" id="fold-c9c31887-2b37-4f24-8bd9-d39a7042b47a"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><div class="imandra-table" id="table-8d4fc196-aa72-4ddd-b030-d3c215671fae"><table><tr><td><b>smt_stats</b></td><td><div class="imandra-table" id="table-c5298e9f-c30f-424a-9a5b-c13264905eab"><table><tr><td><b>num checks</b></td><td>1</td></tr><tr><td><b>arith-make-feasible</b></td><td>2</td></tr><tr><td><b>arith-max-columns</b></td><td>13</td></tr><tr><td><b>rlimit count</b></td><td>2484</td></tr><tr><td><b>mk clause</b></td><td>8</td></tr><tr><td><b>datatype occurs check</b></td><td>5</td></tr><tr><td><b>mk bool var</b></td><td>16</td></tr><tr><td><b>arith-lower</b></td><td>2</td></tr><tr><td><b>propagations</b></td><td>4</td></tr><tr><td><b>arith-max-rows</b></td><td>3</td></tr><tr><td><b>datatype accessor ax</b></td><td>5</td></tr><tr><td><b>num allocs</b></td><td>1298963665</td></tr><tr><td><b>final checks</b></td><td>1</td></tr><tr><td><b>added eqs</b></td><td>6</td></tr><tr><td><b>del clause</b></td><td>8</td></tr><tr><td><b>arith eq adapter</b></td><td>2</td></tr><tr><td><b>arith-upper</b></td><td>8</td></tr><tr><td><b>memory</b></td><td>25.460000</td></tr><tr><td><b>max memory</b></td><td>25.850000</td></tr></table></div></td></tr></table></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-c9c31887-2b37-4f24-8bd9-d39a7042b47a';
  fold.hydrate(target);
});
</script></div></td></tr></table></div></div><div class="tab-pane"><div class="imandra-fold panel panel-default" id="fold-42ee5a3a-b3da-428e-b104-93e8be7bf03c"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><ul><li><pre>start[0.021s]
  let (_x_0 : real) = sko_strategy_0 DoorA Stay in
  let (_x_1 : real) = sko_strategy_0 DoorA Swap in
  let (_x_2 : real) = sko_strategy_0 DoorB Stay in
  let (_x_3 : real) = sko_strategy_0 DoorB Swap in
  let (_x_4 : real) = sko_strategy_0 DoorC Stay in
  let (_x_5 : real) = sko_strategy_0 DoorC Swap in
  let (_x_6 : real) = 5 /. 10 in
  let (_x_7 : real) = 3 /. 10 in
  let (_x_8 : bool) = DoorB = DoorA in
  let (_x_9 : real) = if _x_8 then _x_6 else _x_7 in
  let (_x_10 : real) = if _x_8 then 1000000 else 2000000 in
  let (_x_11 : bool) = Stay = Swap in
  let (_x_12 : real) = if _x_11 then _x_10 else 0 in
  let (_x_13 : bool) = DoorC = DoorB in
  let (_x_14 : bool) = DoorC = DoorA in
  let (_x_15 : real)
      = if _x_14 then _x_6 else if _x_13 then _x_7 else 2 /. 10
  in
  let (_x_16 : real)
      = if _x_14 then 1000000 else if _x_13 then 2000000 else 4000000
  in
  let (_x_17 : real) = if _x_11 then _x_16 else 0 in
  let (_x_18 : real) = if _x_11 then 1000000 else 0 in
  let (_x_19 : bool) = DoorA = DoorB in
  let (_x_20 : bool) = DoorA = DoorC in
  let (_x_21 : bool) = DoorB = DoorC in
  let (_x_22 : bool) = Swap = Stay in
  let (_x_23 : real) = if _x_22 then 1000000 else 0 in
  let (_x_24 : real) = if _x_22 then _x_10 else 0 in
  let (_x_25 : real) = if _x_22 then _x_16 else 0 in
  (_x_0 &gt;=. 0
   &amp;&amp; _x_1 &gt;=. 0
      &amp;&amp; _x_2 &gt;=. 0
         &amp;&amp; _x_3 &gt;=. 0
            &amp;&amp; _x_4 &gt;=. 0
               &amp;&amp; _x_5 &gt;=. 0
                  &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)
  &amp;&amp; _x_6 *. _x_0 *. 1000000
     +. _x_9 *. _x_0 *. (if _x_8 then _x_10 else _x_12)
     +. _x_15 *. _x_0 *. (if _x_14 then _x_16 else _x_17)
     +. (_x_6 *. _x_2 *. (if _x_19 then 1000000 else _x_18)
         +. _x_9 *. _x_2 *. _x_10
         +. _x_15 *. _x_2 *. (if _x_13 then _x_16 else _x_17))
     +. (_x_6 *. _x_4 *. (if _x_20 then 1000000 else _x_18)
         +. _x_9 *. _x_4 *. (if _x_21 then _x_10 else _x_12)
         +. _x_15 *. _x_4 *. _x_16)
     +. (_x_6 *. _x_1 *. _x_23
         +. _x_9 *. _x_1 *. (if _x_8 then _x_24 else _x_10)
         +. _x_15 *. _x_1 *. (if _x_14 then _x_25 else _x_16)
         +. (_x_6 *. _x_3 *. (if _x_19 then _x_23 else 1000000)
             +. _x_9 *. _x_3 *. _x_24
             +. _x_15 *. _x_3 *. (if _x_13 then _x_25 else _x_16))
         +. (_x_6 *. _x_5 *. (if _x_20 then _x_23 else 1000000)
             +. _x_9 *. _x_5 *. (if _x_21 then _x_24 else _x_10)
             +. _x_15 *. _x_5 *. _x_25))
     = 1400000</pre></li><li><div><h4>simplify</h4><div class="imandra-table" id="table-8ec10978-5490-4d05-84ea-be04014531ac"><table><tr><td><b>into</b></td><td><pre>let (_x_0 : real) = sko_strategy_0 DoorA Stay in
let (_x_1 : real) = sko_strategy_0 DoorA Swap in
let (_x_2 : real) = sko_strategy_0 DoorB Stay in
let (_x_3 : real) = sko_strategy_0 DoorB Swap in
let (_x_4 : real) = sko_strategy_0 DoorC Stay in
let (_x_5 : real) = sko_strategy_0 DoorC Swap in
((((((_x_0 &gt;=. 0 &amp;&amp; _x_1 &gt;=. 0) &amp;&amp; _x_2 &gt;=. 0) &amp;&amp; _x_3 &gt;=. 0) &amp;&amp; _x_4 &gt;=. 0)
  &amp;&amp; _x_5 &gt;=. 0)
 &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)
&amp;&amp; 500000 *. _x_0 +. 600000 *. _x_2 +. 800000 *. _x_4 +. 1400000 *. _x_1
   +. 1300000 *. _x_3 +. 1100000 *. _x_5 = 1400000</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><ul></ul></td></tr></table></div></div></li><li>Sat (Some  let strategy x_0 x_1 =
   match (x_0, x_1) with
   | (DoorA, Swap) -&gt; 1.0
   | _ -&gt; 0.0
 
)</li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-42ee5a3a-b3da-428e-b104-93e8be7bf03c';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-a93cbc15-57e8-4e4c-b1da-ba9be0c98403"><textarea style="display: none">digraph &quot;proof&quot; {
p_267 [label=&quot;Start (let (_x_0 : real) = sko_strategy_0 DoorA Stay in\l       let (_x_1 : real) = sko_strategy_0 DoorA Swap in\l       let (_x_2 : real) = sko_strategy_0 DoorB Stay in\l       let (_x_3 : real) = sko_strategy_0 DoorB Swap in\l       let (_x_4 : real) = sko_strategy_0 DoorC Stay in\l       let (_x_5 : real) = sko_strategy_0 DoorC Swap in\l       let (_x_6 : real) = 5 /. 10 in\l       let (_x_7 : real) = 3 /. 10 in\l       let (_x_8 : bool) = DoorB = DoorA in\l       let (_x_9 : real) = if _x_8 then _x_6 else _x_7 in\l       let (_x_10 : real) = if _x_8 then 1000000 else 2000000 in\l       let (_x_11 : bool) = Stay = Swap in\l       let (_x_12 : real) = if _x_11 then _x_10 else 0 in\l       let (_x_13 : bool) = DoorC = DoorB in\l       let (_x_14 : bool) = DoorC = DoorA in\l       let (_x_15 : real)\l           = if _x_14 then _x_6 else if _x_13 then _x_7 else 2 /. 10\l       in\l       let (_x_16 : real)\l           = if _x_14 then 1000000 else if _x_13 then 2000000 else 4000000\l       in\l       let (_x_17 : real) = if _x_11 then _x_16 else 0 in\l       let (_x_18 : real) = if _x_11 then 1000000 else 0 in\l       let (_x_19 : bool) = DoorA = DoorB in\l       let (_x_20 : bool) = DoorA = DoorC in\l       let (_x_21 : bool) = DoorB = DoorC in\l       let (_x_22 : bool) = Swap = Stay in\l       let (_x_23 : real) = if _x_22 then 1000000 else 0 in\l       let (_x_24 : real) = if _x_22 then _x_10 else 0 in\l       let (_x_25 : real) = if _x_22 then _x_16 else 0 in\l       (_x_0 \&gt;=. 0\l        &amp;&amp; _x_1 \&gt;=. 0\l           &amp;&amp; _x_2 \&gt;=. 0\l              &amp;&amp; _x_3 \&gt;=. 0\l                 &amp;&amp; _x_4 \&gt;=. 0\l                    &amp;&amp; _x_5 \&gt;=. 0\l                       &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)\l       &amp;&amp; _x_6 *. _x_0 *. 1000000\l          +. _x_9 *. _x_0 *. (if _x_8 then _x_10 else _x_12)\l          +. _x_15 *. _x_0 *. (if _x_14 then _x_16 else _x_17)\l          +. (_x_6 *. _x_2 *. (if _x_19 then 1000000 else _x_18)\l              +. _x_9 *. _x_2 *. _x_10\l              +. _x_15 *. _x_2 *. (if _x_13 then _x_16 else _x_17))\l          +. (_x_6 *. _x_4 *. (if _x_20 then 1000000 else _x_18)\l              +. _x_9 *. _x_4 *. (if _x_21 then _x_10 else _x_12)\l              +. _x_15 *. _x_4 *. _x_16)\l          +. (_x_6 *. _x_1 *. _x_23\l              +. _x_9 *. _x_1 *. (if _x_8 then _x_24 else _x_10)\l              +. _x_15 *. _x_1 *. (if _x_14 then _x_25 else _x_16)\l              +. (_x_6 *. _x_3 *. (if _x_19 then _x_23 else 1000000)\l                  +. _x_9 *. _x_3 *. _x_24\l                  +. _x_15 *. _x_3 *. (if _x_13 then _x_25 else _x_16))\l              +. (_x_6 *. _x_5 *. (if _x_20 then _x_23 else 1000000)\l                  +. _x_9 *. _x_5 *. (if _x_21 then _x_24 else _x_10)\l                  +. _x_15 *. _x_5 *. _x_25))\l          = 1400000\l       :time 0.021s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_267 -&gt; p_266 [label=&quot;&quot;];
p_266 [label=&quot;Simplify (let (_x_0 : real) = sko_strategy_0 DoorA Stay in\l          let (_x_1 : real) = sko_strategy_0 DoorA Swap in\l          let (_x_2 : real) = sko_strategy_0 DoorB Stay in\l          let (_x_3 : real) = sko_strategy_0 DoorB Swap in\l          let (_x_4 : real) = sko_strategy_0 DoorC Stay in\l          let (_x_5 : real) = sko_strategy_0 DoorC Swap in\l          ((((((_x_0 \&gt;=. 0 &amp;&amp; _x_1 \&gt;=. 0) &amp;&amp; _x_2 \&gt;=. 0) &amp;&amp; _x_3 \&gt;=. 0)\l             &amp;&amp; _x_4 \&gt;=. 0)\l            &amp;&amp; _x_5 \&gt;=. 0)\l           &amp;&amp; _x_0 +. _x_1 +. _x_2 +. _x_3 +. _x_4 +. _x_5 = 1)\l          &amp;&amp; 500000 *. _x_0 +. 600000 *. _x_2 +. 800000 *. _x_4\l             +. 1400000 *. _x_1 +. 1300000 *. _x_3 +. 1100000 *. _x_5 =\l             1400000\l          :expansions [] :rw [] :fc [])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_266 -&gt; p_265 [label=&quot;&quot;];
p_265 [label=&quot;Sat (Some  let strategy x_0 x_1 =\l   match (x_0, x_1) with\l   \| (DoorA, Swap) -\&gt; 1.0\l   \| _ -\&gt; 0.0\l \l)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-a93cbc15-57e8-4e4c-b1da-ba9be0c98403';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-5c1afff8-9590-4093-979a-94085ee1cbd0';
  alternatives.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-3de88851-046a-41cb-95a8-f5b5c53a26bd';
  fold.hydrate(target);
});
</script></div></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-f42a6d20-cab9-4315-933e-4959b2b607de';
  alternatives.hydrate(target);
});
</script></div></div></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>More generally, this illustrates how we can use Imandra’s ability to reason about functional values and real arithmetic to formally prove and refute statements about probability distributions. These abilities allow us to formally analyse many kinds of scenarios requiring the ability to reason about random variables.</p>
</div>
</div>
</div>
                    </div>
                </article>
            </main>
            <footer class="footer">
                <a class="copyrights"href="http://imandra.ai">&#9400; 2018 - 2021 Imandra Inc. All rights reserved.</a>
            </footer>
        </div>
    



    <script>
    (function () {
            var lastId;
            var sideMenu = $("#side-nav-menu");
            var topMenu = $("#top-menu");
            var topMenuHeight = topMenu.outerHeight() + 15;

            // All list items
            var menuItems = sideMenu.find('a.side__nav-link--within-page');

            // Anchors corresponding to menu items
            var scrollItems = menuItems.map(function () {
              var item = $(this).attr("href");
              var thisItem = item.substring(item.lastIndexOf("#") + 1, item.length);
              var linkedItem = $('#' + CSS.escape(thisItem));
              if (linkedItem.length) { return linkedItem; }
            });

            // Bind to scroll
            $(window).scroll(function () {
                // Get container scroll position
                var fromTop = $(this).scrollTop() + topMenuHeight;;
                // Get id of current scroll item
                var cur = scrollItems.map(function () {
                    if ($(this).offset().top < fromTop)
                        return this;
                });
                cur = cur[cur.length - 1];
                // Get the id of the current element
                var id = cur && cur.length ? cur[0].id : "";
                if (id && lastId !== id) {
                    lastId = id;
                    // Set/remove active class
                    menuItems.each(function (idx, item) {
                    var $item = $(item);
                    $item.removeClass("side__nav-link--within-page--active");

                    if (item.href.endsWith('#' + lastId)) {
                        $item.addClass("side__nav-link--within-page--active");
                    };
                    });
                }
            });
        })()
    </script>
    <script type="text/javascript"> docsearch({
      apiKey: 'ff3a61a82b58783e62ebfbf51e50b0bc',
      indexName: 'imandra',
      inputSelector: '#search',
      debug: false // Set debug to true if you want to inspect the dropdown
    });
    </script>

    </body>
</html>
